(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,207649,e=>{"use strict";let t,n,r;var i,s,a,o,l,u,h,c,d,f,p,m,g,y,v,w,_,b,I,T=e.i(213703),E=e.i(616309),S=e.i(690587);let k=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},C=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},x={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),r.push(n[u],n[h],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(k(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):C(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new A;let l=i<<2|s>>4;if(r.push(l),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==o){let e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class A extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let N=function(e){let t=k(e);return x.encodeByteArray(t,!0)},D=function(e){return N(e).replace(/\./g,"")},R=function(e){try{return x.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function P(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(let n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=P(e[n],t[n]));return e}let O=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===T.default||void 0===T.default.env)return;let e=T.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&R(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},L=()=>{var e;return null==(e=O())?void 0:e.config};class M{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function F(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function U(){var t;let n=null==(t=O())?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function V(){return"object"==typeof self&&self.self===self}function j(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function q(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function B(){let e=F();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function z(){return!U()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function G(){try{return"object"==typeof indexedDB}catch(e){return!1}}class K extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,K.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$.prototype.create)}}class ${constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,r=i,n.replace(H,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new K(s,l,i)}}let H=/\{\$([^}]+)}/g;function W(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Q(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(J(n)&&J(s)){if(!Q(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function J(e){return null!==e&&"object"==typeof e}function Y(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function X(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function Z(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function ee(e,t){let n=new et(e,t);return n.subscribe.bind(n)}class et{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=en),void 0===r.error&&(r.error=en),void 0===r.complete&&(r.complete=en);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function en(){}function er(e){return e&&e._delegate?e._delegate:e}class ei{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let es="[DEFAULT]";class ea{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new M;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:es})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=es){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=es){return this.instances.has(e)}getOptions(e=es){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!=(n=this.onInitCallbacks.get(r))?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===es?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=es){return this.component?this.component.multipleInstances?e:es:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eo{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new ea(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let el=[];(i=o||(o={}))[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT";let eu={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},eh=o.INFO,ec={[o.DEBUG]:"log",[o.VERBOSE]:"log",[o.INFO]:"info",[o.WARN]:"warn",[o.ERROR]:"error"},ed=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=ec[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ef{constructor(e){this.name=e,this._logLevel=eh,this._logHandler=ed,this._userLogHandler=null,el.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in o))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eu[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,o.DEBUG,...e),this._logHandler(this,o.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,o.VERBOSE,...e),this._logHandler(this,o.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,o.INFO,...e),this._logHandler(this,o.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,o.WARN,...e),this._logHandler(this,o.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,o.ERROR,...e),this._logHandler(this,o.ERROR,...e)}}let ep=new WeakMap,em=new WeakMap,eg=new WeakMap,ey=new WeakMap,ev=new WeakMap,ew={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return em.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eg.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return e_(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function e_(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(e_(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&ep.set(t,e)}).catch(()=>{}),ev.set(t,e),t}if(ey.has(e))return ey.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eb(this),t),e_(ep.get(this))}:function(...t){return e_(e.apply(eb(this),t))}:function(t,...n){let r=e.call(eb(this),t,...n);return eg.set(r,t.sort?t.sort():[t]),e_(r)};return e instanceof IDBTransaction&&function(e){if(em.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});em.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,ew):e}(e);return r!==e&&(ey.set(e,r),ev.set(r,e)),r}let eb=e=>ev.get(e),eI=["get","getKey","getAll","getAllKeys","count"],eT=["put","add","delete","clear"],eE=new Map;function eS(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eE.get(t))return eE.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eT.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eI.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return eE.set(t,s),s}ew={...r=ew,get:(e,t,n)=>eS(e,t)||r.get(e,t,n),has:(e,t)=>!!eS(e,t)||r.has(e,t)};class ek{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if((null==(t=e.getComponent())?void 0:t.type)!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eC="@firebase/app",ex="0.10.5",eA=new ef("@firebase/app"),eN="[DEFAULT]",eD={[eC]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eR=new Map,eP=new Map,eO=new Map;function eL(e,t){try{e.container.addComponent(t)}catch(n){eA.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function eM(e,t){e.container.addOrOverwriteComponent(t)}function eF(e){let t=e.name;if(eO.has(t))return eA.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(eO.set(t,e),eR.values()))eL(n,e);for(let t of eP.values())eL(t,e);return!0}function eU(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function eV(e,t,n=eN){eU(e,t).clearInstance(n)}function ej(e){return void 0!==e.options}function eq(e){return void 0!==e.settings}function eB(){eO.clear()}let ez=new $("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class eG{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ei("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ez.create("app-deleted",{appName:this._name})}}class eK extends eG{constructor(e,t,n,r){const i=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig=Object.assign({automaticDataCollectionEnabled:i},t),this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()}),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,eX(eC,ex,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){eY(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw ez.create("server-app-deleted")}}let e$="10.12.2";function eH(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:eN,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw ez.create("bad-app-name",{appName:String(i)});if(n||(n=L()),!n)throw ez.create("no-options");let s=eR.get(i);if(s)if(Q(n,s.options)&&Q(r,s.config))return s;else throw ez.create("duplicate-app",{appName:i});let a=new eo(i);for(let e of eO.values())a.addComponent(e);let o=new eG(n,r,a);return eR.set(i,o),o}function eW(e,t){let n;if(V())throw ez.create("invalid-server-app-environment");void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1),n=ej(e)?e.options:e;let r=Object.assign(Object.assign({},t),n);if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw ez.create("finalization-registry-not-supported",{});let i=""+[...JSON.stringify(r)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),s=eP.get(i);if(s)return s.incRefCount(t.releaseOnDeref),s;let a=new eo(i);for(let e of eO.values())a.addComponent(e);let o=new eK(n,t,i,a);return eP.set(i,o),o}function eQ(e=eN){let t=eR.get(e);if(!t&&e===eN&&L())return eH();if(!t)throw ez.create("no-app",{appName:e});return t}function eJ(){return Array.from(eR.values())}async function eY(e){let t=!1,n=e.name;eR.has(n)?(t=!0,eR.delete(n)):eP.has(n)&&0>=e.decRefCount()&&(eP.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function eX(e,t,n){var r;let i=null!=(r=eD[e])?r:e;n&&(i+=`-${n}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eA.warn(e.join(" "));return}eF(new ei(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function eZ(e,t){if(null!==e&&"function"!=typeof e)throw ez.create("invalid-log-argument");for(let n of el){let r=null;t&&t.level&&(r=eu[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:o[n].toLowerCase(),message:s,args:i,type:t.name})}}}function e0(e){el.forEach(t=>{t.setLogLevel(e)})}let e1="firebase-heartbeat-store",e2=null;function e5(){return e2||(e2=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=e_(a);return r&&a.addEventListener("upgradeneeded",e=>{r(e_(a.result),e.oldVersion,e.newVersion,e_(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(e1)}catch(e){console.warn(e)}}}).catch(e=>{throw ez.create("idb-open",{originalErrorMessage:e.message})})),e2}async function e3(e){try{let t=(await e5()).transaction(e1),n=await t.objectStore(e1).get(e6(e));return await t.done,n}catch(e){if(e instanceof K)eA.warn(e.message);else{let t=ez.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});eA.warn(t.message)}}}async function e4(e,t){try{let n=(await e5()).transaction(e1,"readwrite"),r=n.objectStore(e1);await r.put(t,e6(e)),await n.done}catch(e){if(e instanceof K)eA.warn(e.message);else{let t=ez.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});eA.warn(t.message)}}}function e6(e){return`${e.name}!${e.options.appId}`}class e8{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new e7(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=e9();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)!=null||(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)!=null))return this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=e9(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),te(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),te(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=D(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function e9(){return new Date().toISOString().substring(0,10)}class e7{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!G()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await e3(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return e4(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return e4(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function te(e){return D(JSON.stringify({version:2,heartbeats:e})).length}eF(new ei("platform-logger",e=>new ek(e),"PRIVATE")),eF(new ei("heartbeat",e=>new e8(e),"PRIVATE")),eX(eC,ex,""),eX(eC,ex,"esm2017"),eX("fire-js",""),e.s(["SDK_VERSION",()=>e$,"_DEFAULT_ENTRY_NAME",()=>eN,"_addComponent",()=>eL,"_addOrOverwriteComponent",()=>eM,"_apps",()=>eR,"_clearComponents",()=>eB,"_components",()=>eO,"_getProvider",()=>eU,"_isFirebaseApp",()=>ej,"_isFirebaseServerApp",()=>eq,"_registerComponent",()=>eF,"_removeServiceInstance",()=>eV,"_serverApps",()=>eP,"deleteApp",()=>eY,"getApp",()=>eQ,"getApps",()=>eJ,"initializeApp",()=>eH,"initializeServerApp",()=>eW,"onLog",()=>eZ,"registerVersion",()=>eX,"setLogLevel",()=>e0],112394),e.i(112394),e.s(["FirebaseError",()=>K,"SDK_VERSION",()=>e$,"_DEFAULT_ENTRY_NAME",()=>eN,"_addComponent",()=>eL,"_addOrOverwriteComponent",()=>eM,"_apps",()=>eR,"_clearComponents",()=>eB,"_components",()=>eO,"_getProvider",()=>eU,"_isFirebaseApp",()=>ej,"_isFirebaseServerApp",()=>eq,"_registerComponent",()=>eF,"_removeServiceInstance",()=>eV,"_serverApps",()=>eP,"deleteApp",()=>eY,"getApp",()=>eQ,"getApps",()=>eJ,"initializeApp",()=>eH,"initializeServerApp",()=>eW,"onLog",()=>eZ,"registerVersion",()=>eX,"setLogLevel",()=>e0],575059);var tt=e.i(575059);class tn{constructor(e,t){this._delegate=e,this.firebase=t,eL(e,new ei("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),eY(this._delegate)))}_getService(e,t=eN){var n;this._delegate.checkDestroyed();let r=this._delegate.container.getProvider(e);return r.isInitialized()||(null==(n=r.getComponent())?void 0:n.instantiationMode)!=="EXPLICIT"||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=eN){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){eL(this._delegate,e)}_addOrOverwriteComponent(e){eM(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}let tr=new $("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),ti=function e(){let t=function(e){let t={},n={__esModule:!0,initializeApp:function(r,i={}){let s=eH(r,i);if(W(t,s.name))return t[s.name];let a=new e(s,n);return t[s.name]=a,a},app:r,registerVersion:eX,setLogLevel:e0,onLog:eZ,apps:null,SDK_VERSION:e$,INTERNAL:{registerComponent:function(t){let i=t.name,s=i.replace("-compat","");if(eF(t)&&"PUBLIC"===t.type){let a=(e=r())=>{if("function"!=typeof e[s])throw tr.create("invalid-app-argument",{appName:i});return e[s]()};void 0!==t.serviceProps&&P(a,t.serviceProps),n[s]=a,e.prototype[s]=function(...e){return this._getService.bind(this,i).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[s]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:tt}};function r(e){if(!W(t,e=e||eN))throw tr.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map(e=>t[e])}}),r.App=e,n}(tn);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){P(t,e)},createSubscribe:ee,ErrorFactory:$,deepExtend:P}),t}(),ts=new ef("@firebase/app-compat");if(V()&&void 0!==self.firebase){ts.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);let e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&ts.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}eX("@firebase/app-compat","0.2.35",void 0),ti.registerVersion("firebase","10.12.2","app-compat");var ta=e.i(716657);function to(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let tl=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements."}},tu=new $("auth","Firebase",to()),th=new ef("@firebase/auth");function tc(e,...t){th.logLevel<=o.ERROR&&th.error(`Auth (${e$}): ${e}`,...t)}function td(e,...t){throw ty(e,...t)}function tf(e,...t){return ty(e,...t)}function tp(e,t,n){return new $("auth","Firebase",Object.assign(Object.assign({},to()),{[t]:n})).create(t,{appName:e.name})}function tm(e){return tp(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tg(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&td(e,"argument-error"),tp(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ty(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return tu.create(e,...t)}function tv(e,t,...n){if(!e)throw ty(t,...n)}function tw(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tc(t),Error(t)}function t_(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function tb(){return"http:"===tI()||"https:"===tI()}function tI(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class tT{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||tw(n),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(F())||q()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(tb()||j()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tE(e,t){var n,r;n=e.emulator,r="Emulator should always be set here",n||tw(r);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class tS{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void tw("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void tw("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void tw("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tC=new tT(3e4,6e4);function tx(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function tA(e,t,n,r,i={}){return tN(e,i,async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});let a=Y(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode),tS.fetch()(tR(e,e.config.apiHost,n,a),Object.assign({method:t,headers:o,referrerPolicy:"no-referrer"},i))})}async function tN(e,t,n){e._canInitEmulator=!1;let r=Object.assign(Object.assign({},tk),t);try{let t=new tP(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw tO(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,n]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw tO(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw tO(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw tO(e,"user-disabled",s);let a=r[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw tp(e,a,n);td(e,a)}}catch(t){if(t instanceof K)throw t;td(e,"network-request-failed",{message:String(t)})}}async function tD(e,t,n,r,i={}){let s=await tA(e,t,n,r,i);return"mfaPendingCredential"in s&&td(e,"multi-factor-auth-required",{_serverResponse:s}),s}function tR(e,t,n,r){let i=`${t}${n}?${r}`;return e.config.emulator?tE(e.config,i):`${e.config.apiScheme}://${i}`}class tP{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tf(this.auth,"network-request-failed")),tC.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function tO(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=tf(e,t,r);return i.customData._tokenResponse=n,i}function tL(e){return void 0!==e&&void 0!==e.getResponse}function tM(e){return void 0!==e&&void 0!==e.enterprise}class tF{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function tU(e){return(await tA(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function tV(e,t){return tA(e,"GET","/v2/recaptchaConfig",tx(e,t))}async function tj(e,t){return tA(e,"POST","/v1/accounts:delete",t)}async function tq(e,t){return tA(e,"POST","/v1/accounts:update",t)}async function tB(e,t){return tA(e,"POST","/v1/accounts:lookup",t)}function tz(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function tG(e,t=!1){let n=er(e),r=await n.getIdToken(t),i=t$(r);tv(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:tz(tK(i.auth_time)),issuedAtTime:tz(tK(i.iat)),expirationTime:tz(tK(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function tK(e){return 1e3*Number(e)}function t$(e){let[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return tc("JWT malformed, contained fewer than 3 sections"),null;try{let e=R(n);if(!e)return tc("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tc("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function tH(e){let t=t$(e);return tv(t,"internal-error"),tv(void 0!==t.exp,"internal-error"),tv(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function tW(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof K&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tQ{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class tJ{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tz(this.lastLoginAt),this.creationTime=tz(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tY(e){var t,n,r;let i=e.auth,s=await e.getIdToken(),a=await tW(e,tB(i,{idToken:s}));tv(null==a?void 0:a.users.length,i,"internal-error");let o=a.users[0];e._notifyReloadListener(o);let l=(null==(t=o.providerUserInfo)?void 0:t.length)?tZ(o.providerUserInfo):[],u=(n=e.providerData,r=l,[...n.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),h=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!(null==u?void 0:u.length);Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:u,metadata:new tJ(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&c})}async function tX(e){let t=er(e);await tY(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function tZ(e){return e.map(e=>{var{providerId:t}=e,n=(0,ta.__rest)(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}async function t0(e,t){let n=await tN(e,{},async()=>{let n=Y({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=tR(e,r,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",tS.fetch()(s,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function t1(e,t){return tA(e,"POST","/v2/accounts:revokeToken",tx(e,t))}class t2{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tv(e.idToken,"internal-error"),tv(void 0!==e.idToken,"internal-error"),tv(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):tH(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tv(0!==e.length,"internal-error");let t=tH(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tv(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await t0(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new t2;return n&&(tv("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(tv("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(tv("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new t2,this.toJSON())}_performRefresh(){return tw("not implemented")}}function t5(e,t){tv("string"==typeof e||void 0===e,"internal-error",{appName:t})}class t3{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=(0,ta.__rest)(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tQ(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new tJ(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await tW(this,this.stsTokenManager.getToken(this.auth,e));return tv(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return tG(this,e)}reload(){return tX(this)}_assign(e){this!==e&&(tv(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new t3(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){tv(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await tY(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eq(this.auth.app))return Promise.reject(tm(this.auth));let e=await this.getIdToken();return await tW(this,tj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,a,o,l,u;let h=null!=(n=t.displayName)?n:void 0,c=null!=(r=t.email)?r:void 0,d=null!=(i=t.phoneNumber)?i:void 0,f=null!=(s=t.photoURL)?s:void 0,p=null!=(a=t.tenantId)?a:void 0,m=null!=(o=t._redirectEventId)?o:void 0,g=null!=(l=t.createdAt)?l:void 0,y=null!=(u=t.lastLoginAt)?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:b,stsTokenManager:I}=t;tv(v&&I,e,"internal-error");let T=t2.fromJSON(this.name,I);tv("string"==typeof v,e,"internal-error"),t5(h,e.name),t5(c,e.name),tv("boolean"==typeof w,e,"internal-error"),tv("boolean"==typeof _,e,"internal-error"),t5(d,e.name),t5(f,e.name),t5(p,e.name),t5(m,e.name),t5(g,e.name),t5(y,e.name);let E=new t3({uid:v,auth:e,email:c,emailVerified:w,displayName:h,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map(e=>Object.assign({},e))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){let r=new t2;r.updateFromServerResponse(t);let i=new t3({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await tY(i),i}static async _fromGetAccountInfoResponse(e,t,n){let r=t.users[0];tv(void 0!==r.localId,"internal-error");let i=void 0!==r.providerUserInfo?tZ(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null==i?void 0:i.length),a=new t2;a.updateFromIdToken(n);let o=new t3({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new tJ(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null==i?void 0:i.length)}),o}}let t4=new Map;function t6(e){var t,n;t="Expected a class definition",e instanceof Function||tw(t);let r=t4.get(e);return r?(n="Instance stored in cache mismatched with class",r instanceof e||tw(n)):(r=new e,t4.set(e,r)),r}class t8{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function t9(e,t,n){return`firebase:${e}:${t}:${n}`}t8.type="NONE";class t7{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=t9(this.userKey,r.apiKey,i),this.fullPersistenceKey=t9("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);return e?t3._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new t7(t6(t8),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||t6(t8),s=t9(n,e.config.apiKey,e.name),a=null;for(let n of t)try{let t=await n._get(s);if(t){let r=t3._fromJSON(e,t);n!==i&&(a=r),i=n;break}}catch(e){}let o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new t7(i,e,n)}}function ne(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(ni(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(nt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(na(t))return"Blackberry";if(no(t))return"Webos";if(nn(t))return"Safari";if((t.includes("chrome/")||nr(t))&&!t.includes("edge/"))return"Chrome";if(ns(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function nt(e=F()){return/firefox\//i.test(e)}function nn(e=F()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function nr(e=F()){return/crios\//i.test(e)}function ni(e=F()){return/iemobile/i.test(e)}function ns(e=F()){return/android/i.test(e)}function na(e=F()){return/blackberry/i.test(e)}function no(e=F()){return/webos/i.test(e)}function nl(e=F()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function nu(e=F()){return nl(e)||ns(e)||no(e)||na(e)||/windows phone/i.test(e)||ni(e)}function nh(e,t=[]){let n;switch(e){case"Browser":n=ne(F());break;case"Worker":n=`${ne(F())}-${e}`;break;default:n=e}let r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${e$}/${r}`}class nc{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function nd(e,t={}){return tA(e,"GET","/v2/passwordPolicy",tx(e,t))}class nf{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(r=null==(n=e.allowedNonAlphanumericCharacters)?void 0:n.join(""))?r:"",this.forceUpgradeOnSignin=null!=(i=e.forceUpgradeOnSignin)&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(n=o.meetsMaxPasswordLength)||n),o.isValid&&(o.isValid=null==(r=o.containsLowercaseLetter)||r),o.isValid&&(o.isValid=null==(i=o.containsUppercaseLetter)||i),o.isValid&&(o.isValid=null==(s=o.containsNumericCharacter)||s),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class np{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nm(this),this.idTokenSubscription=new nm(this),this.beforeStateQueue=new nc(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=t6(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted){if(this.persistenceManager=await t7.create(this,e),!this._deleted){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(r=this.currentUser)?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await tB(this,{idToken:e}),n=await t3._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(eq(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let n=await this.assertedPersistence.getCurrentUser(),r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,a=await this.tryRedirectSignIn(e);(!n||n===s)&&(null==a?void 0:a.user)&&(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(tv(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tY(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eq(this.app))return Promise.reject(tm(this));let t=e?er(e):null;return t&&tv(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tv(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eq(this.app)?Promise.reject(tm(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eq(this.app)?Promise.reject(tm(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(t6(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new nf(await nd(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new $("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await t1(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&t6(e)||this._popupRedirectResolver;tv(t,this,"argument-error"),this.redirectPersistenceManager=await t7.create(this,[t6(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(tv(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tv(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){th.logLevel<=o.WARN&&th.warn(`Auth (${e$}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}class nm{constructor(e){this.auth=e,this.observer=null,this.addObserver=ee(e=>this.observer=e)}get next(){return tv(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ng={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ny(e){return ng.loadJS(e)}function nv(e){return`__${e}${Math.floor(1e6*Math.random())}`}class nw{constructor(e){this.type="recaptcha-enterprise",this.auth=er(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{tV(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new tF(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;tM(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&tM(window.grecaptcha))r(n,e,i);else{if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=ng.recaptchaEnterpriseScript;0!==t.length&&(t+=n),ny(t).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function n_(e,t,n,r=!1){let i,s=new nw(e);try{i=await s.verify(n)}catch(e){i=await s.verify(n,!0)}let a=Object.assign({},t);return r?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function nb(e,t,n,r){var i;if(null==(i=e._getRecaptchaConfig())||!i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await n_(e,t,n,"getOobCode"===n);return r(e,i)}});{let i=await n_(e,t,n,"getOobCode"===n);return r(e,i)}}function nI(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nT(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class nE{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return tw("not implemented")}_getIdTokenResponse(e){return tw("not implemented")}_linkToIdToken(e,t){return tw("not implemented")}_getReauthenticationResolver(e){return tw("not implemented")}}async function nS(e,t){return tA(e,"POST","/v1/accounts:resetPassword",tx(e,t))}async function nk(e,t){return tA(e,"POST","/v1/accounts:update",t)}async function nC(e,t){return tA(e,"POST","/v1/accounts:signUp",t)}async function nx(e,t){return tA(e,"POST","/v1/accounts:update",tx(e,t))}async function nA(e,t){return tD(e,"POST","/v1/accounts:signInWithPassword",tx(e,t))}async function nN(e,t){return tA(e,"POST","/v1/accounts:sendOobCode",tx(e,t))}async function nD(e,t){return nN(e,t)}async function nR(e,t){return nN(e,t)}async function nP(e,t){return nN(e,t)}async function nO(e,t){return nN(e,t)}async function nL(e,t){return tD(e,"POST","/v1/accounts:signInWithEmailLink",tx(e,t))}async function nM(e,t){return tD(e,"POST","/v1/accounts:signInWithEmailLink",tx(e,t))}class nF extends nE{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new nF(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new nF(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nb(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nA);case"emailLink":return nL(e,{email:this._email,oobCode:this._password});default:td(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nb(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nC);case"emailLink":return nM(e,{idToken:t,email:this._email,oobCode:this._password});default:td(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function nU(e,t){return tD(e,"POST","/v1/accounts:signInWithIdp",tx(e,t))}class nV extends nE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new nV(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):td("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=(0,ta.__rest)(t,["providerId","signInMethod"]);if(!n||!r)return null;let s=new nV(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return nU(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,nU(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nU(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Y(t)}return e}}async function nj(e,t){return tA(e,"POST","/v1/accounts:sendVerificationCode",tx(e,t))}async function nq(e,t){return tD(e,"POST","/v1/accounts:signInWithPhoneNumber",tx(e,t))}async function nB(e,t){let n=await tD(e,"POST","/v1/accounts:signInWithPhoneNumber",tx(e,t));if(n.temporaryProof)throw tO(e,"account-exists-with-different-credential",n);return n}let nz={USER_NOT_FOUND:"user-not-found"};async function nG(e,t){return tD(e,"POST","/v1/accounts:signInWithPhoneNumber",tx(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),nz)}class nK extends nE{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new nK({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new nK({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return nq(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return nB(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return nG(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new nK({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class n${constructor(e){var t,n,r,i,s,a;const o=X(Z(e)),l=null!=(t=o.apiKey)?t:null,u=null!=(n=o.oobCode)?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(r=o.mode)?r:null);tv(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=null!=(i=o.continueUrl)?i:null,this.languageCode=null!=(s=o.languageCode)?s:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){let t,n,r,i=(n=(t=X(Z(e)).link)?X(Z(t)).deep_link_id:null,((r=X(Z(e)).deep_link_id)?X(Z(r)).link:null)||r||n||t||e);try{return new n$(i)}catch(e){return null}}}class nH{constructor(){this.providerId=nH.PROVIDER_ID}static credential(e,t){return nF._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=n$.parseLink(t);return tv(n,"argument-error"),nF._fromEmailAndCode(e,n.code,n.tenantId)}}nH.PROVIDER_ID="password",nH.EMAIL_PASSWORD_SIGN_IN_METHOD="password",nH.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class nW{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class nQ extends nW{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nJ extends nQ{static credentialFromJSON(e){let t="string"==typeof e?JSON.parse(e):e;return tv("providerId"in t&&"signInMethod"in t,"argument-error"),nV._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return tv(e.idToken||e.accessToken,"argument-error"),nV._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return nJ.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return nJ.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!n&&!r&&!t&&!i||!a)return null;try{return new nJ(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class nY extends nQ{constructor(){super("facebook.com")}static credential(e){return nV._fromParams({providerId:nY.PROVIDER_ID,signInMethod:nY.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nY.credentialFromTaggedObject(e)}static credentialFromError(e){return nY.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nY.credential(e.oauthAccessToken)}catch(e){return null}}}nY.FACEBOOK_SIGN_IN_METHOD="facebook.com",nY.PROVIDER_ID="facebook.com";class nX extends nQ{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return nV._fromParams({providerId:nX.PROVIDER_ID,signInMethod:nX.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nX.credentialFromTaggedObject(e)}static credentialFromError(e){return nX.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return nX.credential(t,n)}catch(e){return null}}}nX.GOOGLE_SIGN_IN_METHOD="google.com",nX.PROVIDER_ID="google.com";class nZ extends nQ{constructor(){super("github.com")}static credential(e){return nV._fromParams({providerId:nZ.PROVIDER_ID,signInMethod:nZ.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nZ.credentialFromTaggedObject(e)}static credentialFromError(e){return nZ.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nZ.credential(e.oauthAccessToken)}catch(e){return null}}}nZ.GITHUB_SIGN_IN_METHOD="github.com",nZ.PROVIDER_ID="github.com";class n0 extends nE{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return nU(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,nU(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nU(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){let{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new n0(t,r):null}static _create(e,t){return new n0(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class n1 extends nW{constructor(e){tv(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return n1.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return n1.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){let t=n0.fromJSON(e);return tv(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return n0._create(n,t)}catch(e){return null}}}class n2 extends nQ{constructor(){super("twitter.com")}static credential(e,t){return nV._fromParams({providerId:n2.PROVIDER_ID,signInMethod:n2.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return n2.credentialFromTaggedObject(e)}static credentialFromError(e){return n2.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return n2.credential(t,n)}catch(e){return null}}}async function n5(e,t){return tD(e,"POST","/v1/accounts:signUp",tx(e,t))}n2.TWITTER_SIGN_IN_METHOD="twitter.com",n2.PROVIDER_ID="twitter.com";class n3{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new n3({user:await t3._fromIdTokenResponse(e,n,r),providerId:n4(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new n3({user:e,providerId:n4(n),_tokenResponse:n,operationType:t})}}function n4(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function n6(e){var t;if(eq(e.app))return Promise.reject(tm(e));let n=er(e);if(await n._initializationPromise,null==(t=n.currentUser)?void 0:t.isAnonymous)return new n3({user:n.currentUser,providerId:null,operationType:"signIn"});let r=await n5(n,{returnSecureToken:!0}),i=await n3._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}class n8 extends K{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,n8.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new n8(e,t,n,r)}}function n9(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw n8._fromErrorAndOperation(e,n,t,r);throw n})}function n7(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function re(e,t){let n=er(e);await rn(!0,n,t);let{providerUserInfo:r}=await tq(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=n7(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function rt(e,t,n=!1){let r=await tW(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return n3._forOperation(e,"link",r)}async function rn(e,t,n){await tY(t),tv(n7(t.providerData).has(n)===e,t.auth,!1===e?"provider-already-linked":"no-such-provider")}async function rr(e,t,n=!1){let{auth:r}=e;if(eq(r.app))return Promise.reject(tm(r));let i="reauthenticate";try{let s=await tW(e,n9(r,i,t,e),n);tv(s.idToken,r,"internal-error");let a=t$(s.idToken);tv(a,r,"internal-error");let{sub:o}=a;return tv(e.uid===o,r,"user-mismatch"),n3._forOperation(e,i,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&td(r,"user-mismatch"),e}}async function ri(e,t,n=!1){if(eq(e.app))return Promise.reject(tm(e));let r="signIn",i=await n9(e,r,t),s=await n3._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function rs(e,t){return ri(er(e),t)}async function ra(e,t){let n=er(e);return await rn(!1,n,t.providerId),rt(n,t)}async function ro(e,t){return rr(er(e),t)}async function rl(e,t){return tD(e,"POST","/v1/accounts:signInWithCustomToken",tx(e,t))}async function ru(e,t){if(eq(e.app))return Promise.reject(tm(e));let n=er(e),r=await rl(n,{token:t,returnSecureToken:!0}),i=await n3._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class rh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?rc._fromServerResponse(e,t):"totpInfo"in t?rd._fromServerResponse(e,t):td(e,"internal-error")}}class rc extends rh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new rc(t)}}class rd extends rh{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new rd(t)}}function rf(e,t,n){var r;tv((null==(r=n.url)?void 0:r.length)>0,e,"invalid-continue-uri"),tv(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(tv(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(tv(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function rp(e){let t=er(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function rm(e,t,n){let r=er(e),i={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&rf(r,i,n),await nb(r,i,"getOobCode",nR)}async function rg(e,t,n){await nS(er(e),{oobCode:t,newPassword:n}).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rp(e),t})}async function ry(e,t){await nx(er(e),{oobCode:t})}async function rv(e,t){let n=er(e),r=await nS(n,{oobCode:t}),i=r.requestType;switch(tv(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":tv(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":tv(r.mfaInfo,n,"internal-error");default:tv(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=rh._fromServerResponse(er(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function rw(e,t){let{data:n}=await rv(er(e),t);return n.email}async function r_(e,t,n){if(eq(e.app))return Promise.reject(tm(e));let r=er(e),i=nb(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",n5),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rp(e),t}),a=await n3._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(a.user),a}async function rb(e,t,n){let r=er(e),i={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};tv(n.handleCodeInApp,r,"argument-error"),n&&rf(r,i,n),await nb(r,i,"getOobCode",nP)}async function rI(e,t,n){if(eq(e.app))return Promise.reject(tm(e));let r=er(e),i=nH.credentialWithLink(t,n||t_());return tv(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),rs(r,i)}async function rT(e,t){return tA(e,"POST","/v1/accounts:createAuthUri",tx(e,t))}async function rE(e,t){let n=tb()?t_():"http://localhost",{signinMethods:r}=await rT(er(e),{identifier:t,continueUri:n});return r||[]}async function rS(e,t){let n=er(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&rf(n.auth,r,t);let{email:i}=await nD(n.auth,r);i!==e.email&&await e.reload()}async function rk(e,t,n){let r=er(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&rf(r.auth,i,n);let{email:s}=await nO(r.auth,i);s!==e.email&&await e.reload()}async function rC(e,t){return tA(e,"POST","/v1/accounts:update",t)}async function rx(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;let r=er(e),i=await r.getIdToken(),s=await tW(r,rC(r.auth,{idToken:i,displayName:t,photoUrl:n,returnSecureToken:!0}));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;let a=r.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}async function rA(e,t,n){let{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);let s=await tW(e,nk(r,i));await e._updateTokensIfNecessary(s,!0)}class rN{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class rD extends rN{constructor(e,t,n,r){super(e,t,n),this.username=r}}class rR extends rN{constructor(e,t){super(e,"facebook.com",t)}}class rP extends rD{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class rO extends rN{constructor(e,t){super(e,"google.com",t)}}class rL extends rD{constructor(e,t,n){super(e,"twitter.com",t,n)}}class rM{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new rM("enroll",e,t)}static _fromMfaPendingCredential(e){return new rM("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null==(t=e.multiFactorSession)?void 0:t.pendingCredential)return rM._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);else if(null==(n=e.multiFactorSession)?void 0:n.idToken)return rM._fromIdtoken(e.multiFactorSession.idToken)}return null}}class rF{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){let n=er(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map(e=>rh._fromServerResponse(n,e));tv(r.mfaPendingCredential,n,"internal-error");let s=rM._fromMfaPendingCredential(r.mfaPendingCredential);return new rF(s,i,async e=>{let i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;let a=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let o=await n3._fromIdTokenResponse(n,t.operationType,a);return await n._updateCurrentUser(o.user),o;case"reauthenticate":return tv(t.user,n,"internal-error"),n3._forOperation(t.user,t.operationType,a);default:td(n,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class rU{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>rh._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new rU(e)}async getSession(){return rM._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let n=await this.getSession(),r=await tW(this.user,e._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{var r,i;let e=await tW(this.user,(r=this.user.auth,i={idToken:n,mfaEnrollmentId:t},tA(r,"POST","/v2/accounts/mfaEnrollment:withdraw",tx(r,i))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}let rV=new WeakMap,rj="__sak";class rq{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(rj,"1"),this.storage.removeItem(rj),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rB extends rq{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){let e=F();return nn(e)||nl(e)}()&&function(){try{return!!(window&&window!==window.top)}catch(e){return!1}}(),this.fallbackToPolling=nu(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){let r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}let r=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);B()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rB.type="LOCAL";class rz extends rq{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rz.type="SESSION";class rG{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new rG(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:r}=e.data,i=this.handlersMap[n];if(!(null==i?void 0:i.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(i).map(async t=>t(e.origin,r)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rK(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}rG.receivers=[];class r${constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=rK("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(e.data.response);break;default:clearTimeout(u),clearTimeout(r),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function rH(){return window}function rW(){return void 0!==rH().WorkerGlobalScope&&"function"==typeof rH().importScripts}async function rQ(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let rJ="firebaseLocalStorageDb",rY="firebaseLocalStorage",rX="fbase_key";class rZ{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function r0(e,t){return e.transaction([rY],t?"readwrite":"readonly").objectStore(rY)}function r1(){let e=indexedDB.open(rJ,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(rY,{keyPath:rX})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(rY)?t(n):(n.close(),await new rZ(indexedDB.deleteDatabase(rJ)).toPromise(),t(await r1()))})})}async function r2(e,t,n){return new rZ(r0(e,!0).put({[rX]:t,value:n})).toPromise()}async function r5(e,t){let n=r0(e,!1).get(t),r=await new rZ(n).toPromise();return void 0===r?null:r.value}function r3(e,t){return new rZ(r0(e,!0).delete(t)).toPromise()}class r4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await r1()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rW()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rG._getInstance(rW()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await rQ(),!this.activeServiceWorker)return;this.sender=new r$(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null==(e=n[0])?void 0:e.fulfilled)&&(null==(t=n[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await r1();return await r2(e,rj,"1"),await r3(e,rj),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>r2(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>r5(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>r3(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new rZ(r0(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}r4.type="LOCAL";class r6{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){let n=this.counter;return this._widgets.set(n,new r8(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;let n=e||1e12;null==(t=this._widgets.get(n))||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null==(t=this._widgets.get(e||1e12))?void 0:t.getResponse())||""}async execute(e){var t;return null==(t=this._widgets.get(e||1e12))||t.execute(),""}}class r8{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;tv(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){let t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);let{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw Error("reCAPTCHA mock was already deleted!")}}let r9=nv("rcb"),r7=new tT(3e4,6e4);class ie{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null==(e=rH().grecaptcha)?void 0:e.render)}load(e,t=""){var n;return(tv((n=t).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n),e,"argument-error"),this.shouldResolveImmediately(t)&&tL(rH().grecaptcha))?Promise.resolve(rH().grecaptcha):new Promise((n,r)=>{let i=rH().setTimeout(()=>{r(tf(e,"network-request-failed"))},r7.get());rH()[r9]=()=>{rH().clearTimeout(i),delete rH()[r9];let s=rH().grecaptcha;if(!s||!tL(s))return void r(tf(e,"internal-error"));let a=s.render;s.render=(e,t)=>{let n=a(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},ny(`${ng.recaptchaV2Script}?${Y({onload:r9,render:"explicit",hl:t})}`).catch(()=>{clearTimeout(i),r(tf(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(null==(t=rH().grecaptcha)?void 0:t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class it{async load(e){return new r6(e)}clearedOneInstance(){}}let ir="recaptcha",ii={theme:"light",type:"image"};class is{constructor(e,t,n=Object.assign({},ii)){this.parameters=n,this.type=ir,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=er(e),this.isInvisible="invisible"===this.parameters.size,tv("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof t?document.getElementById(t):t;tv(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new it:new ie,this.validateStartingState()}async verify(){this.assertNotDestroyed();let e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise(n=>{let r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){tv(!this.parameters.sitekey,this.auth,"argument-error"),tv(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),tv("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof e)e(t);else if("string"==typeof e){let n=rH()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){tv(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){let t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){let e;tv(tb()&&!rW(),this.auth,"internal-error"),await (e=null,new Promise(t=>{"complete"===document.readyState?t():(e=()=>t(),window.addEventListener("load",e))}).catch(t=>{throw e&&window.removeEventListener("load",e),t})),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);let t=await tU(this.auth);tv(t,this.auth,"internal-error"),this.parameters.sitekey=t}getAssertedRecaptcha(){return tv(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class ia{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){let t=nK._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function io(e,t,n){if(eq(e.app))return Promise.reject(tm(e));let r=er(e);return new ia(await ih(r,t,er(n)),e=>rs(r,e))}async function il(e,t,n){let r=er(e);return await rn(!1,r,"phone"),new ia(await ih(r.auth,t,er(n)),e=>ra(r,e))}async function iu(e,t,n){let r=er(e);return eq(r.auth.app)?Promise.reject(tm(r.auth)):new ia(await ih(r.auth,t,er(n)),e=>ro(r,e))}async function ih(e,t,n){var r,i,s;let a=await n.verify();try{let o;if(tv("string"==typeof a,e,"argument-error"),tv(n.type===ir,e,"argument-error"),o="string"==typeof t?{phoneNumber:t}:t,"session"in o){let t=o.session;if("phoneNumber"in o)return tv("enroll"===t.type,e,"internal-error"),(await (i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:o.phoneNumber,recaptchaToken:a}},tA(e,"POST","/v2/accounts/mfaEnrollment:start",tx(e,i)))).phoneSessionInfo.sessionInfo;{tv("signin"===t.type,e,"internal-error");let n=(null==(r=o.multiFactorHint)?void 0:r.uid)||o.multiFactorUid;return tv(n,e,"missing-multi-factor-info"),(await (s={mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:a}},tA(e,"POST","/v2/accounts/mfaSignIn:start",tx(e,s)))).phoneResponseInfo.sessionInfo}}{let{sessionInfo:t}=await nj(e,{phoneNumber:o.phoneNumber,recaptchaToken:a});return t}}finally{n._reset()}}async function ic(e,t){let n=er(e);if(eq(n.auth.app))return Promise.reject(tm(n.auth));await rt(n,t)}class id{constructor(e){this.providerId=id.PROVIDER_ID,this.auth=er(e)}verifyPhoneNumber(e,t){return ih(this.auth,e,er(t))}static credential(e,t){return nK._fromVerification(e,t)}static credentialFromResult(e){return id.credentialFromTaggedObject(e)}static credentialFromError(e){return id.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?nK._fromTokenResponse(t,n):null}}function ip(e,t){return t?t6(t):(tv(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}id.PROVIDER_ID="phone",id.PHONE_SIGN_IN_METHOD="phone";class im extends nE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return nU(e,this._buildIdpRequest())}_linkToIdToken(e,t){return nU(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return nU(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ig(e){return ri(e.auth,new im(e),e.bypassAuthState)}function iy(e){let{auth:t,user:n}=e;return tv(n,t,"internal-error"),rr(n,new im(e),e.bypassAuthState)}async function iv(e){let{auth:t,user:n}=e;return tv(n,t,"internal-error"),rt(n,new im(e),e.bypassAuthState)}class iw{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ig;case"linkViaPopup":case"linkViaRedirect":return iv;case"reauthViaPopup":case"reauthViaRedirect":return iy;default:td(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tw(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||tw(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let i_=new tT(2e3,1e4);async function ib(e,t,n){if(eq(e.app))return Promise.reject(tf(e,"operation-not-supported-in-this-environment"));let r=er(e);tg(e,t,nW);let i=ip(r,n);return new iE(r,"signInViaPopup",t,i).executeNotNull()}async function iI(e,t,n){let r=er(e);if(eq(r.auth.app))return Promise.reject(tf(r.auth,"operation-not-supported-in-this-environment"));tg(r.auth,t,nW);let i=ip(r.auth,n);return new iE(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}async function iT(e,t,n){let r=er(e);tg(r.auth,t,nW);let i=ip(r.auth,n);return new iE(r.auth,"linkViaPopup",t,i,r).executeNotNull()}class iE extends iw{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,iE.currentPopupAction&&iE.currentPopupAction.cancel(),iE.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tv(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||tw(t);let n=rK();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tf(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(tf(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,iE.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null==(n=null==(t=this.authWindow)?void 0:t.window)?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tf(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,i_.get())};e()}}iE.currentPopupAction=null;let iS=new Map;class ik extends iw{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=iS.get(this.auth._key());if(!e){try{let t=await iC(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}iS.set(this.auth._key(),e)}return this.bypassAuthState||iS.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function iC(e,t){let n=iD(t),r=iN(e);if(!await r._isAvailable())return!1;let i=await r._get(n)==="true";return await r._remove(n),i}async function ix(e,t){return iN(e)._set(iD(t),"true")}function iA(e,t){iS.set(e._key(),t)}function iN(e){return t6(e._redirectPersistence)}function iD(e){return t9("pendingRedirect",e.config.apiKey,e.name)}async function iR(e,t,n){if(eq(e.app))return Promise.reject(tm(e));let r=er(e);tg(e,t,nW),await r._initializationPromise;let i=ip(r,n);return await ix(i,r),i._openRedirect(r,t,"signInViaRedirect")}async function iP(e,t,n){let r=er(e);if(tg(r.auth,t,nW),eq(r.auth.app))return Promise.reject(tm(r.auth));await r.auth._initializationPromise;let i=ip(r.auth,n);await ix(i,r.auth);let s=await iF(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}async function iO(e,t,n){let r=er(e);tg(r.auth,t,nW),await r.auth._initializationPromise;let i=ip(r.auth,n);await rn(!1,r,t.providerId),await ix(i,r.auth);let s=await iF(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}async function iL(e,t){return await er(e)._initializationPromise,iM(e,t,!1)}async function iM(e,t,n=!1){if(eq(e.app))return Promise.reject(tm(e));let r=er(e),i=ip(r,t),s=new ik(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function iF(e){let t=rK(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class iU{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ij(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ij(e)){let r=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error";t.onError(tf(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(iV(e))}saveEventToCache(e){this.cachedEventUids.add(iV(e)),this.lastProcessedEventTime=Date.now()}}function iV(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ij({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function iq(e,t={}){return tA(e,"GET","/v1/projects",t)}let iB=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,iz=/^https?/;async function iG(e){if(e.config.emulator)return;let{authorizedDomains:t}=await iq(e);for(let e of t)try{if(function(e){let t=t_(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!iz.test(n))return!1;if(iB.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}(e))return}catch(e){}td(e,"unauthorized-domain")}let iK=new tT(3e4,6e4);function i$(){let e=rH().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let iH=null,iW=new tT(5e3,15e3),iQ={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},iJ=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function iY(e){let t,n,r,i,s,a=await (iH=iH||new Promise((t,n)=>{var r,i,s;function a(){i$(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{i$(),n(tf(e,"network-request-failed"))},timeout:iK.get()})}if(null==(i=null==(r=rH().gapi)?void 0:r.iframes)?void 0:i.Iframe)t(gapi.iframes.getContext());else if(null==(s=rH().gapi)?void 0:s.load)a();else{let t=nv("iframefcb");return rH()[t]=()=>{gapi.load?a():n(tf(e,"network-request-failed"))},ny(`${ng.gapiScript}?onload=${t}`).catch(e=>n(e))}}).catch(e=>{throw iH=null,e})),o=rH().gapi;return tv(o,e,"internal-error"),a.open({where:document.body,url:(tv((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?tE(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:e$},(i=iJ.get(e.config.apiHost))&&(r.eid=i),(s=e._getFrameworks()).length&&(r.fw=s.join(",")),`${n}?${Y(r).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:iQ,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=tf(e,"network-request-failed"),s=rH().setTimeout(()=>{r(i)},iW.get());function a(){rH().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{r(i)})}))}let iX={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class iZ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let i0=encodeURIComponent("fac");async function i1(e,t,n,r,i,s){tv(e.config.authDomain,e,"auth-domain-config-required"),tv(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:e$,eventId:i};if(t instanceof nW)for(let[n,r]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[n]=r;if(t instanceof nQ){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${i0}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?tE(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${Y(a).slice(1)}${l}`}let i2="webStorageSupport",i5=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rz,this._completeRedirectFn=iM,this._overrideRedirectResult=iA}async _openPopup(e,t,n,r){var i,s,a;s=null==(i=this.eventManagers[e._key()])?void 0:i.manager,a="_initialize() not called before _openPopup()",s||tw(a);let o=await i1(e,t,n,t_(),r);return function(e,t,n,r=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString(),o="",l=Object.assign(Object.assign({},iX),{width:r.toString(),height:i.toString(),top:s,left:a}),u=F().toLowerCase();n&&(o=nr(u)?"_blank":n),nt(u)&&(t=t||"http://localhost",l.scrollbars="yes");let h=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=F()){var t;return nl(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(u)&&"_self"!==o){var c,d;let e,n;return c=t||"",d=o,(e=document.createElement("a")).href=c,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new iZ(null)}let f=window.open(t||"",o,h);tv(f,e,"popup-blocked");try{f.focus()}catch(e){}return new iZ(f)}(e,o,rK())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=await i1(e,t,n,t_(),r),rH().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",r||tw(n),r)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await iY(e),n=new iU(e);return t.register("authEvent",t=>(tv(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(i2,{type:i2},n=>{var r;let i=null==(r=null==n?void 0:n[0])?void 0:r[i2];void 0!==i&&t(!!i),td(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=iG(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nu()||nn()||nl()}};class i3{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return tw("unexpected MultiFactorSessionType")}}}class i4 extends i3{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new i4(e)}_finalizeEnroll(e,t,n){return tA(e,"POST","/v2/accounts/mfaEnrollment:finalize",tx(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return tA(e,"POST","/v2/accounts/mfaSignIn:finalize",tx(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class i6{constructor(){}static assertion(e){return i4._fromCredential(e)}}i6.FACTOR_ID="phone";var i8="@firebase/auth",i9="1.7.4";class i7{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tv(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function se(){return window}async function st(e,t,n){var r,i,s;let{BuildInfo:a}=se();i=t.sessionId,s="AuthEvent did not contain a session ID",i||tw(s);let o=await si(t.sessionId),l={};return nl()?l.ibi=a.packageName:ns()?l.apn=a.packageName:td(e,"operation-not-supported-in-this-environment"),a.displayName&&(l.appDisplayName=a.displayName),l.sessionId=o,i1(e,n,t.type,void 0,null!=(r=t.eventId)?r:void 0,l)}async function sn(e){let{BuildInfo:t}=se(),n={};nl()?n.iosBundleId=t.packageName:ns()?n.androidPackageName=t.packageName:td(e,"operation-not-supported-in-this-environment"),await iq(e,n)}async function sr(e,t,n){let{cordova:r}=se(),i=()=>{};try{await new Promise((s,a)=>{let o=null;function l(){var e;s();let t=null==(e=r.plugins.browsertab)?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){o||(o=window.setTimeout(()=>{a(tf(e,"redirect-cancelled-by-user"))},2e3))}function h(){(null==document?void 0:document.visibilityState)==="visible"&&u()}t.addPassiveListener(l),document.addEventListener("resume",u,!1),ns()&&document.addEventListener("visibilitychange",h,!1),i=()=>{t.removePassiveListener(l),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",h,!1),o&&window.clearTimeout(o)}})}finally{i()}}async function si(e){let t=function(e){var t,n;if(t=/[0-9a-zA-Z]+/.test(e),n="Can only convert alpha-numeric strings",t||tw(n),"undefined"!=typeof TextEncoder)return new TextEncoder().encode(e);let r=new Uint8Array(new ArrayBuffer(e.length));for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}null==(s=O())||s._authIdTokenMaxAge,ng={loadJS:e=>new Promise((t,n)=>{var r,i;let s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{let t=tf("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(null!=(i=null==(r=document.getElementsByTagName("head"))?void 0:r[0])?i:document).appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},a="Browser",eF(new ei("auth",(e,{options:t})=>{let n,r,i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:l,authDomain:u}=i.options;tv(l&&!l.includes(":"),"invalid-api-key",{appName:i.name});let h=new np(i,s,o,{apiKey:l,authDomain:u,clientPlatform:a,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nh(a)});return r=(Array.isArray(n=(null==t?void 0:t.persistence)||[])?n:[n]).map(t6),(null==t?void 0:t.errorMap)&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),eF(new ei("auth-internal",e=>new i7(er(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),eX(i8,i9,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(a)),eX(i8,i9,"esm2017");class ss extends iU{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}async function sa(e){let t=await t6(rB)._get(so(e));return t&&await t6(rB)._remove(so(e)),t}function so(e){return t9("authEvent",e.config.apiKey,e.name)}function sl(e){if(!(null==e?void 0:e.includes("?")))return{};let[t,...n]=e.split("?");return X(n.join("?"))}let su=class{constructor(){this._redirectPersistence=rz,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=iM,this._overrideRedirectResult=iA}async _initialize(e){let t=e._key(),n=this.eventManagers.get(t);return n||(n=new ss(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){td(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s,a,o,l,u,h,c,d,f;let p;tv("function"==typeof(null==(i=null==(p=se())?void 0:p.universalLinks)?void 0:i.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),tv(void 0!==(null==(s=null==p?void 0:p.BuildInfo)?void 0:s.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),tv("function"==typeof(null==(l=null==(o=null==(a=null==p?void 0:p.cordova)?void 0:a.plugins)?void 0:o.browsertab)?void 0:l.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),tv("function"==typeof(null==(c=null==(h=null==(u=null==p?void 0:p.cordova)?void 0:u.plugins)?void 0:h.browsertab)?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),tv("function"==typeof(null==(f=null==(d=null==p?void 0:p.cordova)?void 0:d.InAppBrowser)?void 0:f.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});let m=await this._initialize(e);await m.initialized(),m.resetRedirect(),iS.clear(),await this._originValidation(e);let g=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){let e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){let n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:tf(e,"no-auth-event")}}(e,n,r);await t6(rB)._set(so(e),g);let y=await st(e,g,t);return sr(e,m,await function(e){let{cordova:t}=se();return new Promise(n=>{t.plugins.browsertab.isAvailable(r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,!function(e=F()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_system":"_blank","location=yes"),n(i)})})}(y))}_isIframeWebStorageSupported(e,t){throw Error("Method not implemented.")}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=sn(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){let{universalLinks:n,handleOpenURL:r,BuildInfo:i}=se(),s=setTimeout(async()=>{await sa(e),t.onEvent(sh())},500),a=async n=>{clearTimeout(s);let r=await sa(e),i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r,i;let s,a,o,l,u=(a=(s=sl(i=t)).link?decodeURIComponent(s.link):void 0,o=sl(a).link,sl(l=s.deep_link_id?decodeURIComponent(s.deep_link_id):void 0).link||l||o||a||i);if(u.includes("/__/auth/callback")){let t=sl(u),i=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,s=null==(r=null==(n=null==i?void 0:i.code)?void 0:n.split("auth/"))?void 0:r[1],a=s?tf(s):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:u,postBody:null}}return null}(r,n.url)),t.onEvent(i||sh())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,a);let o=`${i.packageName.toLowerCase()}://`;se().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(o)&&a({url:e}),"function"==typeof r)try{r(e)}catch(e){console.error(e)}}}};function sh(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:tf("no-auth-event")}}function sc(){var e;return(null==(e=null==self?void 0:self.location)?void 0:e.protocol)||null}function sd(e=F()){return!!(("file:"===sc()||"ionic:"===sc()||"capacitor:"===sc())&&e.toLowerCase().match(/iphone|ipad|ipod|android/))}function sf(){try{let e=self.localStorage,t=rK();if(e){if(e.setItem(t,"1"),e.removeItem(t),function(e=F()){return B()&&(null==document?void 0:document.documentMode)===11||function(e=F()){return/Edge\/\d+/.test(e)}(e)}())return G();return!0}}catch(e){return sp()&&G()}return!1}function sp(){return"WorkerGlobalScope"in e.g&&"importScripts"in e.g}function sm(){return("http:"===sc()||"https:"===sc()||j()||sd())&&!(q()||U())&&sf()&&!sp()}function sg(){return sd()&&"undefined"!=typeof document}async function sy(){return!!sg()&&new Promise(e=>{let t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})}let sv={LOCAL:"local",NONE:"none",SESSION:"session"},sw="persistence";async function s_(e){await e._initializationPromise;let t=sb(),n=t9(sw,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function sb(){var e;try{return(null==(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}class sI{constructor(){this.browserResolver=t6(i5),this.cordovaResolver=t6(su),this.underlyingResolver=null,this._redirectPersistence=rz,this._completeRedirectFn=iM,this._overrideRedirectResult=iA}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return sg()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return tv(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;let e=await sy();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function sT(e){let t,{_tokenResponse:n}=e instanceof K?e.customData:e;if(!n)return null;if(!(e instanceof K)&&"temporaryProof"in n&&"phoneNumber"in n)return id.credentialFromResult(e);let r=n.providerId;if(!r||"password"===r)return null;switch(r){case"google.com":t=nX;break;case"facebook.com":t=nY;break;case"github.com":t=nZ;break;case"twitter.com":t=n2;break;default:let{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:l}=n;if(!s&&!a&&!i&&!o)return null;if(o)if(r.startsWith("saml."))return n0._create(r,o);else return nV._fromParams({providerId:r,signInMethod:r,pendingToken:o,idToken:i,accessToken:s});return new nJ(r).credential({idToken:i,accessToken:s,rawNonce:l})}return e instanceof K?t.credentialFromError(e):t.credentialFromResult(e)}function sE(e,t){return t.catch(t=>{throw t instanceof K&&function(e,t){var n,r;let i=null==(n=t.customData)?void 0:n._tokenResponse;if((null==t?void 0:t.code)==="auth/multi-factor-auth-required"){let n;t.resolver=new sk(e,(n=er(e),tv(t.customData.operationType,n,"argument-error"),tv(null==(r=t.customData._serverResponse)?void 0:r.mfaPendingCredential,n,"argument-error"),rF._fromError(n,t)))}else if(i){let e=sT(t);e&&(t.credential=e,t.tenantId=i.tenantId||void 0,t.email=i.email||void 0,t.phoneNumber=i.phoneNumber||void 0)}}(e,t),t}).then(e=>{let t=e.operationType,n=e.user;return{operationType:t,credential:sT(e),additionalUserInfo:function(e){let{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;let{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){let r=null==(n=null==(t=t$(e.idToken))?void 0:t.firebase)?void 0:n.sign_in_provider;if(r)return new rN(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new rR(s,i);case"github.com":return new rP(s,i);case"google.com":return new rO(s,i);case"twitter.com":return new rL(s,i,e.screenName||null);case"custom":case"anonymous":return new rN(s,null);default:return new rN(s,r,i)}}(n)}(e),user:sC.getOrCreate(n)}})}async function sS(e,t){let n=await t;return{verificationId:n.verificationId,confirm:t=>sE(e,n.confirm(t))}}class sk{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return sE(this.auth.unwrap(),this.resolver.resolveSignIn(e))}}class sC{constructor(e){this._delegate=e,this.multiFactor=function(e){let t=er(e);return rV.has(t)||rV.set(t,rU._fromUser(t)),rV.get(t)}(e)}static getOrCreate(e){return sC.USER_MAP.has(e)||sC.USER_MAP.set(e,new sC(e)),sC.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return sE(this.auth,ra(this._delegate,e))}async linkWithPhoneNumber(e,t){return sS(this.auth,il(this._delegate,e,t))}async linkWithPopup(e){return sE(this.auth,iT(this._delegate,e,sI))}async linkWithRedirect(e){return await s_(er(this.auth)),iO(this._delegate,e,sI)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return sE(this.auth,ro(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return sS(this.auth,iu(this._delegate,e,t))}reauthenticateWithPopup(e){return sE(this.auth,iI(this._delegate,e,sI))}async reauthenticateWithRedirect(e){return await s_(er(this.auth)),iP(this._delegate,e,sI)}sendEmailVerification(e){return rS(this._delegate,e)}async unlink(e){return await re(this._delegate,e),this}updateEmail(e){var t;let n;return t=this._delegate,eq((n=er(t)).auth.app)?Promise.reject(tm(n.auth)):rA(n,e,null)}updatePassword(e){var t;return t=this._delegate,rA(er(t),null,e)}updatePhoneNumber(e){return ic(this._delegate,e)}updateProfile(e){return rx(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return rk(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}sC.USER_MAP=new WeakMap;class sx{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:n}=e.options;tv(n,"invalid-api-key",{appName:e.name}),tv(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?sI:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){let n=function(e,t){let n=sb();if(!n)return[];let r=t9(sw,e,t);switch(n.getItem(r)){case sv.NONE:return[t8];case sv.LOCAL:return[r4,rz];case sv.SESSION:return[rz];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(r4)||n.push(r4),"undefined"!=typeof window)for(let e of[rB,rz])n.includes(e)||n.push(e);return n.includes(t8)||n.push(t8),n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(tl),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?sC.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){let r=er(e);tv(r._canInitEmulator,r,"emulator-config-failed"),tv(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let i=!!(null==n?void 0:n.disableWarnings),s=nI(t),{host:a,port:o}=function(e){let t=nI(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:nT(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:nT(t)}}}(t),l=null===o?"":`:${o}`;r.config.emulator={url:`${s}//${a}${l}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return ry(this._delegate,e)}checkActionCode(e){return rv(this._delegate,e)}confirmPasswordReset(e,t){return rg(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return sE(this._delegate,r_(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return rE(this._delegate,e)}isSignInWithEmailLink(e){let t;return this._delegate,(null==(t=n$.parseLink(e))?void 0:t.operation)==="EMAIL_SIGNIN"}async getRedirectResult(){tv(sm(),this._delegate,"operation-not-supported-in-this-environment");let e=await iL(this._delegate,sI);return e?sE(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){er(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){let{next:r,error:i,complete:s}=sA(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){let{next:r,error:i,complete:s}=sA(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return rb(this._delegate,e,t)}sendPasswordResetEmail(e,t){return rm(this._delegate,e,t||void 0)}async setPersistence(e){var t;let n;switch(t=this._delegate,(tv(Object.values(sv).includes(e),t,"invalid-persistence-type"),q())?tv(e!==sv.SESSION,t,"unsupported-persistence-type"):U()?tv(e===sv.NONE,t,"unsupported-persistence-type"):sp()?tv(e===sv.NONE||e===sv.LOCAL&&G(),t,"unsupported-persistence-type"):tv(e===sv.NONE||sf(),t,"unsupported-persistence-type"),e){case sv.SESSION:n=rz;break;case sv.LOCAL:n=await t6(r4)._isAvailable()?r4:rB;break;case sv.NONE:n=t8;break;default:return td("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(n)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return sE(this._delegate,n6(this._delegate))}signInWithCredential(e){return sE(this._delegate,rs(this._delegate,e))}signInWithCustomToken(e){return sE(this._delegate,ru(this._delegate,e))}signInWithEmailAndPassword(e,t){var n;return sE(this._delegate,(n=this._delegate,eq(n.app)?Promise.reject(tm(n)):rs(er(n),nH.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&rp(n),e})))}signInWithEmailLink(e,t){return sE(this._delegate,rI(this._delegate,e,t))}signInWithPhoneNumber(e,t){return sS(this._delegate,io(this._delegate,e,t))}async signInWithPopup(e){return tv(sm(),this._delegate,"operation-not-supported-in-this-environment"),sE(this._delegate,ib(this._delegate,e,sI))}async signInWithRedirect(e){return tv(sm(),this._delegate,"operation-not-supported-in-this-environment"),await s_(this._delegate),iR(this._delegate,e,sI)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return rw(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function sA(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);let i=r;return{next:e=>i(e&&sC.getOrCreate(e)),error:t,complete:n}}sx.Persistence=sv;class sN{constructor(){this.providerId="phone",this._delegate=new id(ti.auth().unwrap())}static credential(e,t){return id.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}sN.PHONE_SIGN_IN_METHOD=id.PHONE_SIGN_IN_METHOD,sN.PROVIDER_ID=id.PROVIDER_ID;ti.INTERNAL.registerComponent(new ei("auth-compat",e=>new sx(e.getProvider("app-compat").getImmediate(),e.getProvider("auth")),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:nH,FacebookAuthProvider:nY,GithubAuthProvider:nZ,GoogleAuthProvider:nX,OAuthProvider:nJ,SAMLAuthProvider:n1,PhoneAuthProvider:sN,PhoneMultiFactorGenerator:i6,RecaptchaVerifier:class e{constructor(e,t,n=ti.app()){var r;tv(null==(r=n.options)?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new is(n.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:n2,Auth:sx,AuthCredential:nE,Error:K}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ti.registerVersion("@firebase/auth-compat","0.5.9");var sD=e.i(801891),sR="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,sP={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478|0;a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[1]+0xe8c7b756|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[2]+0x242070db|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[3]+0xc1bdceee|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[4]+0xf57c0faf|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[5]+0x4787c62a|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[6]+0xa8304613|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[7]+0xfd469501|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[8]+0x698098d8|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[9]+0x8b44f7af|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[10]+0xffff5bb1|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[11]+0x895cd7be|0,a=t+(s^(n=i+(a<<22|a>>>10))&(i^s))+r[12]+0x6b901122|0,a=s+(i^(t=n+(a<<7|a>>>25))&(n^i))+r[13]+0xfd987193|0,a=i+(n^(s=t+(a<<12|a>>>20))&(t^n))+r[14]+0xa679438e|0,a=n+(t^(i=s+(a<<17|a>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(a<<22|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(a<<20|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,a=t+((n=i+(a<<20|a>>>12))^i^s)+r[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[11]+0x6d9d6122|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[14]+0xfde5380c|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[7]+0xf6bb4b60|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[10]+0xbebfbc70|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[3]+0xd4ef3085|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[6]+0x4881d05|0,a=t+((n=i+(a<<23|a>>>9))^i^s)+r[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^i)+r[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^n)+r[15]+0x1fa27cf8|0,a=n+((i=s+(a<<16|a>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(a<<23|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(a<<21|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=n;)r(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){r(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s,a={};function o(e){var t;return -128<=e&&128>e?(t=function(e){return new i([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],0>e?-1:0)}function h(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return g(h(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var c=o(0),d=o(1),f=o(0x1000000);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(d)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function w(e,t){this.g=e,this.h=t}function _(e,t){if(p(t))throw Error("division by zero");if(p(e))return new w(c,c);if(m(e))return t=_(g(e),t),new w(g(t.g),g(t.h));if(m(t))return t=_(e,g(t)),new w(g(t.g),t.h);if(30<e.g.length){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=b(n),r=b(r);var i=I(n,1),s=I(r,1);for(r=I(r,2),n=I(n,2);!p(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=I(r,1),n=I(n,1)}return t=y(e,i.j(t)),new w(i,t)}for(i=c;0<=e.l(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=h(n)).j(t);m(a)||0<a.l(e);)n-=r,a=(s=h(n)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new w(i,e)}function b(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function I(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],a=0;a<r;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(m(this))return-g(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);for(var t=h(Math.pow(e,6)),n=this,r="";;){var i=_(n,t).g,s=((0<(n=y(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return m(e=y(this,e))?-1:+!p(e)},s.abs=function(){return m(this)?g(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var a=r+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return c;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return h(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var a=this.i(r)>>>16,o=65535&this.i(r),l=e.i(s)>>>16,u=65535&e.i(s);n[2*r+2*s]+=o*u,v(n,2*r+2*s),n[2*r+2*s+1]+=a*u,v(n,2*r+2*s+1),n[2*r+2*s+1]+=o*l,v(n,2*r+2*s+1),n[2*r+2*s+2]+=a*l,v(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new i(n,0)},s.A=function(e){return _(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,u=sP.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.A,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=h,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return g(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=h(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=h(Math.pow(n,a)),i=i.j(a).add(h(o))):i=(i=i.j(r)).add(h(o))}return i},l=sP.Integer=i}).apply(void 0!==sR?sR:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var sO="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,sL={};(function(){var e,t,n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},i=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof sO&&sO];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=i;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in n))break e;n=n[a]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,r,i;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,r=!1,(i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return i},i}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function l(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function u(e,t,n){return e.call.apply(e.bind,arguments)}function w(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function _(e,t,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?u:w).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function I(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function T(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function E(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(o(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function S(e){return/^[\s\xa0]*$/.test(e)}function k(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function C(e){return C[" "](e),e}C[" "]=function(){};var x=-1!=k().indexOf("Gecko")&&(-1==k().toLowerCase().indexOf("webkit")||-1!=k().indexOf("Edge"))&&-1==k().indexOf("Trident")&&-1==k().indexOf("MSIE")&&-1==k().indexOf("Edge");function A(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function N(e){let t={};for(let n in e)t[n]=e[n];return t}let D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<D.length;t++)n=D[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}var P=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new O,e=>e.reset());class O{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let L,M=!1,F=new class{constructor(){this.h=this.g=null}add(e,t){let n=P.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},U=()=>{let e=a.Promise.resolve(void 0);L=()=>{e.then(V)}};var V=()=>{let e;for(var t;e=null,F.g&&(e=F.g,F.g=F.g.next,F.g||(F.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}P.j(t),100>P.h&&(P.h++,t.next=P.g,P.g=t)}M=!1};function j(){this.s=this.s,this.C=this.C}function q(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.s=!1,j.prototype.ma=function(){this.s||(this.s=!0,this.N())},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},q.prototype.h=function(){this.defaultPrevented=!0};var B=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function z(e,t){if(q.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(x){e:{try{C(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:G[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.aa.h.call(this)}}I(z,q);var G={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),$=0;function H(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++$,this.da=this.fa=!1}function W(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Q(e){this.src=e,this.g={},this.h=0}function J(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(W(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Y(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}Q.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=Y(e,t,r,i);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new H(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var X="closure_lm_"+(1e6*Math.random()|0),Z={};function ee(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=l(i)?!!i.capture:!!i,o=ei(e);if(o||(e[X]=o=new Q(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return er.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)B||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(en(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function et(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[K])J(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(en(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ei(t))?(J(n,e),0==n.h&&(n.src=null,t[X]=null)):W(e)}}}function en(e){return e in Z?Z[e]:Z[e]="on"+e}function er(e,t){if(e.da)e=!0;else{t=new z(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&et(e),e=n.call(r,t)}return e}function ei(e){return(e=e[X])instanceof Q?e:null}var es="__closure_events_fn_"+(1e9*Math.random()>>>0);function ea(e){return"function"==typeof e?e:(e[es]||(e[es]=function(t){return e.handleEvent(t)}),e[es])}function eo(){j.call(this),this.i=new Q(this),this.M=this,this.F=null}function el(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new q(t,e);else if(t instanceof q)t.target=t.target||e;else{var i=t;R(t=new q(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=eu(a,r,!0,t)&&i}if(i=eu(a=t.g=e,r,!0,t)&&i,i=eu(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=eu(a=t.g=n[s],r,!1,t)&&i}function eu(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&J(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function eh(e,t,n){if("function"==typeof e)n&&(e=_(e,n));else if(e&&"function"==typeof e.handleEvent)e=_(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:a.setTimeout(e,t||0)}I(eo,j),eo.prototype[K]=!0,eo.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=l(i)?!!i.capture:!!i,r=ea(r),t&&t[K])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Y(a=t.g[n],r,i,s))&&(W(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=ei(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Y(n,r,i,s)),(r=-1<t?n[t]:null)&&et(r))}(this,e,t,n,r)},eo.prototype.N=function(){if(eo.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)W(n[r]);delete t.g[e],t.h--}}this.F=null},eo.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},eo.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ec extends j{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eh(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ed(e){j.call(this),this.h=e,this.g={}}I(ed,j);var ef=[];function ep(e){A(e.g,function(e,t){this.g.hasOwnProperty(t)&&et(e)},e),e.g={}}ed.prototype.N=function(){ed.aa.N.call(this),ep(this)},ed.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var em=a.JSON.stringify,eg=a.JSON.parse,ey=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ev(){}function ew(e){return e.h||(e.h=e.i())}function e_(){}ev.prototype.h=null;var eb={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eI(){q.call(this,"d")}function eT(){q.call(this,"c")}I(eI,q),I(eT,q);var eE={},eS=null;function ek(){return eS=eS||new eo}function eC(e){q.call(this,eE.La,e)}function ex(e){let t=ek();el(t,new eC(t))}function eA(e,t){q.call(this,eE.STAT_EVENT,e),this.stat=t}function eN(e){let t=ek();el(t,new eA(t,e))}function eD(e,t){q.call(this,eE.Ma,e),this.size=t}function eR(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eP(){this.g=!0}function eO(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return em(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eE.La="serverreachability",I(eC,q),eE.STAT_EVENT="statevent",I(eA,q),eE.Ma="timingevent",I(eD,q),eP.prototype.xa=function(){this.g=!1},eP.prototype.info=function(){};var eL={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eM={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eF(){}function eU(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ed(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eV}function eV(){this.i=null,this.g="",this.h=!1}I(eF,ev),eF.prototype.g=function(){return new XMLHttpRequest},eF.prototype.i=function(){return{}},t=new eF;var ej={},eq={};function eB(e,t,n){e.L=1,e.v=tr(e9(t)),e.m=n,e.P=!0,ez(e,null)}function ez(e,t){e.F=Date.now(),eK(e),e.A=e9(e.v);var n,r,i,s,a,o,u=e.A,h=e.R;Array.isArray(h)||(h=[String(h)]),tg(u.i,"t",h),e.C=0,u=e.j.J,e.h=new eV,e.g=t2(e.j,u?t:null,!e.m),0<e.O&&(e.M=new ec(_(e.Y,e,e.g),e.O)),t=e.U,u=e.g,h=e.ca;var c="readystatechange";Array.isArray(c)||(c&&(ef[0]=c.toString()),c=ef);for(var d=0;d<c.length;d++){var f=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ea(r),t&&t[K]?t.L(n,r,l(i)?!!i.capture:!!i,s):ee(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ea(r),t&&t[K]?t.K(n,r,l(i)?!!i.capture:!!i,s):ee(t,n,r,!1,i,s)}(u,c[d],h||t.handleEvent,!1,t.h||t);if(!f)break;t.g[f.key]=f}t=e.H?N(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),ex(),n=e.i,r=e.u,i=e.A,s=e.l,a=e.R,o=e.m,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var u=t[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");e=2<=c.length&&"type"==c[1]?e+(h+"=")+u+"&":e+(h+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+r+"\n"+i+"\n"+e})}function eG(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eK(e){e.S=Date.now()+e.I,e$(e,e.I)}function e$(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eR(_(e.ba,e),t)}function eH(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function eW(e){0==e.j.G||e.J||tY(e.j,e)}function eQ(e){eH(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ep(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eJ(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e1(n.h,e))){if(!e.K&&e1(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tJ(n),tj(n);else break e;tH(n),eN(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=eR(_(n.Za,n),6e3));if(1>=e0(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else tZ(n,11)}else if((e.K||n.g==e)&&tJ(n),!S(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let i=o[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e2(s,s.h),s.h=null))}if(r.D){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,tn(r.I,r.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(r=n).qa=t1(r,r.J?r.ia:null,r.W),e.K){e5(r.h,e);var a=r.L;a&&(e.I=a),e.B&&(eH(e),eK(e)),r.g=e}else t$(r);0<n.i.length&&tB(n)}else"stop"!=o[0]&&"close"!=o[0]||tZ(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tZ(n,7):tV(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}ex(4)}catch(e){}}eU.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tL(e)?t.j():this.Y(e)},eU.prototype.Y=function(e){try{if(e==this.g)e:{let v=tL(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tM(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?ex(3):ex(2)),eH(this);var n=this.g.Z();this.X=n;t:if(eG(this)){var r=tM(this.g);e="";var i=r.length,s=4==tL(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eQ(this),eW(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==i-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,l=this.i,u=this.u,h=this.A,c=this.l,d=this.R,f=n,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+d+"]: "+u+"\n"+h+"\n"+v+" "+f}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,u,h,c,d,f,p,m=this.g;if((p=m.g?m.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(p)){var g=p;break t}}g=null}if(n=g)eO(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eJ(this,n);else{this.o=!1,this.s=3,eN(12),eQ(this),eW(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eq:isNaN(n=Number(t.substring(n,r)))?ej:(r+=1)+n>t.length?eq:(t=t.slice(r,r+n),e.C=r+n,t)}(this,o))==eq){4==v&&(this.s=4,eN(14),n=!1),eO(this.i,this.l,null,"[Incomplete Response]");break}else if(e==ej){this.s=4,eN(15),eO(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}else eO(this.i,this.l,e,null),eJ(this,e);if(eG(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=o.length||this.h.h||(this.s=1,eN(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var y=this.j;y.g==this&&y.ba&&!y.M&&(y.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tW(y),y.M=!0,eN(11))}}else eO(this.i,this.l,o,"[Invalid Chunked Response]"),eQ(this),eW(this)}else eO(this.i,this.l,o,null),eJ(this,o);4==v&&eQ(this),this.o&&!this.J&&(4==v?tY(this.j,this):(this.o=!1,eK(this)))}else(function(e){let t={};e=(e.g&&2<=tL(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(S(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,eN(12)):(this.s=0,eN(13)),eQ(this),eW(this)}}}catch(e){}finally{}},eU.prototype.cancel=function(){this.J=!0,eQ(this)},eU.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(ex(),eN(17)),eQ(this),this.s=2,eW(this)):e$(this,this.S-n)};var eY=class{constructor(e,t){this.g=e,this.map=t}};function eX(e){this.l=e||10,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eZ(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e0(e){return e.h?1:e.g?e.g.size:0}function e1(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e2(e,t){e.g?e.g.add(t):e.h=t}function e5(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e3(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return T(e.i)}function e4(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(o(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}eX.prototype.cancel=function(){if(this.i=e3(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e6=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e8(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e8){this.h=e.h,e7(this,e.j),this.o=e.o,this.g=e.g,te(this,e.s),this.l=e.l;var t=e.i,n=new td;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tt(this,n),this.m=e.m}else e&&(t=String(e).match(e6))?(this.h=!1,e7(this,t[1]||"",!0),this.o=ti(t[2]||""),this.g=ti(t[3]||"",!0),te(this,t[4]),this.l=ti(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=ti(t[7]||"")):(this.h=!1,this.i=new td(null,this.h))}function e9(e){return new e8(e)}function e7(e,t,n){e.j=n?ti(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function te(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tt(e,t,n){var r,i;t instanceof td?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tf(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tp(this,t),tg(this,n,e))},r)),r.j=i):(n||(t=ts(t,th)),e.i=new td(t,e.h))}function tn(e,t,n){e.i.set(t,n)}function tr(e){return tn(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ti(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ts(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ta),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ta(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e8.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ts(t,to,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(ts(t,to,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ts(n,"/"==n.charAt(0)?tu:tl,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ts(n,tc)),e.join("")};var to=/[#\/\?@]/g,tl=/[#\?:]/g,tu=/[#\?]/g,th=/[#\?@]/g,tc=/#/g;function td(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tf(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tp(e,t){tf(e),t=ty(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tm(e,t){return tf(e),t=ty(e,t),e.g.has(t)}function tg(e,t,n){tp(e,t),0<n.length&&(e.i=null,e.g.set(ty(e,t),T(n)),e.h+=n.length)}function ty(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tv(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tw(){this.g=new ey}function t_(e){this.l=e.Ub||null,this.j=e.eb||!1}function tb(e,t){eo.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tI(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tT(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tE(e)}function tE(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tS(e){let t="";return A(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tk(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tS(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tn(e,t,n))}function tC(e){eo.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=td.prototype).add=function(e,t){tf(this),this.i=null,e=ty(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){tf(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},n.na=function(){tf(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},n.V=function(e){tf(this);let t=[];if("string"==typeof e)tm(this,e)&&(t=t.concat(this.g.get(ty(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return tf(this),this.i=null,tm(this,e=ty(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},I(t_,ev),t_.prototype.g=function(){return new tb(this.l,this.j)},t_.prototype.i=(e={},function(){return e}),I(tb,eo),(n=tb.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tE(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tT(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tE(this)),this.g&&(this.readyState=3,tE(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tI(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tT(this):tE(this),3==this.readyState&&tI(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tT(this))},n.Qa=function(e){this.g&&(this.response=e,tT(this))},n.ga=function(){this.g&&tT(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tb.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),I(tC,eo);var tx=/^https?$/i,tA=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tD(e),tP(e)}function tD(e){e.A||(e.A=!0,el(e,"complete"),el(e,"error"))}function tR(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tL(e)||2!=e.Z())){if(e.u&&4==tL(e))eh(e.Ea,0,e);else if(el(e,"readystatechange"),4==tL(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){var i=String(e.D).match(e6)[1]||null;!i&&a.self&&a.self.location&&(i=a.self.location.protocol.slice(0,-1)),n=!tx.test(i?i.toLowerCase():"")}t=n}if(t)el(e,"complete"),el(e,"success");else{e.m=6;try{var o=2<tL(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tD(e)}}finally{tP(e)}}}}function tP(e,t){if(e.g){tO(e);let n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||el(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function tO(e){e.I&&(a.clearTimeout(e.I),e.I=null)}function tL(e){return e.g?e.g.readyState:0}function tM(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tF(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tU(e){this.Aa=0,this.i=[],this.j=new eP,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tF("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tF("baseRetryDelayMs",5e3,e),this.cb=tF("retryDelaySeedMs",1e4,e),this.Wa=tF("forwardChannelMaxRetries",2,e),this.wa=tF("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eX(e&&e.concurrentRequestLimit),this.Da=new tw,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tV(e){if(tq(e),3==e.G){var t=e.U++,n=e9(e.I);if(tn(n,"SID",e.K),tn(n,"RID",t),tn(n,"TYPE","terminate"),tG(e,n),(t=new eU(e,e.j,t)).L=2,t.v=tr(e9(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.v,n=!0),n||(t.g=t2(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eK(t)}t0(e)}function tj(e){e.g&&(tW(e),e.g.cancel(),e.g=null)}function tq(e){tj(e),e.u&&(a.clearTimeout(e.u),e.u=null),tJ(e),e.h.cancel(),e.s&&("number"==typeof e.s&&a.clearTimeout(e.s),e.s=null)}function tB(e){if(!eZ(e.h)&&!e.s){e.s=!0;var t=e.Ga;L||U(),M||(L(),M=!0),F.add(t,e),e.B=0}}function tz(e,t){var n;n=t?t.l:e.U++;let r=e9(e.I);tn(r,"SID",e.K),tn(r,"RID",n),tn(r,"AID",e.T),tG(e,r),e.m&&e.o&&tk(r,e.m,e.o),n=new eU(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tK(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e2(e.h,n),eB(n,r,t)}function tG(e,t){e.H&&A(e.H,function(e,n){tn(t,n,e)}),e.l&&e4({},function(e,n){tn(t,n,e)})}function tK(e,t,n){n=Math.min(e.i.length,n);var r=e.l?_(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{e4(e,function(e,n){let i=e;l(e)&&(i=em(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),r}function t$(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;L||U(),M||(L(),M=!0),F.add(t,e),e.v=0}}function tH(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eR(_(e.Fa,e),tX(e,e.v)),e.v++,!0)}function tW(e){null!=e.A&&(a.clearTimeout(e.A),e.A=null)}function tQ(e){e.g=new eU(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e9(e.qa);tn(t,"RID","rpc"),tn(t,"SID",e.K),tn(t,"AID",e.T),tn(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tn(t,"TO",e.ja),tn(t,"TYPE","xmlhttp"),tG(e,t),e.m&&e.o&&tk(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=tr(e9(t)),n.m=null,n.P=!0,ez(n,e)}function tJ(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tY(e,t){var n,r=null;if(e.g==t){tJ(e),tW(e),e.g=null;var i=2}else{if(!e1(e.h,t))return;r=t.D,e5(e.h,t),i=1}if(0!=e.G){if(t.o)if(1==i){r=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;el(i=ek(),new eD(i,r)),tB(e)}else t$(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(n=t,!(e0(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eR(_(e.Ga,e,n),tX(e,e.B)),e.B++,!0)))||2==i&&tH(e)))switch(r&&0<r.length&&((t=e.h).i=t.i.concat(r)),s){case 1:tZ(e,5);break;case 4:tZ(e,10);break;case 3:tZ(e,6);break;default:tZ(e,2)}}}function tX(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function tZ(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var n,r=_(e.fb,e),i=e.Xa;let l=!i;i=new e8(i||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e7(i,"https"),tr(i),l?function(e,t){let n=new eP;if(a.Image){let r=new Image;r.onload=b(tv,n,"TestLoadImage: loaded",!0,t,r),r.onerror=b(tv,n,"TestLoadImage: error",!1,t,r),r.onabort=b(tv,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=b(tv,n,"TestLoadImage: timeout",!1,t,r),a.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eP,s=new AbortController,o=setTimeout(()=>{s.abort(),tv(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?tv(t,"TestPingServer: ok",!0,r):tv(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(o),tv(t,"TestPingServer: error",!1,r)}))}else eN(2);e.G=0,e.l&&e.l.sa(t),t0(e),tq(e)}function t0(e){if(e.G=0,e.ka=[],e.l){let t=e3(e.h);(0!=t.length||0!=e.i.length)&&(E(e.ka,t),E(e.ka,e.i),e.h.i.length=0,T(e.i),e.i.length=0),e.l.ra()}}function t1(e,t,n){var r=n instanceof e8?e9(n):new e8(n);if(""!=r.g)t&&(r.g=t+"."+r.g),te(r,r.s);else{var i=a.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new e8(null);r&&e7(s,r),t&&(s.g=t),i&&te(s,i),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&tn(r,n,t),tn(r,"VER",e.la),tG(e,r),r}function t2(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tC(e.Ca&&!e.pa?new t_({eb:n}):e.pa)).Ha(e.J),t}function t5(){}function t3(){}function t4(e,t){eo.call(this),this.g=new tU(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!S(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t9(this)}function t6(e){eI.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t8(){eT.call(this),this.status=1}function t9(e){this.g=e}(n=tC.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?ew(this.o):ew(t),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tN(this,e);return}if(e=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[t,o]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&e instanceof a.FormData,!(0<=Array.prototype.indexOf.call(tA,n,void 0))||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tO(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tN(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,el(this,"complete"),el(this,"abort"),tP(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tP(this,!0)),tC.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tR(this):this.bb())},n.bb=function(){tR(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tL(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tU.prototype).la=8,n.G=1,n.connect=function(e,t,n,r){eN(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=t1(this,null,this.W),tB(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let i=new eU(this,this.j,e),s=this.o;if(this.S&&(s?R(s=N(s),this.S):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tK(this,i,t),tn(n=e9(this.I),"RID",e),tn(n,"CVER",22),this.D&&tn(n,"X-HTTP-Session-Id",this.D),tG(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tS(s)))+"&"+t:this.m&&tk(n,this.m,s)),e2(this.h,i),this.Ua&&tn(n,"TYPE","init"),this.P?(tn(n,"$req",t),tn(n,"SID","null"),i.T=!0,eB(i,n,null)):eB(i,n,t),this.G=2}}else 3==this.G&&(e?tz(this,e):0==this.i.length||eZ(this.h)||tz(this))},n.Fa=function(){if(this.u=null,tQ(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eR(_(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eN(10),tj(this),tQ(this))},n.Za=function(){null!=this.C&&(this.C=null,tj(this),tH(this),eN(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eN(2)):(this.j.info("Failed to ping google.com"),eN(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t5.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t3.prototype.g=function(e,t){return new t4(e,t)},I(t4,eo),t4.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t4.prototype.close=function(){tV(this.g)},t4.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=em(e),e=n);t.i.push(new eY(t.Ya++,e)),3==t.G&&tB(t)},t4.prototype.N=function(){this.g.l=null,delete this.j,tV(this.g),delete this.g,t4.aa.N.call(this)},I(t6,eI),I(t8,eT),I(t9,t5),t9.prototype.ua=function(){el(this.g,"a")},t9.prototype.ta=function(e){el(this.g,new t6(e))},t9.prototype.sa=function(e){el(this.g,new t8)},t9.prototype.ra=function(){el(this.g,"b")},t3.prototype.createWebChannel=t3.prototype.g,t4.prototype.send=t4.prototype.o,t4.prototype.open=t4.prototype.m,t4.prototype.close=t4.prototype.close,v=sL.createWebChannelTransport=function(){return new t3},y=sL.getStatEventTarget=function(){return ek()},g=sL.Event=eE,m=sL.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eL.NO_ERROR=0,eL.TIMEOUT=8,eL.HTTP_ERROR=6,p=sL.ErrorCode=eL,eM.COMPLETE="complete",f=sL.EventType=eM,e_.EventType=eb,eb.OPEN="a",eb.CLOSE="b",eb.ERROR="c",eb.MESSAGE="d",eo.prototype.listen=eo.prototype.K,d=sL.WebChannel=e_,c=sL.FetchXmlHttpFactory=t_,tC.prototype.listenOnce=tC.prototype.L,tC.prototype.getLastError=tC.prototype.Ka,tC.prototype.getLastErrorCode=tC.prototype.Ba,tC.prototype.getStatus=tC.prototype.Z,tC.prototype.getResponseJson=tC.prototype.Oa,tC.prototype.getResponseText=tC.prototype.oa,tC.prototype.send=tC.prototype.ea,tC.prototype.setWithCredentials=tC.prototype.Ha,h=sL.XhrIo=tC}).apply(void 0!==sO?sO:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let sM="@firebase/firestore";class sF{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}sF.UNAUTHENTICATED=new sF(null),sF.GOOGLE_CREDENTIALS=new sF("google-credentials-uid"),sF.FIRST_PARTY=new sF("first-party-uid"),sF.MOCK_USER=new sF("mock-user");let sU="10.12.1",sV=new ef("@firebase/firestore");function sj(){return sV.logLevel}function sq(e,...t){if(sV.logLevel<=o.DEBUG){let n=t.map(sG);sV.debug(`Firestore (${sU}): ${e}`,...n)}}function sB(e,...t){if(sV.logLevel<=o.ERROR){let n=t.map(sG);sV.error(`Firestore (${sU}): ${e}`,...n)}}function sz(e,...t){if(sV.logLevel<=o.WARN){let n=t.map(sG);sV.warn(`Firestore (${sU}): ${e}`,...n)}}function sG(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function sK(e="Unexpected state"){let t=`FIRESTORE (${sU}) INTERNAL ASSERTION FAILED: `+e;throw sB(t),Error(t)}let s$={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class sH extends K{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class sW{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class sQ{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sJ{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(sF.UNAUTHENTICATED))}shutdown(){}}class sY{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class sX{constructor(e){this.t=e,this.currentUser=sF.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new sW;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new sW,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{sq("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(sq("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new sW)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(sq("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||sK(),new sQ(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||sK(),new sF(e)}}class sZ{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=sF.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class s0{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new sZ(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(sF.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class s1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class s2{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let n=e=>{null!=e.error&&sq("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.R;return this.R=e.token,sq("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{sq("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.A.getImmediate({optional:!0});e?r(e):sq("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||sK(),this.R=e.token,new s1(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class s5{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function s3(e,t){return e<t?-1:+(e>t)}function s4(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class s6{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new sH(s$.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new sH(s$.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return s6.fromMillis(Date.now())}static fromDate(e){return s6.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new s6(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?s3(this.nanoseconds,e.nanoseconds):s3(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class s8{constructor(e){this.timestamp=e}static fromTimestamp(e){return new s8(e)}static min(){return new s8(new s6(0,0))}static max(){return new s8(new s6(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class s9{constructor(e,t,n){void 0===t?t=0:t>e.length&&sK(),void 0===n?n=e.length-t:n>e.length-t&&sK(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===s9.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof s9?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:+(e.length>t.length)}}class s7 extends s9{construct(e,t,n){return new s7(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new sH(s$.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new s7(t)}static emptyPath(){return new s7([])}}let ae=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class at extends s9{construct(e,t,n){return new at(e,t,n)}static isValidIdentifier(e){return ae.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),at.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new at(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new sH(s$.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new sH(s$.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new sH(s$.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new sH(s$.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new at(t)}static emptyPath(){return new at([])}}class an{constructor(e){this.path=e}static fromPath(e){return new an(s7.fromString(e))}static fromName(e){return new an(s7.fromString(e).popFirst(5))}static empty(){return new an(s7.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===s7.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return s7.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new an(new s7(e.slice()))}}class ar{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function ai(e){return e.fields.find(e=>2===e.kind)}function as(e){return e.fields.filter(e=>2!==e.kind)}ar.UNKNOWN_ID=-1;class aa{constructor(e,t){this.fieldPath=e,this.kind=t}}class ao{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ao(0,ah.min())}}function al(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new ah(s8.fromTimestamp(1e9===r?new s6(n+1,0):new s6(n,r)),an.empty(),t)}function au(e){return new ah(e.readTime,e.key,-1)}class ah{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ah(s8.min(),an.empty(),-1)}static max(){return new ah(s8.max(),an.empty(),-1)}}function ac(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=an.comparator(e.documentKey,t.documentKey))?n:s3(e.largestBatchId,t.largestBatchId)}let ad="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class af{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function ap(e){if(e.code!==s$.FAILED_PRECONDITION||e.message!==ad)throw e;sq("LocalStore","Unexpectedly lost primary lease")}class am{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&sK(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new am((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof am?t:am.resolve(t)}catch(e){return am.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):am.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):am.reject(t)}static resolve(e){return new am((t,n)=>{t(e)})}static reject(e){return new am((t,n)=>{n(e)})}static waitFor(e){return new am((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=am.resolve(!1);for(let n of e)t=t.next(e=>e?am.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new am((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new am((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class ag{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new sW,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new a_(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{let n=aS(t.target.error);this.V.reject(new a_(e,n))}}static open(e,t,n,r){try{return new ag(t,e.transaction(r,n))}catch(e){throw new a_(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(sq("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new aI(this.transaction.objectStore(e))}}class ay{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===ay.S(F())&&sB("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return sq("SimpleDb","Removing database:",e),aT(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!G())return!1;if(ay.C())return!0;let e=F(),t=ay.S(e),n=av(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static C(){var e;return void 0!==T.default&&"YES"===(null==(e=T.default.__PRIVATE_env)?void 0:e.v)}static F(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}async M(e){return this.db||(sq("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new a_(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new sH(s$.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new sH(s$.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new a_(e,r))},r.onupgradeneeded=e=>{sq("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.p.O(t,r.transaction,e.oldVersion,this.version).next(()=>{sq("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.M(e);let t=ag.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.g(),e)).catch(e=>(t.abort(e),am.reject(e))).toPromise();return s.catch(()=>{}),await t.m,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(sq("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function av(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class aw{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return aT(this.B.delete())}}class a_ extends sH{constructor(e,t){super(s$.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ab(e){return"IndexedDbTransactionError"===e.name}class aI{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(sq("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(sq("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),aT(n)}add(e){return sq("SimpleDb","ADD",this.store.name,e,e),aT(this.store.add(e))}get(e){return aT(this.store.get(e)).next(t=>(void 0===t&&(t=null),sq("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return sq("SimpleDb","DELETE",this.store.name,e),aT(this.store.delete(e))}count(){return sq("SimpleDb","COUNT",this.store.name),aT(this.store.count())}U(e,t){let n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){let e=r.getAll(n.range);return new am((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.W(e,(e,n)=>{t.push(n)}).next(()=>t)}}G(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new am((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}j(e,t){sq("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.H=!1;let r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}J(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.W(r,t)}Y(e){let t=this.cursor({});return new am((n,r)=>{t.onerror=e=>{r(aS(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}W(e,t){let n=[];return new am((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new aw(i),a=t(i.primaryKey,i.value,s);if(a instanceof am){let e=a.catch(e=>(s.done(),am.reject(e)));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}}).next(()=>am.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function aT(e){return new am((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(aS(e.target.error))}})}let aE=!1;function aS(e){let t=ay.S(F());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new sH("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return aE||(aE=!0,setTimeout(()=>{throw e},0)),e}}return e}class ak{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){sq("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{sq("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(e){ab(e)?sq("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await ap(e)}await this.X(6e4)})}}class aC{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){let n=new Set,r=t,i=!0;return am.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return sq("IndexBackfiller",`Processing collection: ${t}`),this.ne(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.re(r,n)).next(n=>(sq("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}re(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=au(t);ac(r,n)>0&&(n=r)}),new ah(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ax{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}function aA(e){return null==e}function aN(e){return 0===e&&1/e==-1/0}function aD(e){return"number"==typeof e&&Number.isInteger(e)&&!aN(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function aR(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}ax.oe=-1;function aP(e){let t=e.length;if(t>=2||sK(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||sK(),s7.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&sK(),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:sK()}s=t+2}return new s7(r)}let aO=["userId","batchId"],aL={},aM=["prefixPath","collectionGroup","readTime","documentId"],aF=["prefixPath","collectionGroup","documentId"],aU=["collectionGroup","readTime","prefixPath","documentId"],aV=["canonicalId","targetId"],aj=["targetId","path"],aq=["path","targetId"],aB=["collectionId","parent"],az=["indexId","uid"],aG=["uid","sequenceNumber"],aK=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],a$=["indexId","uid","orderedDocumentKey"],aH=["userId","collectionPath","documentId"],aW=["userId","collectionPath","largestBatchId"],aQ=["userId","collectionGroup","largestBatchId"],aJ=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],aY=[...aJ,"documentOverlays"],aX=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],aZ=[...aX,"indexConfiguration","indexState","indexEntries"];class a0 extends af{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function a1(e,t){return ay.F(e._e,t)}function a2(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function a5(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function a3(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class a4{constructor(e,t){this.comparator=e,this.root=t||a8.EMPTY}insert(e,t){return new a4(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,a8.BLACK,null,null))}remove(e){return new a4(this.comparator,this.root.remove(e,this.comparator).copy(null,null,a8.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new a6(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new a6(this.root,e,this.comparator,!1)}getReverseIterator(){return new a6(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new a6(this.root,e,this.comparator,!0)}}class a6{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class a8{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:a8.RED,this.left=null!=r?r:a8.EMPTY,this.right=null!=i?i:a8.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new a8(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return a8.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return a8.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,a8.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,a8.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw sK();let e=this.left.check();if(e!==this.right.check())throw sK();return e+ +!this.isRed()}}a8.EMPTY=null,a8.RED=!0,a8.BLACK=!1,a8.EMPTY=new class{constructor(){this.size=0}get key(){throw sK()}get value(){throw sK()}get color(){throw sK()}get left(){throw sK()}get right(){throw sK()}copy(e,t,n,r,i){return this}insert(e,t,n){return new a8(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class a9{constructor(e){this.comparator=e,this.data=new a4(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new a7(this.data.getIterator())}getIteratorFrom(e){return new a7(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof a9)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new a9(this.comparator);return t.data=e,t}}class a7{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function oe(e){return e.hasNext()?e.getNext():void 0}class ot{constructor(e){this.fields=e,e.sort(at.comparator)}static empty(){return new ot([])}unionWith(e){let t=new a9(at.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new ot(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return s4(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class on extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class or{constructor(e){this.binaryString=e}static fromBase64String(e){return new or(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new on("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new or(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return s3(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}or.EMPTY_BYTE_STRING=new or("");let oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function os(e){if(e||sK(),"string"==typeof e){let t=0,n=oi.exec(e);if(n||sK(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:oa(e.seconds),nanos:oa(e.nanos)}}function oa(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function oo(e){return"string"==typeof e?or.fromBase64String(e):or.fromUint8Array(e)}function ol(e){var t,n;return"server_timestamp"===(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{}).__type__)?void 0:n.stringValue)}function ou(e){let t=e.mapValue.fields.__previous_value__;return ol(t)?ou(t):t}function oh(e){let t=os(e.mapValue.fields.__local_write_time__.timestampValue);return new s6(t.seconds,t.nanos)}class oc{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class od{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new od("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof od&&e.projectId===this.projectId&&e.database===this.database}}let of={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},op={nullValue:"NULL_VALUE"};function om(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ol(e)?4:ox(e)?0x1fffffffffffff:10:sK()}function og(e,t){if(e===t)return!0;let n=om(e);if(n!==om(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return oh(e).isEqual(oh(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=os(e.timestampValue),i=os(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return oo(e.bytesValue).isEqual(oo(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return oa(e.geoPointValue.latitude)===oa(t.geoPointValue.latitude)&&oa(e.geoPointValue.longitude)===oa(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return oa(e.integerValue)===oa(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=oa(e.doubleValue),r=oa(t.doubleValue);return n===r?aN(n)===aN(r):isNaN(n)&&isNaN(r)}return!1;case 9:return s4(e.arrayValue.values||[],t.arrayValue.values||[],og);case 10:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(a2(s)!==a2(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!og(s[e],a[e])))return!1;return!0;default:return sK()}}function oy(e,t){return void 0!==(e.values||[]).find(e=>og(e,t))}function ov(e,t){var n,r,i,s;if(e===t)return 0;let a=om(e),o=om(t);if(a!==o)return s3(a,o);switch(a){case 0:case 0x1fffffffffffff:return 0;case 1:return s3(e.booleanValue,t.booleanValue);case 2:let l,u;return l=oa(e.integerValue||e.doubleValue),l<(u=oa(t.integerValue||t.doubleValue))?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1;case 3:return ow(e.timestampValue,t.timestampValue);case 4:return ow(oh(e),oh(t));case 5:return s3(e.stringValue,t.stringValue);case 6:let h,c;return n=e.bytesValue,r=t.bytesValue,h=oo(n),c=oo(r),h.compareTo(c);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=s3(n[e],r[e]);if(0!==t)return t}return s3(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let d;return i=e.geoPointValue,s=t.geoPointValue,0!==(d=s3(oa(i.latitude),oa(s.latitude)))?d:s3(oa(i.longitude),oa(s.longitude));case 9:return function(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=ov(n[e],r[e]);if(t)return t}return s3(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===of.mapValue&&t===of.mapValue)return 0;if(e===of.mapValue)return 1;if(t===of.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=s3(r[e],s[e]);if(0!==t)return t;let a=ov(n[r[e]],i[s[e]]);if(0!==a)return a}return s3(r.length,s.length)}(e.mapValue,t.mapValue);default:throw sK()}}function ow(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return s3(e,t);let n=os(e),r=os(t),i=s3(n.seconds,r.seconds);return 0!==i?i:s3(n.nanos,r.nanos)}function o_(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=os(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?oo(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,an.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=o_(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${o_(e.fields[i])}`;return n+"}"}(e.mapValue):sK()}function ob(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function oI(e){return!!e&&"integerValue"in e}function oT(e){return!!e&&"arrayValue"in e}function oE(e){return!!e&&"nullValue"in e}function oS(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ok(e){return!!e&&"mapValue"in e}function oC(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return a5(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=oC(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=oC(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ox(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function oA(e,t){let n=ov(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function oN(e,t){let n=ov(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class oD{constructor(e){this.value=e}static empty(){return new oD({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!ok(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=oC(t)}setAll(e){let t=at.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=oC(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());ok(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return og(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];ok(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(a5(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new oD(oC(this.value))}}class oR{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new oR(e,0,s8.min(),s8.min(),s8.min(),oD.empty(),0)}static newFoundDocument(e,t,n,r){return new oR(e,1,t,s8.min(),n,r,0)}static newNoDocument(e,t){return new oR(e,2,t,s8.min(),s8.min(),oD.empty(),0)}static newUnknownDocument(e,t){return new oR(e,3,t,s8.min(),s8.min(),oD.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(s8.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=oD.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=oD.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=s8.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof oR&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new oR(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class oP{constructor(e,t){this.position=e,this.inclusive=t}}function oO(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?an.comparator(an.fromName(a.referenceValue),n.key):ov(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function oL(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!og(e.position[n],t.position[n]))return!1;return!0}class oM{constructor(e,t="asc"){this.field=e,this.dir=t}}class oF{}class oU extends oF{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new oK(e,t,n):"array-contains"===t?new oQ(e,n):"in"===t?new oJ(e,n):"not-in"===t?new oY(e,n):"array-contains-any"===t?new oX(e,n):new oU(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new o$(e,n):new oH(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(ov(t,this.value)):null!==t&&om(this.value)===om(t)&&this.matchesComparison(ov(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return sK()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class oV extends oF{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new oV(e,t)}matches(e){return oj(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function oj(e){return"and"===e.op}function oq(e){return"or"===e.op}function oB(e){return oz(e)&&oj(e)}function oz(e){for(let t of e.filters)if(t instanceof oV)return!1;return!0}function oG(e,t){let n=e.filters.concat(t);return oV.create(n,e.op)}class oK extends oU{constructor(e,t,n){super(e,t,n),this.key=an.fromName(n.referenceValue)}matches(e){let t=an.comparator(e.key,this.key);return this.matchesComparison(t)}}class o$ extends oU{constructor(e,t){super(e,"in",t),this.keys=oW("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class oH extends oU{constructor(e,t){super(e,"not-in",t),this.keys=oW("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function oW(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>an.fromName(e.referenceValue))}class oQ extends oU{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return oT(t)&&oy(t.arrayValue,this.value)}}class oJ extends oU{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&oy(this.value.arrayValue,t)}}class oY extends oU{constructor(e,t){super(e,"not-in",t)}matches(e){if(oy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!oy(this.value.arrayValue,t)}}class oX extends oU{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!oT(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>oy(this.value.arrayValue,e))}}class oZ{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ue=null}}function o0(e,t=null,n=[],r=[],i=null,s=null,a=null){return new oZ(e,t,n,r,i,s,a)}function o1(e){if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof oU)return t.field.canonicalString()+t.op.toString()+o_(t.value);if(oB(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),aA(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>o_(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>o_(e)).join(",")),e.ue=t}return e.ue}function o2(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof oU?n instanceof oU&&t.op===n.op&&t.field.isEqual(n.field)&&og(t.value,n.value):t instanceof oV?n instanceof oV&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void sK()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!oL(e.startAt,t.startAt)&&oL(e.endAt,t.endAt)}function o5(e){return an.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function o3(e,t){return e.filters.filter(e=>e instanceof oU&&e.field.isEqual(t))}function o4(e,t,n){let r=op,i=!0;for(let n of o3(e,t)){let e=op,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?op:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?ob(od.empty(),an.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?{mapValue:{}}:sK();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=op}0>oA({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>oA({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function o6(e,t,n){let r=of,i=!0;for(let n of o3(e,t)){let e=of,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?ob(od.empty(),an.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?{mapValue:{}}:"mapValue"in s?of:sK(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=of}oN({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];oN({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class o8{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function o9(e){return new o8(e)}function o7(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function le(e){return null!==e.collectionGroup}function lt(e){if(null===e.ce){let t;e.ce=[];let n=new Set;for(let t of e.explicitOrderBy)e.ce.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new a9(at.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.ce.push(new oM(t,r))}),n.has(at.keyField().canonicalString())||e.ce.push(new oM(at.keyField(),r))}return e.ce}function ln(e){return e.le||(e.le=function(e,t){if("F"===e.limitType)return o0(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new oM(e.field,t)});let n=e.endAt?new oP(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new oP(e.startAt.position,e.startAt.inclusive):null;return o0(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,lt(e))),e.le}function lr(e,t){let n=e.filters.concat([t]);return new o8(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function li(e,t,n){return new o8(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ls(e,t){return o2(ln(e),ln(t))&&e.limitType===t.limitType}function la(e){return`${o1(ln(e))}|lt:${e.limitType}`}function lo(e){var t;let n;return`Query(target=${n=(t=ln(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof oU?`${t.field.canonicalString()} ${t.op} ${o_(t.value)}`:t instanceof oV?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),aA(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>o_(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>o_(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function ll(e,t){var n,r,i,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):an.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of lt(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,o=oO(i,lt(n),r),i.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=oO(s,lt(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function lu(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function lh(e){return(t,n)=>{let r=!1;for(let i of lt(e)){let e=function(e,t,n){var r;let i,s,a=e.field.isKeyField()?an.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?ov(i,s):sK());switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return sK()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class lc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){a5(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return a3(this.inner)}size(){return this.innerSize}}let ld=new a4(an.comparator),lf=new a4(an.comparator);function lp(...e){let t=lf;for(let n of e)t=t.insert(n.key,n);return t}function lm(e){let t=lf;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function lg(){return new lc(e=>e.toString(),(e,t)=>e.isEqual(t))}let ly=new a4(an.comparator),lv=new a9(an.comparator);function lw(...e){let t=lv;for(let n of e)t=t.add(n);return t}let l_=new a9(s3);function lb(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:aN(t)?"-0":t}}function lI(e){return{integerValue:""+e}}function lT(e,t){return aD(t)?lI(t):lb(e,t)}class lE{constructor(){this._=void 0}}function lS(e,t){return e instanceof lD?oI(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class lk extends lE{}class lC extends lE{constructor(e){super(),this.elements=e}}function lx(e,t){let n=lP(t);for(let t of e.elements)n.some(e=>og(e,t))||n.push(t);return{arrayValue:{values:n}}}class lA extends lE{constructor(e){super(),this.elements=e}}function lN(e,t){let n=lP(t);for(let t of e.elements)n=n.filter(e=>!og(e,t));return{arrayValue:{values:n}}}class lD extends lE{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function lR(e){return oa(e.integerValue||e.doubleValue)}function lP(e){return oT(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class lO{constructor(e,t){this.field=e,this.transform=t}}class lL{constructor(e,t){this.version=e,this.transformResults=t}}class lM{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new lM}static exists(e){return new lM(void 0,e)}static updateTime(e){return new lM(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function lF(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class lU{}function lV(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new lH(e.key,lM.none()):new lB(e.key,e.data,lM.none());{let n=e.data,r=oD.empty(),i=new a9(at.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new lz(e.key,r,new ot(i.toArray()),lM.none())}}function lj(e,t,n,r){return e instanceof lB?function(e,t,n,r){if(!lF(e.precondition,t))return n;let i=e.value.clone(),s=l$(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof lz?function(e,t,n,r){if(!lF(e.precondition,t))return n;let i=l$(e.fieldTransforms,r,t),s=t.data;return(s.setAll(lG(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):lF(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function lq(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&s4(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof lC&&r instanceof lC||n instanceof lA&&r instanceof lA?s4(n.elements,r.elements,og):n instanceof lD&&r instanceof lD?og(n.Pe,r.Pe):n instanceof lk&&r instanceof lk)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class lB extends lU{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class lz extends lU{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function lG(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function lK(e,t,n){var r;let i=new Map;e.length===n.length||sK();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(r=n[s],o instanceof lC?lx(o,l):o instanceof lA?lN(o,l):r))}return i}function l$(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,a;return e instanceof lk?(r=t,i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&ol(r)&&(r=ou(r)),r&&(i.fields.__previous_value__=r),{mapValue:i}):e instanceof lC?lx(e,t):e instanceof lA?lN(e,t):(a=lR(s=lS(e,t))+lR(e.Pe),oI(s)&&oI(e.Pe)?lI(a):lb(e.serializer,a))}(e,s,t))}return r}class lH extends lU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class lW extends lU{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class lQ{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof lB?(r=e.value.clone(),i=lK(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof lz?function(e,t,n){if(!lF(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=lK(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(lG(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=lj(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=lj(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=lg();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=lV(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(s8.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),lw())}isEqual(e){return this.batchId===e.batchId&&s4(this.mutations,e.mutations,(e,t)=>lq(e,t))&&s4(this.baseMutations,e.baseMutations,(e,t)=>lq(e,t))}}class lJ{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){e.mutations.length===n.length||sK();let r=ly,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new lJ(e,t,n,r)}}class lY{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class lX{constructor(e,t){this.count=e,this.unchangedNames=t}}function lZ(e){switch(e){default:return sK();case s$.CANCELLED:case s$.UNKNOWN:case s$.DEADLINE_EXCEEDED:case s$.RESOURCE_EXHAUSTED:case s$.INTERNAL:case s$.UNAVAILABLE:case s$.UNAUTHENTICATED:return!1;case s$.INVALID_ARGUMENT:case s$.NOT_FOUND:case s$.ALREADY_EXISTS:case s$.PERMISSION_DENIED:case s$.FAILED_PRECONDITION:case s$.ABORTED:case s$.OUT_OF_RANGE:case s$.UNIMPLEMENTED:case s$.DATA_LOSS:return!0}}function l0(e){if(void 0===e)return sB("GRPC error has no .code"),s$.UNKNOWN;switch(e){case w.OK:return s$.OK;case w.CANCELLED:return s$.CANCELLED;case w.UNKNOWN:return s$.UNKNOWN;case w.DEADLINE_EXCEEDED:return s$.DEADLINE_EXCEEDED;case w.RESOURCE_EXHAUSTED:return s$.RESOURCE_EXHAUSTED;case w.INTERNAL:return s$.INTERNAL;case w.UNAVAILABLE:return s$.UNAVAILABLE;case w.UNAUTHENTICATED:return s$.UNAUTHENTICATED;case w.INVALID_ARGUMENT:return s$.INVALID_ARGUMENT;case w.NOT_FOUND:return s$.NOT_FOUND;case w.ALREADY_EXISTS:return s$.ALREADY_EXISTS;case w.PERMISSION_DENIED:return s$.PERMISSION_DENIED;case w.FAILED_PRECONDITION:return s$.FAILED_PRECONDITION;case w.ABORTED:return s$.ABORTED;case w.OUT_OF_RANGE:return s$.OUT_OF_RANGE;case w.UNIMPLEMENTED:return s$.UNIMPLEMENTED;case w.DATA_LOSS:return s$.DATA_LOSS;default:return sK()}}function l1(){return new TextEncoder}(_=w||(w={}))[_.OK=0]="OK",_[_.CANCELLED=1]="CANCELLED",_[_.UNKNOWN=2]="UNKNOWN",_[_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",_[_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",_[_.NOT_FOUND=5]="NOT_FOUND",_[_.ALREADY_EXISTS=6]="ALREADY_EXISTS",_[_.PERMISSION_DENIED=7]="PERMISSION_DENIED",_[_.UNAUTHENTICATED=16]="UNAUTHENTICATED",_[_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",_[_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",_[_.ABORTED=10]="ABORTED",_[_.OUT_OF_RANGE=11]="OUT_OF_RANGE",_[_.UNIMPLEMENTED=12]="UNIMPLEMENTED",_[_.INTERNAL=13]="INTERNAL",_[_.UNAVAILABLE=14]="UNAVAILABLE",_[_.DATA_LOSS=15]="DATA_LOSS";let l2=new l([0xffffffff,0xffffffff],0);function l5(e){let t=l1().encode(e),n=new u;return n.update(t),new Uint8Array(n.digest())}function l3(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new l([n,r],0),new l([i,s],0)]}class l4{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new l6(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new l6(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new l6(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=l.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(l.fromNumber(n)));return 1===r.compare(l2)&&(r=new l([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;let[t,n]=l3(l5(e));for(let e=0;e<this.hashCount;e++){let r=this.Ee(t,n,e);if(!this.de(r))return!1}return!0}static create(e,t,n){let r=new l4(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.Ie)return;let[t,n]=l3(l5(e));for(let e=0;e<this.hashCount;e++){let r=this.Ee(t,n,e);this.Ae(r)}}Ae(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class l6 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class l8{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,l9.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new l8(s8.min(),r,new a4(s3),ld,lw())}}class l9{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new l9(n,t,lw(),lw(),lw())}}class l7{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class ue{constructor(e,t){this.targetId=e,this.me=t}}class ut{constructor(e,t,n=or.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class un{constructor(){this.fe=0,this.ge=us(),this.pe=or.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}Ce(){let e=lw(),t=lw(),n=lw();return this.ge.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:sK()}}),new l9(this.pe,this.ye,e,t,n)}ve(){this.we=!1,this.ge=us()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,this.fe>=0||sK()}Ne(){this.we=!0,this.ye=!0}}class ur{constructor(e){this.Le=e,this.Be=new Map,this.ke=ld,this.qe=ui(),this.Qe=new a4(s3)}Ke(e){for(let t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(let t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{let n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:sK()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){let t=e.targetId,n=e.me.count,r=this.Je(t);if(r){let i=r.target;if(o5(i))if(0===n){let e=new an(i.path);this.Ue(t,e,oR.newNoDocument(e,s8.min()))}else 1===n||sK();else{let r=this.Ye(t);if(r!==n){let n=this.Ze(e),i=n?this.Xe(n,e,r):1;0!==i&&(this.je(t),this.Qe=this.Qe.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){let t,n,r=e.me.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=r;try{t=oo(i).toUint8Array()}catch(e){if(e instanceof on)return sz("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new l4(t,s,a)}catch(e){return sz(e instanceof l6?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.Ie?null:n}Xe(e,t,n){return 2*(t.me.count!==n-this.nt(e,t.targetId))}nt(e,t){let n=this.Le.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Le.tt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Ue(t,n,null),r++)}),r}rt(e){let t=new Map;this.Be.forEach((n,r)=>{let i=this.Je(r);if(i){if(n.current&&o5(i.target)){let t=new an(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,oR.newNoDocument(t,e))}n.be&&(t.set(r,n.Ce()),n.ve())}});let n=lw();this.qe.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));let r=new l8(e,t,this.Qe,this.ke,n);return this.ke=ld,this.qe=ui(),this.Qe=new a4(s3),r}$e(e,t){if(!this.ze(e))return;let n=2*!!this.it(e,t.key);this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;let r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){let t=this.Ge(e).Ce();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new un,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new a9(s3),this.qe=this.qe.insert(e,t)),t}ze(e){let t=null!==this.Je(e);return t||sq("WatchChangeAggregator","Detected inactive target",e),t}Je(e){let t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new un),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ui(){return new a4(an.comparator)}function us(){return new a4(an.comparator)}let ua={asc:"ASCENDING",desc:"DESCENDING"},uo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ul={and:"AND",or:"OR"};class uu{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function uh(e,t){return e.useProto3Json||aA(t)?t:{value:t}}function uc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ud(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function uf(e){let t;return e||sK(),s8.fromTimestamp(new s6((t=os(e)).seconds,t.nanos))}function up(e,t){return um(e,t).canonicalString()}function um(e,t){let n=new s7(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function ug(e){let t=s7.fromString(e);return uR(t)||sK(),t}function uy(e,t){return up(e.databaseId,t.path)}function uv(e,t){let n=ug(t);if(n.get(1)!==e.databaseId.projectId)throw new sH(s$.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new sH(s$.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new an(uI(n))}function uw(e,t){return up(e.databaseId,t)}function u_(e){let t=ug(e);return 4===t.length?s7.emptyPath():uI(t)}function ub(e){return new s7(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function uI(e){return e.length>4&&"documents"===e.get(4)||sK(),e.popFirst(5)}function uT(e,t,n){return{name:uy(e,t),fields:n.value.mapValue.fields}}function uE(e,t,n){let r=uv(e,t.name),i=uf(t.updateTime),s=t.createTime?uf(t.createTime):s8.min(),a=new oD({mapValue:{fields:t.fields}}),o=oR.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function uS(e,t){var n,r;let i;if(t instanceof lB)i={update:uT(e,t.key,t.value)};else if(t instanceof lH)i={delete:uy(e,t.key)};else if(t instanceof lz){let n;i={update:uT(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof lW))return sK();i={verify:uy(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof lk)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof lC)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof lA)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof lD)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw sK()})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:uc(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:sK()),i}function uk(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?lM.updateTime(uf(n.updateTime)):void 0!==n.exists?lM.exists(n.exists):lM.none():lM.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{var n,r;let i;return n=e,i=null,"setToServerValue"in(r=t)?("REQUEST_TIME"===r.setToServerValue||sK(),i=new lk):"appendMissingElements"in r?i=new lC(r.appendMissingElements.values||[]):"removeAllFromArray"in r?i=new lA(r.removeAllFromArray.values||[]):"increment"in r?i=new lD(n,r.increment):sK(),new lO(at.fromServerFormat(r.fieldPath),i)}):[];if(t.update){t.update.name;let n=uv(e,t.update.name),s=new oD({mapValue:{fields:t.update.fields}});return t.updateMask?new lz(n,s,new ot((t.updateMask.fieldPaths||[]).map(e=>at.fromServerFormat(e))),r,i):new lB(n,s,r,i)}return t.delete?new lH(uv(e,t.delete),r):t.verify?new lW(uv(e,t.verify),r):sK()}function uC(e,t){return{documents:[uw(e,t.path)]}}function ux(e,t){var n,r;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=uw(e,i);let o=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof oU?function(e){if("=="===e.op){if(oS(e.value))return{unaryFilter:{field:uN(e.field),op:"IS_NAN"}};if(oE(e.value))return{unaryFilter:{field:uN(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(oS(e.value))return{unaryFilter:{field:uN(e.field),op:"IS_NOT_NAN"}};if(oE(e.value))return{unaryFilter:{field:uN(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:uN(e.field),op:uo[e.op],value:e.value}}}(t):t instanceof oV?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:ul[n.op],filters:r}}:sK()}(oV.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:uN(e.field),direction:ua[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=uh(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),{_t:s,parent:i}}function uA(e){var t,n,r;let i,s,a,o,l=u_(e.parent),u=e.structuredQuery,h=u.from?u.from.length:0,c=null;if(h>0){1===h||sK();let e=u.from[0];e.allDescendants?c=e.collectionId:l=l.child(e.collectionId)}let d=[];u.where&&(d=(i=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=uD(e.unaryFilter.field);return oU.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=uD(e.unaryFilter.field);return oU.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=uD(e.unaryFilter.field);return oU.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=uD(e.unaryFilter.field);return oU.create(i,"!=",{nullValue:"NULL_VALUE"});default:return sK()}}(t):void 0!==t.fieldFilter?oU.create(uD(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return sK()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?oV.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return sK()}}(t.compositeFilter.op)):sK()}(u.where))instanceof oV&&oB(i)?i.getFilters():[i]);let f=[];u.orderBy&&(f=u.orderBy.map(e=>new oM(uD(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;u.limit&&(p=aA(s="object"==typeof(t=u.limit)?t.value:t)?null:s);let m=null;u.startAt&&(a=!!(n=u.startAt).before,m=new oP(n.values||[],a));let g=null;return u.endAt&&(o=!(r=u.endAt).before,g=new oP(r.values||[],o)),new o8(l,c,f,d,p,"F",m,g)}function uN(e){return{fieldPath:e.canonicalString()}}function uD(e){return at.fromServerFormat(e.fieldPath)}function uR(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class uP{constructor(e,t,n,r,i=s8.min(),s=s8.min(),a=or.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new uP(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new uP(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new uP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new uP(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class uO{constructor(e){this.ct=e}}function uL(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:uM(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:uy(i=e.ct,t.key),fields:t.data.value.mapValue.fields,updateTime:uc(i,t.version.toTimestamp()),createTime:uc(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:uF(t.version)};else{if(!t.isUnknownDocument())return sK();r.unknownDocument={path:n.path.toArray(),version:uF(t.version)}}return r}function uM(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function uF(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function uU(e){let t=new s6(e.seconds,e.nanoseconds);return s8.fromTimestamp(t)}function uV(e,t){let n=(t.baseMutations||[]).map(t=>uk(e.ct,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(n.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let r=t.mutations.map(t=>uk(e.ct,t)),i=s6.fromMillis(t.localWriteTimeMs);return new lQ(t.batchId,i,n,r)}function uj(e){var t;let n=uU(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?uU(e.lastLimboFreeSnapshotVersion):s8.min();return new uP(void 0!==e.query.documents?(1===(t=e.query).documents.length||sK(),ln(o9(u_(t.documents[0])))):ln(uA(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,or.fromBase64String(e.resumeToken))}function uq(e,t){let n,r=uF(t.snapshotVersion),i=uF(t.lastLimboFreeSnapshotVersion);n=o5(t.target)?uC(e.ct,t.target):ux(e.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:o1(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function uB(e){let t=uA({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?li(t,t.limit,"L"):t}function uz(e,t){return new lY(t.largestBatchId,uk(e.ct,t.overlayMutation))}function uG(e,t){let n=t.path.lastSegment();return[e,aR(t.path.popLast()),n]}function uK(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:uF(r.readTime),documentKey:aR(r.documentKey.path),largestBatchId:r.largestBatchId}}class u${getBundleMetadata(e,t){return uH(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:uU(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return uH(e).put({bundleId:t.id,createTime:uF(uf(t.createTime)),version:t.version})}getNamedQuery(e,t){return uW(e).get(t).next(e=>{if(e)return{name:e.name,query:uB(e.bundledQuery),readTime:uU(e.readTime)}})}saveNamedQuery(e,t){return uW(e).put({name:t.name,readTime:uF(uf(t.readTime)),bundledQuery:t.bundledQuery})}}function uH(e){return a1(e,"bundles")}function uW(e){return a1(e,"namedQueries")}class uQ{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new uQ(e,t.uid||"")}getOverlay(e,t){return uJ(e).get(uG(this.userId,t)).next(e=>e?uz(this.serializer,e):null)}getOverlays(e,t){let n=lg();return am.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new lY(t,i);r.push(this.ht(e,s))}),am.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(aR(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(uJ(e).j("collectionPathOverlayIndex",r))}),am.waitFor(i)}getOverlaysForCollection(e,t,n){let r=lg(),i=aR(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,1/0],!0);return uJ(e).U("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=uz(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i,s=lg(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,1/0],!0);return uJ(e).J({index:"collectionGroupOverlayIndex",range:a},(e,t,n)=>{let a=uz(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}ht(e,t){return uJ(e).put(function(e,t,n){let[r,i,s]=uG(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:uS(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function uJ(e){return a1(e,"documentOverlays")}class uY{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(+!!e.booleanValue);else if("integerValue"in e)this.Et(t,15),t.dt(oa(e.integerValue));else if("doubleValue"in e){let n=oa(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),aN(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Et(t,20),"string"==typeof n&&(n=os(n)),t.At(`${n.seconds||""}`),t.dt(n.nanos||0)}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(oo(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?ox(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):sK()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let n=e.fields||{};for(let e of(this.Et(t,55),Object.keys(n)))this.Rt(e,t),this.It(n[e],t)}wt(e,t){let n=e.values||[];for(let e of(this.Et(t,50),n))this.It(e,t)}gt(e,t){this.Et(t,37),an.fromName(e).path.forEach(e=>{this.Et(t,60),this.St(e,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}function uX(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}uY.bt=new uY;class uZ{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ct(n.value),n=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Mt(n.value),n=t.next();this.xt()}Ot(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ct(e);else if(e<2048)this.Ct(960|e>>>6),this.Ct(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ct(480|e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e);else{let e=t.codePointAt(0);this.Ct(240|e>>>18),this.Ct(128|63&e>>>12),this.Ct(128|63&e>>>6),this.Ct(128|63&e)}}this.vt()}Nt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Mt(e);else if(e<2048)this.Mt(960|e>>>6),this.Mt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Mt(480|e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e);else{let e=t.codePointAt(0);this.Mt(240|e>>>18),this.Mt(128|63&e>>>12),this.Mt(128|63&e>>>6),this.Mt(128|63&e)}}this.xt()}Lt(e){let t=this.Bt(e),n=uX(t);this.kt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}qt(e){let t=this.Bt(e),n=uX(t);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t,n=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),r=0!=(128&n[0]);n[0]^=r?255:128;for(let e=1;e<n.length;++e)n[e]^=255*!!r;return n}Ct(e){let t=255&e;0===t?(this.Kt(0),this.Kt(255)):255===t?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class u0{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}}class u1{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}}class u2{constructor(){this.Gt=new uZ,this.zt=new u0(this.Gt),this.jt=new u1(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return 0===e?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}}class u5{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Jt(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new u5(this.indexId,this.documentKey,this.arrayValue,n)}}function u3(e,t){let n=e.indexId-t.indexId;return 0!==n||0!==(n=u4(e.arrayValue,t.arrayValue))||0!==(n=u4(e.directionalValue,t.directionalValue))?n:an.comparator(e.documentKey,t.documentKey)}function u4(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class u6{constructor(e){for(const t of(this.Yt=new a9((e,t)=>at.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[],e.filters))t.isInequality()?this.Yt=this.Yt.add(t):this.Xt.push(t)}get en(){return this.Yt.size>1}tn(e){if(e.collectionGroup===this.collectionId||sK(),this.en)return!1;let t=ai(e);if(void 0!==t&&!this.nn(t))return!1;let n=as(e),r=new Set,i=0,s=0;for(;i<n.length&&this.nn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Yt.size>0){let e=this.Yt.getIterator().getNext();if(!r.has(e.field.canonicalString())){let t=n[i];if(!this.rn(e,t)||!this.sn(this.Zt[s++],t))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.Zt.length||!this.sn(this.Zt[s++],e))return!1}return!0}on(){if(this.en)return null;let e=new a9(at.comparator),t=[];for(let n of this.Xt)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new aa(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new aa(n.field,0))}for(let n of this.Zt)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new aa(n.field,+("asc"!==n.dir))));return new ar(ar.UNKNOWN_ID,this.collectionId,t,ao.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function u8(e){return e instanceof oU}function u9(e){return e instanceof oV&&oB(e)}function u7(e){return u8(e)||u9(e)||function(e){if(e instanceof oV&&oq(e)){for(let t of e.getFilters())if(!u8(t)&&!u9(t))return!1;return!0}return!1}(e)}function he(e,t){return e instanceof oU||e instanceof oV||sK(),t instanceof oU||t instanceof oV||sK(),hn(e instanceof oU?t instanceof oU?oV.create([e,t],"and"):ht(e,t):t instanceof oU?ht(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||sK(),oj(e)&&oj(t))return oG(e,t.getFilters());let n=oq(e)?e:t,r=oq(e)?t:e,i=n.filters.map(e=>he(e,r));return oV.create(i,"or")}(e,t))}function ht(e,t){if(oj(t))return oG(t,e.getFilters());{let n=t.filters.map(t=>he(e,t));return oV.create(n,"or")}}function hn(e){if(e instanceof oU||e instanceof oV||sK(),e instanceof oU)return e;let t=e.getFilters();if(1===t.length)return hn(t[0]);if(oz(e))return e;let n=t.map(e=>hn(e)),r=[];return n.forEach(t=>{t instanceof oU?r.push(t):t instanceof oV&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:oV.create(r,e.op)}class hr{constructor(){this._n=new hi}addToCollectionParentIndex(e,t){return this._n.add(t),am.resolve()}getCollectionParents(e,t){return am.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return am.resolve()}deleteFieldIndex(e,t){return am.resolve()}deleteAllFieldIndexes(e){return am.resolve()}createTargetIndexes(e,t){return am.resolve()}getDocumentsMatchingTarget(e,t){return am.resolve(null)}getIndexType(e,t){return am.resolve(0)}getFieldIndexes(e,t){return am.resolve([])}getNextCollectionGroupToUpdate(e){return am.resolve(null)}getMinOffset(e,t){return am.resolve(ah.min())}getMinOffsetFromCollectionGroup(e,t){return am.resolve(ah.min())}updateCollectionGroup(e,t,n){return am.resolve()}updateIndexEntries(e,t){return am.resolve()}}class hi{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new a9(s7.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new a9(s7.comparator)).toArray()}}let hs=new Uint8Array(0);class ha{constructor(e,t){this.databaseId=t,this.an=new hi,this.un=new lc(e=>o1(e),(e,t)=>o2(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let i={collectionId:n,parent:aR(r)};return ho(e).put(i)}return am.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return ho(e).U(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(aP(r.parent))}return n})}addFieldIndex(e,t){let n=hu(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=hh(e);return i.next(e=>{n.put(uK(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=hu(e),r=hh(e),i=hl(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=hu(e),n=hl(e),r=hh(e);return t.j().next(()=>n.j()).next(()=>r.j())}createTargetIndexes(e,t){return am.forEach(this.cn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new u6(t).on();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=hl(e),r=!0,i=new Map;return am.forEach(this.cn(t),t=>this.ln(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=lw(),r=[];return am.forEach(i,(i,s)=>{sq("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${o1(t)}`);let a=function(e,t){let n=ai(t);if(void 0===n)return null;for(let t of o3(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of as(t))for(let t of o3(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of as(t)){let t=0===i.kind?o4(e,i.fieldPath,e.startAt):o6(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new oP(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of as(t)){let t=0===i.kind?o6(e,i.fieldPath,e.endAt):o4(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new oP(n,r)}(s,i),h=this.hn(i,s,l),c=this.hn(i,s,u),d=this.Pn(i,s,o),f=this.In(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return am.forEach(f,i=>n.G(i,t.limit).next(t=>{t.forEach(t=>{let n=an.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return am.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof oU||t instanceof oV||sK(),t instanceof oU)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=oV.create(n,t.op);return u7(r=hn(r))?r:(r instanceof oV||sK(),oj(r)||sK(),r.filters.length>1||sK(),r.filters.reduce((e,t)=>he(e,t)))}(function e(t){var n,r;if(t instanceof oU||t instanceof oV||sK(),t instanceof oU){if(t instanceof oJ){let e=(null==(r=null==(n=t.value.arrayValue)?void 0:n.values)?void 0:r.map(e=>oU.create(t.field,"==",e)))||[];return oV.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return oV.create(i,t.op)}(e));return u7(t)||sK(),u8(t)||u9(t)?[t]:t.getFilters()})(oV.create(e.filters,"and")).map(t=>o0(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t)),t}In(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Tn(t[h/l]):hs,c=this.En(e,o,n[h%l],r),d=this.dn(e,o,i[h%l],s),f=a.map(t=>this.En(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}En(e,t,n,r){let i=new u5(e,an.empty(),t,n);return r?i:i.Jt()}dn(e,t,n,r){let i=new u5(e,an.empty(),t,n);return r?i.Jt():i}ln(e,t){let n=new u6(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.cn(t);return am.forEach(r,t=>this.ln(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new a9(at.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+ +!!n}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}An(e,t){let n=new u2;for(let r of as(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.Ht(r.kind);uY.bt.Pt(e,i)}return n.Wt()}Tn(e){let t=new u2;return uY.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let n,r=new u2;return uY.bt.Pt(ob(this.databaseId,t),r.Ht(0===(n=as(e)).length?0:n[n.length-1].kind)),r.Wt()}Pn(e,t,n){if(null===n)return[];let r=[];r.push(new u2);let i=0;for(let s of as(e)){let e=n[i++];for(let n of r)if(this.Vn(t,s.fieldPath)&&oT(e))r=this.mn(r,s,e);else{let t=n.Ht(s.kind);uY.bt.Pt(e,t)}}return this.fn(r)}hn(e,t,n){return this.Pn(e,t,n.position)}fn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Wt();return t}mn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new u2;r.seed(n.Wt()),uY.bt.Pt(e,r.Ht(t.kind)),i.push(r)}return i}Vn(e,t){return!!e.filters.find(e=>e instanceof oU&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=hu(e),r=hh(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(e=>{let t=[];return am.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{let r,i;t.push((r=n?new ao(n.sequenceNumber,new ah(uU(n.readTime),new an(aP(n.documentKey)),n.largestBatchId)):ao.empty(),i=e.fields.map(([e,t])=>new aa(at.fromServerFormat(e),t)),new ar(e.indexId,e.collectionGroup,i,r)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:s3(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=hu(e),i=hh(e);return this.gn(e).next(e=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>am.forEach(t,t=>i.put(uK(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return am.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?am.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),am.forEach(i,n=>this.pn(e,t,n).next(t=>{let i=this.yn(r,n);return t.isEqual(i)?am.resolve():this.wn(e,r,n,t,i)}))))})}Sn(e,t,n,r){return hl(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.Rn(n,t.key),documentKey:t.key.path.toArray()})}bn(e,t,n,r){return hl(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.Rn(n,t.key),t.key.path.toArray()])}pn(e,t,n){let r=hl(e),i=new a9(u3);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,t)])},(e,r)=>{i=i.add(new u5(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}yn(e,t){let n=new a9(u3),r=this.An(t,e);if(null==r)return n;let i=ai(t);if(null!=i){let s=e.data.field(i.fieldPath);if(oT(s))for(let i of s.arrayValue.values||[])n=n.add(new u5(t.indexId,e.key,this.Tn(i),r))}else n=n.add(new u5(t.indexId,e.key,hs,r));return n}wn(e,t,n,r,i){sq("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=oe(s),l=oe(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=oe(a)):t?(i(o),o=oe(s)):(o=oe(s),l=oe(a))}}(r,i,u3,r=>{s.push(this.Sn(e,t,n,r))},r=>{s.push(this.bn(e,t,n,r))}),am.waitFor(s)}gn(e){let t=1;return hh(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>u3(e,t)).filter((e,t,n)=>!t||0!==u3(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=u3(i,e),s=u3(i,t);if(0===n)r[0]=e.Jt();else if(n>0&&s<0)r.push(i),r.push(i.Jt());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.Dn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,hs,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,hs,[]];i.push(IDBKeyRange.bound(t,n))}return i}Dn(e,t){return u3(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hc)}getMinOffset(e,t){return am.mapArray(this.cn(t),t=>this.ln(e,t).next(e=>e||sK())).next(hc)}}function ho(e){return a1(e,"collectionParents")}function hl(e){return a1(e,"indexEntries")}function hu(e){return a1(e,"indexConfiguration")}function hh(e){return a1(e,"indexState")}function hc(e){0!==e.length||sK();let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>ac(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ah(t.readTime,t.documentKey,n)}let hd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class hf{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new hf(e,hf.DEFAULT_COLLECTION_PERCENTILE,hf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function hp(e,t,n){let r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.J({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{1===o||sK()}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,aR(h),c]);s.push(i.delete(r)),u.push(e.key)}return am.waitFor(s).next(()=>u)}function hm(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw sK();t=e.noDocument}return JSON.stringify(t).length}hf.DEFAULT_COLLECTION_PERCENTILE=10,hf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hf.DEFAULT=new hf(0x2800000,hf.DEFAULT_COLLECTION_PERCENTILE,hf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hf.DISABLED=new hf(-1,0,0);class hg{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Cn={}}static lt(e,t,n,r){return""!==e.uid||sK(),new hg(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return hv(e).J({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=hw(e),s=hv(e);return s.add({}).next(a=>{var o,l,u,h;let c,d;"number"==typeof a||sK();let f=new lQ(a,t,n,r),p=(o=this.serializer,l=this.userId,c=f.baseMutations.map(e=>uS(o.ct,e)),d=f.mutations.map(e=>uS(o.ct,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:c,mutations:d}),m=[],g=new a9((e,t)=>s3(e.canonicalString(),t.canonicalString()));for(let e of r){let t=(u=this.userId,h=e.key.path,[u,aR(h),a]);g=g.add(e.key.path.popLast()),m.push(s.put(p)),m.push(i.put(t,aL))}return g.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Cn[a]=f.keys()}),am.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return hv(e).get(t).next(e=>e?(e.userId===this.userId||sK(),uV(this.serializer,e)):null)}vn(e,t){return this.Cn[t]?am.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Cn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return hv(e).J({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(t.batchId>=n||sK(),i=uV(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),n=-1;return hv(e).J({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return hv(e).U("userMutationsIndex",t).next(e=>e.map(e=>uV(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,aR(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return hw(e).J({range:r},(n,r,s)=>{let[a,o,l]=n,u=aP(o);if(a===this.userId&&t.path.isEqual(u))return hv(e).get(l).next(e=>{if(!e)throw sK();e.userId===this.userId||sK(),i.push(uV(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new a9(s3),r=[];return t.forEach(t=>{let i=[this.userId,aR(t.path)],s=IDBKeyRange.lowerBound(i),a=hw(e).J({range:s},(e,r,i)=>{let[s,a,o]=e,l=aP(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),am.waitFor(r).next(()=>this.Fn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,aR(n)],s=IDBKeyRange.lowerBound(i),a=new a9(s3);return hw(e).J({range:s},(e,t,i)=>{let[s,o,l]=e,u=aP(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let n=[],r=[];return t.forEach(t=>{r.push(hv(e).get(t).next(e=>{if(null===e)throw sK();e.userId===this.userId||sK(),n.push(uV(this.serializer,e))}))}),am.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return hp(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),am.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return am.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return hw(e).J({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=aP(e[1]);r.push(t)}else n.done()}).next(()=>{0===r.length||sK()})})}containsKey(e,t){return hy(e,this.userId,t)}xn(e){return h_(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hy(e,t,n){let r=[t,aR(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return hw(e).J({range:s,H:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function hv(e){return a1(e,"mutations")}function hw(e){return a1(e,"documentMutations")}function h_(e){return a1(e,"mutationQueues")}class hb{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new hb(0)}static Ln(){return new hb(-1)}}class hI{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let n=new hb(t.highestTargetId);return t.highestTargetId=n.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(e=>s8.fromTimestamp(new s6(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.Bn(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.kn(e,r)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(n=>(n.targetCount+=1,this.Qn(t,n),this.kn(e,n))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>hT(e).delete(t.targetId)).next(()=>this.Bn(e)).next(t=>(t.targetCount>0||sK(),t.targetCount-=1,this.kn(e,t)))}removeTargets(e,t,n){let r=0,i=[];return hT(e).J((s,a)=>{let o=uj(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>am.waitFor(i)).next(()=>r)}forEachTarget(e,t){return hT(e).J((e,n)=>{t(uj(n))})}Bn(e){return hE(e).get("targetGlobalKey").next(e=>(null!==e||sK(),e))}kn(e,t){return hE(e).put("targetGlobalKey",t)}qn(e,t){return hT(e).put(uq(this.serializer,t))}Qn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Bn(e).next(e=>e.targetCount)}getTargetData(e,t){let n=o1(t),r=IDBKeyRange.bound([n,-1/0],[n,1/0]),i=null;return hT(e).J({range:r,index:"queryTargetsIndex"},(e,n,r)=>{let s=uj(n);o2(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=hS(e);return t.forEach(t=>{let s=aR(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),am.waitFor(r)}removeMatchingKeys(e,t,n){let r=hS(e);return am.forEach(t,t=>{let i=aR(t.path);return am.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=hS(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=hS(e),i=lw();return r.J({range:n,H:!0},(e,t,n)=>{let r=new an(aP(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=aR(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return hS(e).J({index:"documentTargetsIndex",H:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}ot(e,t){return hT(e).get(t).next(e=>e?uj(e):null)}}function hT(e){return a1(e,"targets")}function hE(e){return a1(e,"targetGlobal")}function hS(e){return a1(e,"targetDocuments")}function hk([e,t],[n,r]){let i=s3(e,n);return 0===i?s3(t,r):i}class hC{constructor(e){this.Kn=e,this.buffer=new a9(hk),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>hk(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class hx{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}zn(e){sq("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){ab(e)?sq("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ap(e)}await this.zn(3e5)})}}class hA{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return am.resolve(ax.oe);let n=new hC(t);return this.jn.forEachTarget(e,e=>n.Wn(e.sequenceNumber)).next(()=>this.jn.Jn(e,e=>n.Wn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(sq("LruGarbageCollector","Garbage collection skipped; disabled"),am.resolve(hd)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(sq("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),hd):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let n,r,i,s,a,l,u,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(sq("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(u=Date.now(),sj()<=o.DEBUG&&sq("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(l-a)+"ms\n"+`	Removed ${e} documents in `+(u-l)+"ms\n"+`Total Duration: ${u-h}ms`),am.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class hN{constructor(e,t){this.db=e,this.garbageCollector=new hA(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Zn(e){let t=0;return this.Jn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(e,n)=>t(n))}addReference(e,t,n){return hD(e,n)}removeReference(e,t,n){return hD(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return hD(e,t)}er(e,t){let n;return n=!1,h_(e).Y(r=>hy(e,r,t).next(e=>(e&&(n=!0),am.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Xn(e,(s,a)=>{if(a<=t){let t=this.er(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,s8.min()),hS(e).delete([0,aR(s.path)])))});r.push(t)}}).next(()=>am.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return hD(e,t)}Xn(e,t){let n=hS(e),r,i=ax.oe;return n.J({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==ax.oe&&t(new an(aP(r)),i),i=a,r=s):i=ax.oe}).next(()=>{i!==ax.oe&&t(new an(aP(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function hD(e,t){var n;return hS(e).put((n=e.currentSequenceNumber,{targetId:0,path:aR(t.path),sequenceNumber:n}))}class hR{constructor(){this.changes=new lc(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,oR.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?am.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class hP{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return hM(e).put(n)}removeEntry(e,t,n){let r;return hM(e).delete([(r=t.path.toArray()).slice(0,r.length-2),r[r.length-2],uM(n),r[r.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.tr(e,n)))}getEntry(e,t){let n=oR.newInvalidDocument(t);return hM(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(hF(t))},(e,r)=>{n=this.nr(t,r)}).next(()=>n)}rr(e,t){let n={size:0,document:oR.newInvalidDocument(t)};return hM(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(hF(t))},(e,r)=>{n={document:this.nr(t,r),size:hm(r)}}).next(()=>n)}getEntries(e,t){let n=ld;return this.ir(e,t,(e,t)=>{let r=this.nr(e,t);n=n.insert(e,r)}).next(()=>n)}sr(e,t){let n=ld,r=new a4(an.comparator);return this.ir(e,t,(e,t)=>{let i=this.nr(e,t);n=n.insert(e,i),r=r.insert(e,hm(t))}).next(()=>({documents:n,_r:r}))}ir(e,t,n){if(t.isEmpty())return am.resolve();let r=new a9(hV);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(hF(r.first()),hF(r.last())),s=r.getIterator(),a=s.getNext();return hM(e).J({index:"documentKeyIndex",range:i},(e,t,r)=>{let i=an.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>hV(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.$(hF(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),uM(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return hM(e).U(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let n=ld;for(let i of e){let e=this.nr(an.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(ll(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=ld,s=hU(t,n),a=hU(t,ah.max());return hM(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.nr(an.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new hO(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return hL(e).get("remoteDocumentGlobalKey").next(e=>(e||sK(),e))}tr(e,t){return hL(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let e=function(e,t){var n;let r,i;if(t.document)r=uE(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=an.fromSegments(t.noDocument.path),n=uU(t.noDocument.readTime);r=oR.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return sK();{let e=an.fromSegments(t.unknownDocument.path),n=uU(t.unknownDocument.version);r=oR.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime((i=new s6((n=t.readTime)[0],n[1]),s8.fromTimestamp(i))),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(s8.min())))return e}return oR.newInvalidDocument(e)}}class hO extends hR{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new lc(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new a9((e,t)=>s3(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.ur.get(i);if(t.push(this.ar.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=uL(this.ar.serializer,s);r=r.add(i.path.popLast());let l=hm(o);n+=l-a.size,t.push(this.ar.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=uL(this.ar.serializer,s.convertToNoDocument(s8.min()));t.push(this.ar.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.ar.updateMetadata(e,n)),am.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(e=>(this.ur.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:e,_r:t})=>(t.forEach((t,n)=>{this.ur.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function hL(e){return a1(e,"remoteDocumentGlobal")}function hM(e){return a1(e,"remoteDocumentsV14")}function hF(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function hU(e,t){let n=t.documentKey.path.toArray();return[e,uM(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function hV(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=s3(n[e],r[e]))return i;return(i=s3(n.length,r.length))||(i=s3(n[n.length-2],r[r.length-2]))||s3(n[n.length-1],r[r.length-1])}class hj{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class hq{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&lj(n.mutation,e,ot.empty(),s6.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,lw()).next(()=>t))}getLocalViewOfDocuments(e,t,n=lw()){let r=lg();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=lp();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=lg();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,lw()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=ld,s=lg(),a=lg();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof lz)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),lj(a.mutation,t,a.mutation.getFieldMask(),s6.now())):s.set(t.key,ot.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new hj(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=lg(),r=new a4((e,t)=>e-t),i=lw();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||ot.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||lw()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=lg();l.forEach(e=>{if(!i.has(e)){let r=lV(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return am.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return an.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):le(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):am.resolve(lg()),a=-1,o=i;return s.next(t=>am.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?am.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,lw())).next(e=>({batchId:a,changes:lm(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new an(t)).next(e=>{let t=lp();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=lp();return this.indexManager.getCollectionParents(e,i).next(a=>am.forEach(a,a=>{let o=new o8(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,oR.newInvalidDocument(r)))});let n=lp();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&lj(s.mutation,r,ot.empty(),s6.now()),ll(t,r)&&(n=n.insert(e,r))}),n})}}class hB{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return am.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,{id:t.id,version:t.version,createTime:uf(t.createTime)}),am.resolve()}getNamedQuery(e,t){return am.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,{name:t.name,query:uB(t.bundledQuery),readTime:uf(t.readTime)}),am.resolve()}}class hz{constructor(){this.overlays=new a4(an.comparator),this.hr=new Map}getOverlay(e,t){return am.resolve(this.overlays.get(t))}getOverlays(e,t){let n=lg();return am.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ht(e,t,r)}),am.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.hr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.hr.delete(n)),am.resolve()}getOverlaysForCollection(e,t,n){let r=lg(),i=t.length+1,s=new an(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return am.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new a4((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=lg(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=lg(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return am.resolve(a)}ht(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new lY(t,n));let i=this.hr.get(t);void 0===i&&(i=lw(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class hG{constructor(){this.Pr=new a9(hK.Ir),this.Tr=new a9(hK.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let n=new hK(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Ar(new hK(e,t))}Rr(e,t){e.forEach(e=>this.removeReference(e,t))}Vr(e){let t=new an(new s7([])),n=new hK(t,e),r=new hK(t,e+1),i=[];return this.Tr.forEachInRange([n,r],e=>{this.Ar(e),i.push(e.key)}),i}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new an(new s7([])),n=new hK(t,e),r=new hK(t,e+1),i=lw();return this.Tr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new hK(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class hK{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return an.comparator(e.key,t.key)||s3(e.pr,t.pr)}static Er(e,t){return s3(e.pr,t.pr)||an.comparator(e.key,t.key)}}class h${constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new a9(hK.Ir)}checkEmpty(e){return am.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new lQ(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.wr=this.wr.add(new hK(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return am.resolve(s)}lookupMutationBatch(e,t){return am.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.br(t+1),r=n<0?0:n;return am.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return am.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return am.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new hK(t,0),r=new hK(t,1/0),i=[];return this.wr.forEachInRange([n,r],e=>{let t=this.Sr(e.pr);i.push(t)}),am.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new a9(s3);return t.forEach(e=>{let t=new hK(e,0),r=new hK(e,1/0);this.wr.forEachInRange([t,r],e=>{n=n.add(e.pr)})}),am.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;an.isDocumentKey(i)||(i=i.child(""));let s=new hK(new an(i),0),a=new a9(s3);return this.wr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.pr)),!0)},s),am.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(e=>{let n=this.Sr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Cr(t.batchId,"removed")||sK(),this.mutationQueue.shift();let n=this.wr;return am.forEach(t.mutations,r=>{let i=new hK(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.wr=n})}Mn(e){}containsKey(e,t){let n=new hK(t,0),r=this.wr.firstAfterOrEqual(n);return am.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,am.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class hH{constructor(e){this.vr=e,this.docs=new a4(an.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return am.resolve(n?n.document.mutableCopy():oR.newInvalidDocument(t))}getEntries(e,t){let n=ld;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():oR.newInvalidDocument(e))}),am.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=ld,s=t.path,a=new an(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=ac(au(a),n)||(r.has(a.key)||ll(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return am.resolve(i)}getAllFromCollectionGroup(e,t,n,r){sK()}Fr(e,t){return am.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new hW(this)}getSize(e){return am.resolve(this.size)}}class hW extends hR{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)}),am.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class hQ{constructor(e){this.persistence=e,this.Mr=new lc(e=>o1(e),o2),this.lastRemoteSnapshotVersion=s8.min(),this.highestTargetId=0,this.Or=0,this.Nr=new hG,this.targetCount=0,this.Lr=hb.Nn()}forEachTarget(e,t){return this.Mr.forEach((e,n)=>t(n)),am.resolve()}getLastRemoteSnapshotVersion(e){return am.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return am.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),am.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),am.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new hb(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,am.resolve()}updateTargetData(e,t){return this.qn(t),am.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,am.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.Mr.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),am.waitFor(i).next(()=>r)}getTargetCount(e){return am.resolve(this.targetCount)}getTargetData(e,t){let n=this.Mr.get(t)||null;return am.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),am.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),am.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),am.resolve()}getMatchingKeysForTargetId(e,t){let n=this.Nr.gr(t);return am.resolve(n)}containsKey(e,t){return am.resolve(this.Nr.containsKey(t))}}class hJ{constructor(e,t){this.Br={},this.overlays={},this.kr=new ax(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new hQ(this),this.indexManager=new hr,this.remoteDocumentCache=new hH(e=>this.referenceDelegate.Kr(e)),this.serializer=new uO(t),this.$r=new hB(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new hz,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new h$(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){sq("MemoryPersistence","Starting transaction:",e);let r=new hY(this.kr.next());return this.referenceDelegate.Ur(),n(r).next(e=>this.referenceDelegate.Wr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Gr(e,t){return am.or(Object.values(this.Br).map(n=>()=>n.containsKey(e,t)))}}class hY extends af{constructor(e){super(),this.currentSequenceNumber=e}}class hX{constructor(e){this.persistence=e,this.zr=new hG,this.jr=null}static Hr(e){return new hX(e)}get Jr(){if(this.jr)return this.jr;throw sK()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),am.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),am.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),am.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(e=>this.Jr.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Jr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return am.forEach(this.Jr,n=>{let r=an.fromPath(n);return this.Yr(e,r).next(e=>{e||t.removeEntry(r,s8.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return am.or([()=>am.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class hZ{constructor(e){this.serializer=e}O(e,t,n,r){let i=new ag("createOrUpgrade",t);n<1&&r>=1&&(e.createObjectStore("owner"),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",aO,{unique:!0}),e.createObjectStore("documentMutations"),h0(e),e.createObjectStore("remoteDocuments"));let s=am.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),h0(e)),s=s.next(()=>{let e,t;return e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:s8.min().toTimestamp(),targetCount:0},e.put("targetGlobalKey",t)})),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store("mutations").U().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",aO,{unique:!0});let n=i.store("mutations"),r=t.map(e=>n.put(e));return am.waitFor(r)}))),s=s.next(()=>{e.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&r>=5&&(s=s.next(()=>this.Xr(i))),n<6&&r>=6&&(s=s.next(()=>(e.createObjectStore("remoteDocumentGlobal"),this.ei(i)))),n<7&&r>=7&&(s=s.next(()=>this.ti(i))),n<8&&r>=8&&(s=s.next(()=>this.ni(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.ri(i))),n<11&&r>=11&&(s=s.next(()=>{e.createObjectStore("bundles",{keyPath:"bundleId"}),e.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&r>=12&&(s=s.next(()=>{let t;(t=e.createObjectStore("documentOverlays",{keyPath:aH})).createIndex("collectionPathOverlayIndex",aW,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",aQ,{unique:!1})})),n<13&&r>=13&&(s=s.next(()=>{let t;(t=e.createObjectStore("remoteDocumentsV14",{keyPath:aM})).createIndex("documentKeyIndex",aF),t.createIndex("collectionGroupIndex",aU)}).next(()=>this.ii(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.si(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:az}).createIndex("sequenceNumberIndex",aG,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:aK}).createIndex("documentKeyIndex",a$,{unique:!1})})),n<16&&r>=16&&(s=s.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),s}ei(e){let t=0;return e.store("remoteDocuments").J((e,n)=>{t+=hm(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(t=>am.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",r).next(n=>am.forEach(n,n=>{n.userId===t.userId||sK();let r=uV(this.serializer,n);return hp(e,t.userId,r).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let r=[];return n.J((n,i)=>{let s=new s7(n),a=[0,aR(s)];r.push(t.get(a).next(n=>n?am.resolve():t.put({targetId:0,path:aR(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>am.waitFor(r))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:aB});let n=t.store("collectionParents"),r=new hi,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:aR(r)})}};return t.store("remoteDocuments").J({H:!0},(e,t)=>i(new s7(e).popLast())).next(()=>t.store("documentMutations").J({H:!0},([e,t,n],r)=>i(aP(t).popLast())))}ri(e){let t=e.store("targets");return t.J((e,n)=>{let r=uj(n),i=uq(this.serializer,r);return t.put(i)})}ii(e,t){let n=t.store("remoteDocuments"),r=[];return n.J((e,n)=>{let i=t.store("remoteDocumentsV14"),s=(n.document?new an(s7.fromString(n.document.name).popFirst(5)):n.noDocument?an.fromSegments(n.noDocument.path):n.unknownDocument?an.fromSegments(n.unknownDocument.path):sK()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>am.waitFor(r))}si(e,t){let n=t.store("mutations"),r=new hP(this.serializer),i=new hJ(hX.Hr,this.serializer.ct);return n.U().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!=(t=n.get(e.userId))?t:lw();uV(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),am.forEach(n,(e,n)=>{let s=new sF(n),a=uQ.lt(this.serializer,s),o=i.getIndexManager(s);return new hq(r,hg.lt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new a0(t,ax.oe),e).next()})})}}function h0(e){e.createObjectStore("targetDocuments",{keyPath:aj}).createIndex("documentTargetsIndex",aq,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",aV,{unique:!0}),e.createObjectStore("targetGlobal")}let h1="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class h2{constructor(e,t,n,r,i,s,a,o,l,u,h=16){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.oi=i,this.window=s,this.document=a,this._i=l,this.ai=u,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=-1/0,this.Ii=e=>Promise.resolve(),!h2.D())throw new sH(s$.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new hN(this,r),this.Ti=t+"main",this.serializer=new uO(o),this.Ei=new ay(this.Ti,this.ui,new hZ(this.serializer)),this.Qr=new hI(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new hP(this.serializer),this.$r=new u$,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,!1===u&&sB("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new sH(s$.FAILED_PRECONDITION,h1);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new ax(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.L(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(async()=>{this.started&&await this.Ai()}))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>h3(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(ab(e))return sq("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return sq("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return h5(e).get("owner").next(e=>am.resolve(this.Si(e)))}bi(e){return h3(e).delete(this.clientId)}async Di(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=a1(e,"clientMetadata");return t.U().next(e=>{let n=this.vi(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return am.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?am.resolve(!0):h5(e).get("owner").next(t=>{if(null!==t&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new sH(s$.FAILED_PRECONDITION,h1);return!1}}return!(!this.networkEnabled||!this.inForeground)||h3(e).U().next(e=>void 0===this.vi(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&sq("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),await this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new a0(e,ax.oe);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()}vi(e,t){return e.filter(e=>this.Ci(e.updateTimeMs,t)&&!this.Mi(e.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>h3(e).U().next(e=>this.vi(e,18e5).map(e=>e.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return hg.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ha(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return uQ.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,n){var r;let i;sq("IndexedDbPersistence","Starting transaction:",e);let s=16===(r=this.ui)||15===r?aZ:14===r||13===r?aX:12===r?aY:11===r?aJ:void sK();return this.Ei.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new a0(r,this.kr?this.kr.next():ax.oe),"readwrite-primary"===t?this.gi(i).next(e=>!!e||this.pi(i)).next(t=>{if(!t)throw sB(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new sH(s$.FAILED_PRECONDITION,ad);return n(i)}).next(e=>this.wi(i).next(()=>e)):this.ki(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}ki(e){return h5(e).get("owner").next(e=>{if(null!==e&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new sH(s$.FAILED_PRECONDITION,h1)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return h5(e).put("owner",t)}static D(){return ay.D()}yi(e){let t=h5(e);return t.get("owner").next(e=>this.Si(e)?(sq("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):am.resolve())}Ci(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(sB(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Ri(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground="visible"===this.document.visibilityState)}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;z()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let n=null!==(null==(t=this.di)?void 0:t.getItem(this.Fi(e)));return sq("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return sB("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){sB("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch(e){}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function h5(e){return a1(e,"owner")}function h3(e){return a1(e,"clientMetadata")}function h4(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class h6{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=lw(),r=lw();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new h6(e,t.fromCache,n,r)}}class h8{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class h9{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=z()?8:av(F())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ji(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Hi(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new h8;return this.Ji(e,t,n).next(r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)})}).next(()=>i.result)}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(sj()<=o.DEBUG&&sq("QueryEngine","SDK will not create cache indexes for query:",lo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),am.resolve()):(sj()<=o.DEBUG&&sq("QueryEngine","Query:",lo(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(sj()<=o.DEBUG&&sq("QueryEngine","The SDK decides to create cache indexes for query:",lo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ln(t))):am.resolve())}ji(e,t){if(o7(t))return am.resolve(null);let n=ln(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=ln(t=li(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=lw(...r);return this.zi.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,li(t,null,"F")):this.es(e,s,t,n)}))})))}Hi(e,t,n,r){return o7(t)||r.isEqual(s8.min())?am.resolve(null):this.zi.getDocuments(e,n).next(i=>{let s=this.Zi(t,i);return this.Xi(t,s,n,r)?am.resolve(null):(sj()<=o.DEBUG&&sq("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),lo(t)),this.es(e,s,t,al(r,-1)).next(e=>e))})}Zi(e,t){let n=new a9(lh(e));return t.forEach((t,r)=>{ll(e,r)&&(n=n.add(r))}),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return sj()<=o.DEBUG&&sq("QueryEngine","Using full collection scan to execute query:",lo(t)),this.zi.getDocumentsMatchingQuery(e,t,ah.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class h7{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new a4(s3),this.rs=new lc(e=>o1(e),o2),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hq(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}}async function ce(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e._s(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=lw();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({us:e,removedBatchIds:i,addedBatchIds:s}))})})}function ct(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function cn(e,t,n){let r=lw(),i=lw();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=ld;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(s8.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):sq("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{cs:r,ls:i}})}function cr(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Qr.getTargetData(n,t).next(i=>i?(r=i,am.resolve(r)):e.Qr.allocateTargetId(n).next(i=>(r=new uP(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Qr.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.ns.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.ns=e.ns.insert(n.targetId,n),e.rs.set(t,n.targetId)),n})}async function ci(e,t,n){let r=e.ns.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!ab(e))throw e;sq("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.ns=e.ns.remove(t),e.rs.delete(r.target)}function cs(e,t,n){let r=s8.min(),i=lw();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=ln(t),void 0!==(o=e.rs.get(a))?am.resolve(e.ns.get(o)):e.Qr.getTargetData(s,a)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Qr.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.ts.getDocumentsMatchingQuery(s,t,n?r:s8.min(),n?i:lw())).next(n=>(cl(e,lu(t),n),{documents:n,hs:i}))})}function ca(e,t){let n=e.Qr,r=e.ns.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.ot(e,t).next(e=>e?e.target:null))}function co(e,t){let n=e.ss.get(t)||s8.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.os.getAllFromCollectionGroup(r,t,al(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(cl(e,t,n),n))}function cl(e,t,n){let r=e.ss.get(t)||s8.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.ss.set(t,r)}async function cu(e,t,n,r){let i=lw(),s=ld;for(let e of n){let n=t.Ps(e.metadata.name);e.document&&(i=i.add(n));let r=t.Is(e);r.setReadTime(t.Ts(e.metadata.readTime)),s=s.insert(n,r)}let a=e.os.newChangeBuffer({trackRemovals:!0}),o=await cr(e,ln(o9(s7.fromString(`__bundle__/docs/${r}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>cn(t,a,s).next(e=>(a.apply(t),e)).next(n=>e.Qr.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.Qr.addMatchingKeys(t,i,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,n.cs,n.ls)).next(()=>n.cs)))}async function ch(e,t,n=lw()){let r=await cr(e,ln(uB(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",i=>{let s=uf(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return e.$r.saveNamedQuery(i,t);let a=r.withResumeToken(or.EMPTY_BYTE_STRING,s);return e.ns=e.ns.insert(a.targetId,a),e.Qr.updateTargetData(i,a).next(()=>e.Qr.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>e.Qr.addMatchingKeys(i,n,r.targetId)).next(()=>e.$r.saveNamedQuery(i,t))})}function cc(e,t){return`firestore_clients_${e}_${t}`}function cd(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function cf(e,t){return`firestore_targets_${e}_${t}`}class cp{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Es(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new sH(r.error.code,r.error.message)),s?new cp(e,t,r.state,i):(sB("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class cm{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Es(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new sH(n.error.code,n.error.message)),i?new cm(e,n.state,r):(sB("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class cg{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=l_;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=aD(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new cg(e,i):(sB("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class cy{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new cy(t.clientId,t.onlineState):(sB("SharedClientState",`Failed to parse online state: ${e}`),null)}}class cv{constructor(){this.activeTargetIds=l_}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class cw{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.oi=t,this.persistenceKey=n,this.Vs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new a4(s3),this.started=!1,this.ys=[];const l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ws=cc(this.persistenceKey,this.Vs),this.Ss=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.ps=this.ps.insert(this.Vs,new cv),this.bs=RegExp(`^firestore_clients_${l}_([^_]*)$`),this.Ds=RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this.Cs=RegExp(`^firestore_targets_${l}_(\\d+)$`),this.vs=(a=this.persistenceKey,`firestore_online_state_${a}`),this.Fs=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.Bi())){if(e===this.Vs)continue;let t=this.getItem(cc(this.persistenceKey,e));if(t){let n=cg.Es(e,t);n&&(this.ps=this.ps.insert(n.clientId,n))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let t=this.xs(e);t&&this.Os(t)}for(let e of this.ys)this.gs(e);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,n){this.Ls(e,t,n),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(cf(this.persistenceKey,e));if(n){let r=cm.Es(e,n);r&&(t=r.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(cf(this.persistenceKey,e))}updateQueryState(e,t,n){this.qs(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Bs(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return sq("SharedClientState","READ",e,t),t}setItem(e,t){sq("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){sq("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){if(e.storageArea===this.storage){if(sq("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void sB("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.bs.test(e.key)){if(null==e.newValue){let t=this.$s(e.key);return this.Us(t,null)}{let t=this.Ws(e.key,e.newValue);if(t)return this.Us(t.clientId,t)}}else if(this.Ds.test(e.key)){if(null!==e.newValue){let t=this.Gs(e.key,e.newValue);if(t)return this.zs(t)}}else if(this.Cs.test(e.key)){if(null!==e.newValue){let t=this.js(e.key,e.newValue);if(t)return this.Hs(t)}}else if(e.key===this.vs){if(null!==e.newValue){let t=this.xs(e.newValue);if(t)return this.Os(t)}}else if(e.key===this.Ss){let t=function(e){let t=ax.oe;if(null!=e)try{let n=JSON.parse(e);"number"==typeof n||sK(),t=n}catch(e){sB("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==ax.oe&&this.sequenceNumberHandler(t)}else if(e.key===this.Fs){let t=this.Js(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Ys(e)))}}}else this.ys.push(e)})}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,n){let r=new cp(this.currentUser,e,t,n),i=cd(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ds())}Bs(e){let t=cd(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,n){let r=cf(this.persistenceKey,e),i=new cm(e,t,n);this.setItem(r,i.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let n=this.$s(e);return cg.Es(n,t)}Gs(e,t){let n=this.Ds.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return cp.Es(new sF(i),r,t)}js(e,t){let n=Number(this.Cs.exec(e)[1]);return cm.Es(n,t)}xs(e){return cy.Es(e)}Js(e){return JSON.parse(e)}async zs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);sq("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let n=t?this.ps.insert(e,t):this.ps.remove(e),r=this.Ns(this.ps),i=this.Ns(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.eo(s,a).then(()=>{this.ps=n})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=l_;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class c_{constructor(){this.no=new cv,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new cv,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class cb{io(e){}shutdown(){}}class cI{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){for(let e of(sq("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.uo))e(0)}ao(){for(let e of(sq("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.uo))e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let cT=null;function cE(){return null===cT?cT=0x10000000+Math.round(0x80000000*Math.random()):cT++,"0x"+cT.toString(16)}let cS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ck{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}Ao(e){this.Ro=e}onMessage(e){this.Vo=e}close(){this.ho()}send(e){this.lo(e)}mo(){this.Io()}fo(){this.Eo()}po(e){this.Ro(e)}yo(e){this.Vo(e)}}let cC="WebChannelConnection";class cx extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.wo=t+"://"+e.host,this.So=`projects/${n}/databases/${r}`,this.bo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Do(){return!1}Co(e,t,n,r,i){let s=cE(),a=this.vo(e,t.toUriEncodedString());sq("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(o,r,i),this.Mo(e,a,o,n).then(t=>(sq("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw sz("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}xo(e,t,n,r,i,s){return this.Co(e,t,n,r,i)}Fo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+sU}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}vo(e,t){let n=cS[e];return`${this.wo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Mo(e,t,n,r){let i=cE();return new Promise((s,a)=>{let o=new h;o.setWithCredentials(!0),o.listenOnce(f.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case p.NO_ERROR:let t=o.getResponseJson();sq(cC,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case p.TIMEOUT:sq(cC,`RPC '${e}' ${i} timed out`),a(new sH(s$.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:let n=o.getStatus();if(sq(cC,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(s$).indexOf(e)>=0?e:s$.UNKNOWN);a(new sH(n,t.message))}else a(new sH(s$.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new sH(s$.UNAVAILABLE,"Connection failed."));break;default:sK()}}finally{sq(cC,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(r);sq(cC,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,n,15)})}Oo(e,t,n){let r=cE(),i=[this.wo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=v(),a=y(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.xmlHttpFactory=new c({})),this.Fo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let u=i.join("");sq(cC,`Creating RPC '${e}' stream ${r}: ${u}`,o);let h=s.createWebChannel(u,o),f=!1,p=!1,_=new ck({lo:t=>{p?sq(cC,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(f||(sq(cC,`Opening RPC '${e}' stream ${r} transport.`),h.open(),f=!0),sq(cC,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},ho:()=>h.close()}),b=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return b(h,d.EventType.OPEN,()=>{p||(sq(cC,`RPC '${e}' stream ${r} transport opened.`),_.mo())}),b(h,d.EventType.CLOSE,()=>{p||(p=!0,sq(cC,`RPC '${e}' stream ${r} transport closed`),_.po())}),b(h,d.EventType.ERROR,t=>{p||(p=!0,sz(cC,`RPC '${e}' stream ${r} transport errored:`,t),_.po(new sH(s$.UNAVAILABLE,"The operation could not be completed")))}),b(h,d.EventType.MESSAGE,t=>{var n;if(!p){let i=t.data[0];i||sK();let s=i.error||(null==(n=i[0])?void 0:n.error);if(s){sq(cC,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=w[e];if(void 0!==t)return l0(t)}(t),i=s.message;void 0===n&&(n=s$.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),p=!0,_.po(new sH(n,i)),h.close()}else sq(cC,`RPC '${e}' stream ${r} received:`,i),_.yo(i)}}),b(a,g.STAT_EVENT,t=>{t.stat===m.PROXY?sq(cC,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===m.NOPROXY&&sq(cC,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{_.fo()},0),_}}function cA(){return"undefined"!=typeof window?window:null}function cN(){return"undefined"!=typeof document?document:null}function cD(e){return new uu(e,!0)}class cR{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.No=n,this.Lo=r,this.Bo=i,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(e){this.cancel();let t=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),r=Math.max(0,t-n);r>0&&sq("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,r,()=>(this.Qo=Date.now(),e())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){null!==this.qo&&(this.qo.skipDelay(),this.qo=null)}cancel(){null!==this.qo&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}}class cP{constructor(e,t,n,r,i,s,a,o){this.oi=e,this.Go=n,this.zo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new cR(e,t)}Zo(){return 1===this.state||5===this.state||this.Xo()}Xo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.e_()}async stop(){this.Zo()&&await this.close(0)}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&null===this.Ho&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(e){this.s_(),this.stream.send(e)}async r_(){if(this.Xo())return this.close(0)}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}async close(e,t){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,4!==e?this.Yo.reset():t&&t.code===s$.RESOURCE_EXHAUSTED?(sB(t.toString()),sB("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):t&&t.code===s$.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.__(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ao(t)}__(){}auth(){this.state=1;let e=this.a_(this.jo),t=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.jo===t&&this.u_(e,n)},t=>{e(()=>{let e=new sH(s$.UNKNOWN,"Fetching auth token failed: "+t.message);return this.c_(e)})})}u_(e,t){let n=this.a_(this.jo);this.stream=this.l_(e,t),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(e=>{n(()=>this.c_(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}e_(){this.state=5,this.Yo.$o(async()=>{this.state=0,this.start()})}c_(e){return sq("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}a_(e){return t=>{this.oi.enqueueAndForget(()=>this.jo===e?t():(sq("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class cO extends cP{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}l_(e,t){return this.connection.Oo("Listen",e,t)}onMessage(e){this.Yo.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:sK(),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||sK(),or.fromBase64String(i||"")):(void 0===i||i instanceof sD.Buffer||i instanceof Uint8Array||sK(),or.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new ut(s,a,o,l&&new sH(void 0===l.code?s$.UNKNOWN:l0(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=uv(e,r.document.name),s=uf(r.document.updateTime),a=r.document.createTime?uf(r.document.createTime):s8.min(),o=new oD({mapValue:{fields:r.document.fields}}),l=oR.newFoundDocument(i,s,a,o);n=new l7(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=uv(e,r.document),s=r.readTime?uf(r.readTime):s8.min(),a=oR.newNoDocument(i,s);n=new l7([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=uv(e,r.document);n=new l7([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return sK();{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new lX(r,i);n=new ue(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return s8.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?s8.min():t.readTime?uf(t.readTime):s8.min()}(e);return this.listener.h_(t,n)}P_(e){let t,n={};n.database=ub(this.serializer),n.addTarget=function(e,t){let n,r=t.target;if((n=o5(r)?{documents:uC(e,r)}:{query:ux(e,r)._t}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ud(e,t.resumeToken);let r=uh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(s8.min())>0){n.readTime=uc(e,t.snapshotVersion.toTimestamp());let r=uh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return sK()}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.i_(n)}I_(e){let t={};t.database=ub(this.serializer),t.removeTarget=e,this.i_(t)}}class cL extends cP{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(e,t){return this.connection.Oo("Write",e,t)}onMessage(e){var t,n;if(e.streamToken||sK(),this.lastStreamToken=e.streamToken,this.T_){this.Yo.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||sK(),t.map(e=>{let t;return(t=e.updateTime?uf(e.updateTime):uf(n)).isEqual(s8.min())&&(t=uf(n)),new lL(t,e.transformResults||[])})):[]),i=uf(e.commitTime);return this.listener.A_(i,r)}return e.writeResults&&0!==e.writeResults.length&&sK(),this.T_=!0,this.listener.R_()}V_(){let e={};e.database=ub(this.serializer),this.i_(e)}d_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>uS(this.serializer,e))};this.i_(t)}}class cM extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.m_=!1}f_(){if(this.m_)throw new sH(s$.FAILED_PRECONDITION,"The client has already been terminated.")}Co(e,t,n,r){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Co(e,um(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===s$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new sH(s$.UNKNOWN,e.toString())})}xo(e,t,n,r,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.xo(e,um(t,n),r,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===s$.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new sH(s$.UNKNOWN,e.toString())})}terminate(){this.m_=!0,this.connection.terminate()}}class cF{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){0===this.g_&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(e){"Online"===this.state?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.S_("Offline")))}set(e){this.C_(),this.g_=0,"Online"===e&&(this.y_=!1),this.S_(e)}S_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}b_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(sB(t),this.y_=!1):sq("OnlineStateTracker",t)}C_(){null!==this.p_&&(this.p_.cancel(),this.p_=null)}}class cU{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=i,this.O_.io(e=>{n.enqueueAndForget(async()=>{cH(this)&&(sq("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.M_.add(4),await cj(e),e.N_.set("Unknown"),e.M_.delete(4),await cV(e)}(this))})}),this.N_=new cF(n,r)}}async function cV(e){if(cH(e))for(let t of e.x_)await t(!0)}async function cj(e){for(let t of e.x_)await t(!1)}function cq(e,t){e.F_.has(t.targetId)||(e.F_.set(t.targetId,t),c$(e)?cK(e):c7(e).Xo()&&cz(e,t))}function cB(e,t){let n=c7(e);e.F_.delete(t),n.Xo()&&cG(e,t),0===e.F_.size&&(n.Xo()?n.n_():cH(e)&&e.N_.set("Unknown"))}function cz(e,t){if(e.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(s8.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}c7(e).P_(t)}function cG(e,t){e.L_.xe(t),c7(e).I_(t)}function cK(e){e.L_=new ur({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.F_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),c7(e).start(),e.N_.w_()}function c$(e){return cH(e)&&!c7(e).Zo()&&e.F_.size>0}function cH(e){return 0===e.M_.size}async function cW(e){e.N_.set("Online")}async function cQ(e){e.F_.forEach((t,n)=>{cz(e,t)})}async function cJ(e,t){e.L_=void 0,c$(e)?(e.N_.D_(t),cK(e)):e.N_.set("Unknown")}async function cY(e,t,n){if(e.N_.set("Online"),t instanceof ut&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.F_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.F_.delete(r),e.L_.removeTarget(r))}(e,t)}catch(n){sq("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await cX(e,n)}else if(t instanceof l7?e.L_.Ke(t):t instanceof ue?e.L_.He(t):e.L_.We(t),!n.isEqual(s8.min()))try{let t,r=await ct(e.localStore);n.compareTo(r)>=0&&await ((t=e.L_.rt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.F_.get(r);i&&e.F_.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.F_.get(t);if(!r)return;e.F_.set(t,r.withResumeToken(or.EMPTY_BYTE_STRING,r.snapshotVersion)),cG(e,t);let i=new uP(r.target,t,n,r.sequenceNumber);cz(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){sq("RemoteStore","Failed to raise snapshot:",t),await cX(e,t)}}async function cX(e,t,n){if(!ab(t))throw t;e.M_.add(1),await cj(e),e.N_.set("Offline"),n||(n=()=>ct(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{sq("RemoteStore","Retrying IndexedDB access"),await n(),e.M_.delete(1),await cV(e)})}function cZ(e,t){return t().catch(n=>cX(e,n,t))}async function c0(e){var t;let n=de(e),r=e.v_.length>0?e.v_[e.v_.length-1].batchId:-1;for(;cH(t=e)&&t.v_.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.v_.length&&n.n_();break}r=t.batchId,function(e,t){e.v_.push(t);let n=de(e);n.Xo()&&n.E_&&n.d_(t.mutations)}(e,t)}catch(t){await cX(e,t)}c1(e)&&c2(e)}function c1(e){return cH(e)&&!de(e).Zo()&&e.v_.length>0}function c2(e){de(e).start()}async function c5(e){de(e).V_()}async function c3(e){let t=de(e);for(let n of e.v_)t.d_(n.mutations)}async function c4(e,t,n){let r=e.v_.shift(),i=lJ.from(r,t,n);await cZ(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await c0(e)}async function c6(e,t){t&&de(e).E_&&await async function(e,t){var n;if(lZ(n=t.code)&&n!==s$.ABORTED){let n=e.v_.shift();de(e).t_(),await cZ(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await c0(e)}}(e,t),c1(e)&&c2(e)}async function c8(e,t){e.asyncQueue.verifyOperationInProgress(),sq("RemoteStore","RemoteStore received new credentials");let n=cH(e);e.M_.add(3),await cj(e),n&&e.N_.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.M_.delete(3),await cV(e)}async function c9(e,t){t?(e.M_.delete(2),await cV(e)):t||(e.M_.add(2),await cj(e),e.N_.set("Unknown"))}function c7(e){var t,n,r;return e.B_||(t=e.datastore,n=e.asyncQueue,r={Po:cW.bind(null,e),To:cQ.bind(null,e),Ao:cJ.bind(null,e),h_:cY.bind(null,e)},t.f_(),e.B_=new cO(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.x_.push(async t=>{t?(e.B_.t_(),c$(e)?cK(e):e.N_.set("Unknown")):(await e.B_.stop(),e.L_=void 0)})),e.B_}function de(e){var t,n,r;return e.k_||(t=e.datastore,n=e.asyncQueue,r={Po:()=>Promise.resolve(),To:c5.bind(null,e),Ao:c6.bind(null,e),R_:c3.bind(null,e),A_:c4.bind(null,e)},t.f_(),e.k_=new cL(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.x_.push(async t=>{t?(e.k_.t_(),await c0(e)):(await e.k_.stop(),e.v_.length>0&&(sq("RemoteStore",`Stopping write stream with ${e.v_.length} pending writes`),e.v_=[]))})),e.k_}class dt{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new sW,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new dt(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new sH(s$.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function dn(e,t){if(sB("AsyncQueue",`${t}: ${e}`),ab(e))return new sH(s$.UNAVAILABLE,`${t}: ${e}`);throw e}class dr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||an.comparator(t.key,n.key):(e,t)=>an.comparator(e.key,t.key),this.keyedMap=lp(),this.sortedSet=new a4(this.comparator)}static emptySet(e){return new dr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof dr)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new dr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class di{constructor(){this.q_=new a4(an.comparator)}track(e){let t=e.doc.key,n=this.q_.get(t);n?0!==e.type&&3===n.type?this.q_=this.q_.insert(t,e):3===e.type&&1!==n.type?this.q_=this.q_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.q_=this.q_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.q_=this.q_.remove(t):1===e.type&&2===n.type?this.q_=this.q_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.q_=this.q_.insert(t,{type:2,doc:e.doc}):sK():this.q_=this.q_.insert(t,e)}Q_(){let e=[];return this.q_.inorderTraversal((t,n)=>{e.push(n)}),e}}class ds{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ds(e,t,dr.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ls(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class da{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(e=>e.G_())}}class dl{constructor(){this.queries=new lc(e=>la(e),ls),this.onlineState="Unknown",this.z_=new Set}}async function du(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.W_()&&t.G_()&&(n=2):(i=new da,n=+!t.G_());try{switch(n){case 0:i.K_=await e.onListen(r,!0);break;case 1:i.K_=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=dn(n,`Initialization of query '${lo(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.U_.push(t),t.j_(e.onlineState),i.K_&&t.H_(i.K_)&&df(e)}async function dh(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.U_.indexOf(t);e>=0&&(i.U_.splice(e,1),0===i.U_.length?r=+!t.G_():!i.W_()&&t.G_()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function dc(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.U_)e.H_(r)&&(n=!0);i.K_=r}}n&&df(e)}function dd(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.U_)e.onError(n);e.queries.delete(t)}function df(e){e.z_.forEach(e=>{e.next()})}(I=b||(b={})).J_="default",I.Cache="cache";class dp{constructor(e,t,n){this.query=e,this.Y_=t,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new ds(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Z_?this.ea(e)&&(this.Y_.next(e),t=!0):this.ta(e,this.onlineState)&&(this.na(e),t=!0),this.X_=e,t}onError(e){this.Y_.error(e)}j_(e){this.onlineState=e;let t=!1;return this.X_&&!this.Z_&&this.ta(this.X_,e)&&(this.na(this.X_),t=!0),t}ta(e,t){return!(e.fromCache&&this.G_())||(!this.options.ra||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ea(e){if(e.docChanges.length>0)return!0;let t=this.X_&&this.X_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}na(e){e=ds.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Z_=!0,this.Y_.next(e)}G_(){return this.options.source!==b.Cache}}class dm{constructor(e,t){this.ia=e,this.byteLength=t}sa(){return"metadata"in this.ia}}class dg{constructor(e){this.serializer=e}Ps(e){return uv(this.serializer,e)}Is(e){return e.metadata.exists?uE(this.serializer,e.document,!1):oR.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return uf(e)}}class dy{constructor(e,t,n){this.oa=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=dv(e)}_a(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ia.namedQuery)this.queries.push(e.ia.namedQuery);else if(e.ia.documentMetadata){this.documents.push({metadata:e.ia.documentMetadata}),e.ia.documentMetadata.exists||++t;let n=s7.fromString(e.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.ia.document&&(this.documents[this.documents.length-1].document=e.ia.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}aa(e){let t=new Map,n=new dg(this.serializer);for(let r of e)if(r.metadata.queries){let e=n.Ps(r.metadata.name);for(let n of r.metadata.queries){let r=(t.get(n)||lw()).add(e);t.set(n,r)}}return t}async complete(){let e=await cu(this.localStore,new dg(this.serializer),this.documents,this.oa.id),t=this.aa(this.documents);for(let e of this.queries)await ch(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:e}}}function dv(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class dw{constructor(e){this.key=e}}class d_{constructor(e){this.key=e}}class db{constructor(e,t){this.query=e,this.la=t,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=lw(),this.mutatedKeys=lw(),this.Ia=lh(e),this.Ta=new dr(this.Ia)}get Ea(){return this.la}da(e,t){let n=t?t.Aa:new di,r=t?t.Ta:this.Ta,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=ll(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(n.track({type:3,doc:h}),f=!0):this.Ra(u,h)||(n.track({type:2,doc:h}),f=!0,(o&&this.Ia(h,o)>0||l&&0>this.Ia(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ta:s,Aa:n,Xi:a,mutatedKeys:i}}Ra(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.Ta;this.Ta=e.Ta,this.mutatedKeys=e.mutatedKeys;let s=e.Aa.Q_();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return sK()}})(n)-i(r)||this.Ia(e.doc,t.doc)}),this.Va(n),r=null!=r&&r;let a=t&&!r?this.ma():[],o=0===this.Pa.size&&this.current&&!r?1:0,l=o!==this.ha;return(this.ha=o,0!==s.length||l)?{snapshot:new ds(this.query,e.Ta,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:a}:{fa:a}}j_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new di,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(e){return!this.la.has(e)&&!!this.Ta.has(e)&&!this.Ta.get(e).hasLocalMutations}Va(e){e&&(e.addedDocuments.forEach(e=>this.la=this.la.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=e.current)}ma(){if(!this.current)return[];let e=this.Pa;this.Pa=lw(),this.Ta.forEach(e=>{this.ga(e.key)&&(this.Pa=this.Pa.add(e.key))});let t=[];return e.forEach(e=>{this.Pa.has(e)||t.push(new d_(e))}),this.Pa.forEach(n=>{e.has(n)||t.push(new dw(n))}),t}pa(e){this.la=e.hs,this.Pa=lw();let t=this.da(e.documents);return this.applyChanges(t,!0)}ya(){return ds.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,0===this.ha,this.hasCachedResults)}}class dI{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class dT{constructor(e){this.key=e,this.wa=!1}}class dE{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Sa={},this.ba=new lc(e=>la(e),ls),this.Da=new Map,this.Ca=new Set,this.va=new a4(an.comparator),this.Fa=new Map,this.Ma=new hG,this.xa={},this.Oa=new Map,this.Na=hb.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return!0===this.La}}async function dS(e,t,n=!0){let r,i=d2(e),s=i.ba.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.ya()):r=await dC(i,t,n,!0),r}async function dk(e,t){let n=d2(e);await dC(n,t,!0,!1)}async function dC(e,t,n,r){let i,s=await cr(e.localStore,ln(t)),a=s.targetId,o=n?e.sharedClientState.addLocalQueryTarget(a):"not-current";return r&&(i=await dx(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&cq(e.remoteStore,s),i}async function dx(e,t,n,r,i){e.Ba=(t,n,r)=>(async function(e,t,n,r){let i=t.view.da(n);i.Xi&&(i=await cs(e.localStore,t.query,!1).then(({documents:e})=>t.view.da(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return dB(e,t.targetId,o.fa),o.snapshot})(e,t,n,r);let s=await cs(e.localStore,t,!0),a=new db(t,s.hs),o=a.da(s.documents),l=l9.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);dB(e,n,u.fa);let h=new dI(t,n,a);return e.ba.set(t,h),e.Da.has(n)?e.Da.get(n).push(t):e.Da.set(n,[t]),u.snapshot}async function dA(e,t,n){let r=e.ba.get(t),i=e.Da.get(r.targetId);i.length>1?(e.Da.set(r.targetId,i.filter(e=>!ls(e,t))),e.ba.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await ci(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&cB(e.remoteStore,r.targetId),dj(e,r.targetId)}).catch(ap)):(dj(e,r.targetId),await ci(e.localStore,r.targetId,!0))}async function dN(e,t){let n=e.ba.get(t),r=e.Da.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),cB(e.remoteStore,n.targetId))}async function dD(e,t,n){let r=d5(e);try{var i,s;let e,a,o,l,u,h=await (i=r.localStore,o=s6.now(),l=t.reduce((e,t)=>e.add(t.key),lw()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let r=ld,s=lw();return i.os.getEntries(n,l).next(e=>{(r=e).forEach((e,t)=>{t.isValidDocument()||(s=s.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,r)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=lS(r.transform,e||null);null!=i&&(null===n&&(n=oD.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new lz(n.key,t,function e(t){let n=[];return a5(t.fields,(t,r)=>{let i=new at([t]);if(ok(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new ot(n)}(t.value.mapValue),lM.exists(!0)))}return i.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{a=t;let r=t.applyToLocalDocumentSet(e,s);return i.documentOverlayCache.saveOverlays(n,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:lm(e)})));r.sharedClientState.addPendingMutation(h.batchId),s=h.batchId,(u=r.xa[r.currentUser.toKey()])||(u=new a4(s3)),u=u.insert(s,n),r.xa[r.currentUser.toKey()]=u,await dG(r,h.changes),await c0(r.remoteStore)}catch(t){let e=dn(t,"Failed to persist write");n.reject(e)}}async function dR(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.ns,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=i.get(o);if(!u)return;a.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Qr.addMatchingKeys(e,s.addedDocuments,o)));let h=u.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(or.EMPTY_BYTE_STRING,s8.min()).withLastLimboFreeSnapshotVersion(s8.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(n.Qr.updateTargetData(e,h))});let o=ld,l=lw();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(cn(e,s,t.documentUpdates).next(e=>{o=e.cs,l=e.ls})),!r.isEqual(s8.min())){let t=n.Qr.getLastRemoteSnapshotVersion(e).next(t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return am.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.ns=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Fa.get(n);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||sK(),t.addedDocuments.size>0?r.wa=!0:t.modifiedDocuments.size>0?r.wa||sK():t.removedDocuments.size>0&&(r.wa||sK(),r.wa=!1))}),await dG(e,s,t)}catch(e){await ap(e)}}function dP(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.ba.forEach((e,n)=>{let r=n.view.j_(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.U_)e.j_(t)&&(n=!0)}),n&&df(r),i.length&&e.Sa.h_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function dO(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Fa.get(t),i=r&&r.key;if(i){let n=new a4(an.comparator);n=n.insert(i,oR.newNoDocument(i,s8.min()));let r=lw().add(i),s=new l8(s8.min(),new Map,new a4(s3),n,r);await dR(e,s),e.va=e.va.remove(i),e.Fa.delete(t),dz(e)}else await ci(e.localStore,t,!1).then(()=>dj(e,t,n)).catch(ap)}async function dL(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,a=t.batch.keys(),o=n.os.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=am.resolve(),i.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);null!==i||sK(),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=lw();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));dV(e,r,null),dU(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await dG(e,i)}catch(e){await ap(e)}}async function dM(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||sK(),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));dV(e,t,n),dU(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await dG(e,i)}catch(e){await ap(e)}}async function dF(e,t){var n;cH(e.remoteStore)||sq("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await (n=e.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>n.mutationQueue.getHighestUnacknowledgedBatchId(e));if(-1===r)return void t.resolve();let i=e.Oa.get(r)||[];i.push(t),e.Oa.set(r,i)}catch(n){let e=dn(n,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function dU(e,t){(e.Oa.get(t)||[]).forEach(e=>{e.resolve()}),e.Oa.delete(t)}function dV(e,t,n){let r=e.xa[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.xa[e.currentUser.toKey()]=r}}function dj(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Da.get(t)))e.ba.delete(r),n&&e.Sa.ka(r,n);e.Da.delete(t),e.isPrimaryClient&&e.Ma.Vr(t).forEach(t=>{e.Ma.containsKey(t)||dq(e,t)})}function dq(e,t){e.Ca.delete(t.path.canonicalString());let n=e.va.get(t);null!==n&&(cB(e.remoteStore,n),e.va=e.va.remove(t),e.Fa.delete(n),dz(e))}function dB(e,t,n){for(let r of n)r instanceof dw?(e.Ma.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.va.get(n)||e.Ca.has(r)||(sq("SyncEngine","New document in limbo: "+n),e.Ca.add(r),dz(e))}(e,r)):r instanceof d_?(sq("SyncEngine","Document no longer in limbo: "+r.key),e.Ma.removeReference(r.key,t),e.Ma.containsKey(r.key)||dq(e,r.key)):sK()}function dz(e){for(;e.Ca.size>0&&e.va.size<e.maxConcurrentLimboResolutions;){let t=e.Ca.values().next().value;e.Ca.delete(t);let n=new an(s7.fromString(t)),r=e.Na.next();e.Fa.set(r,new dT(n)),e.va=e.va.insert(n,r),cq(e.remoteStore,new uP(ln(o9(n.path)),r,"TargetPurposeLimboResolution",ax.oe))}}async function dG(e,t,n){let r=[],i=[],s=[];e.ba.isEmpty()||(e.ba.forEach((a,o)=>{s.push(e.Ba(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let n=t&&!t.fromCache;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){r.push(t);let e=h6.Ki(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Sa.h_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>am.forEach(t,t=>am.forEach(t.qi,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>am.forEach(t.Qi,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!ab(e))throw e;sq("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.ns.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.ns=e.ns.insert(t,i)}}}(e.localStore,i))}async function dK(e,t){if(!e.currentUser.isEqual(t)){sq("SyncEngine","User change. New user:",t.toKey());let n=await ce(e.localStore,t);e.currentUser=t,e.Oa.forEach(e=>{e.forEach(e=>{e.reject(new sH(s$.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Oa.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await dG(e,n.us)}}function d$(e,t){let n=e.Fa.get(t);if(n&&n.wa)return lw().add(n.key);{let n=lw(),r=e.Da.get(t);if(!r)return n;for(let t of r){let r=e.ba.get(t);n=n.unionWith(r.view.Ea)}return n}}async function dH(e,t){let n=await cs(e.localStore,t.query,!0),r=t.view.pa(n);return e.isPrimaryClient&&dB(e,t.targetId,r.fa),r}async function dW(e,t){return co(e.localStore,t).then(t=>dG(e,t))}async function dQ(e,t,n,r){var i,s;let a,o=await (i=e.localStore,a=i.mutationQueue,i.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.vn(e,t).next(t=>t?i.localDocuments.getDocuments(e,t):am.resolve(null))));null!==o?("pending"===n?await c0(e.remoteStore):"acknowledged"===n||"rejected"===n?(dV(e,t,r||null),dU(e,t),s=e.localStore,s.mutationQueue.Mn(t)):sK(),await dG(e,o)):sq("SyncEngine","Cannot apply mutation batch with id: "+t)}async function dJ(e,t){if(d2(e),d5(e),!0===t&&!0!==e.La){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await dY(e,t.toArray());for(let t of(e.La=!0,await c9(e.remoteStore,!0),n))cq(e.remoteStore,t)}else if(!1===t&&!1!==e.La){let t=[],n=Promise.resolve();e.Da.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(dj(e,i),ci(e.localStore,i,!0))),cB(e.remoteStore,i)}),await n,await dY(e,t),e.Fa.forEach((t,n)=>{cB(e.remoteStore,n)}),e.Ma.mr(),e.Fa=new Map,e.va=new a4(an.comparator),e.La=!1,await c9(e.remoteStore,!1)}}async function dY(e,t,n){let r=[],i=[];for(let n of t){let t,s=e.Da.get(n);if(s&&0!==s.length)for(let n of(t=await cr(e.localStore,ln(s[0])),s)){let t=e.ba.get(n),r=await dH(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await ca(e.localStore,n);t=await cr(e.localStore,r),await dx(e,dX(r),n,!1,t.resumeToken)}r.push(t)}return e.Sa.h_(i),r}function dX(e){var t,n,r,i,s;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,s=e.limit,new o8(t,n,r,i,s,"F",e.startAt,e.endAt)}function dZ(e){return e.localStore.persistence.Bi()}async function d0(e,t,n,r){if(e.La)return void sq("SyncEngine","Ignoring unexpected query state notification.");let i=e.Da.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await co(e.localStore,lu(i[0])),s=l8.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,or.EMPTY_BYTE_STRING);await dG(e,r,s);break}case"rejected":await ci(e.localStore,t,!0),dj(e,t,r);break;default:sK()}}async function d1(e,t,n){let r=d2(e);if(r.La){for(let e of t){if(r.Da.has(e)&&r.sharedClientState.isActiveQueryTarget(e)){sq("SyncEngine","Adding an already active target "+e);continue}let t=await ca(r.localStore,e),n=await cr(r.localStore,t);await dx(r,dX(t),n.targetId,!1,n.resumeToken),cq(r.remoteStore,n)}for(let e of n)r.Da.has(e)&&await ci(r.localStore,e,!1).then(()=>{cB(r.remoteStore,e),dj(r,e)}).catch(ap)}}function d2(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=dR.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=d$.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dO.bind(null,e),e.Sa.h_=dc.bind(null,e.eventManager),e.Sa.ka=dd.bind(null,e.eventManager),e}function d5(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=dL.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=dM.bind(null,e),e}class d3{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=cD(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t,n;return t=this.persistence,n=new h9,new h7(t,n,e.initialUser,this.serializer)}createPersistence(e){return new hJ(hX.Hr,this.serializer)}createSharedClientState(e){return new c_}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class d4 extends d3{constructor(e,t,n){super(),this.Qa=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Qa.initialize(this,e),await d5(this.Qa.syncEngine),await c0(this.Qa.remoteStore),await this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){var t,n;return t=this.persistence,n=new h9,new h7(t,n,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new hx(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new aC(t,this.persistence);return new ak(e.asyncQueue,n)}createPersistence(e){let t=h4(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?hf.withCacheSize(this.cacheSizeBytes):hf.DEFAULT;return new h2(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,cA(),cN(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new c_}}class d6 extends d4{constructor(e,t){super(e,t,!1),this.Qa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Qa.syncEngine;this.sharedClientState instanceof cw&&(this.sharedClientState.syncEngine={Zs:dQ.bind(null,t),Xs:d0.bind(null,t),eo:d1.bind(null,t),Bi:dZ.bind(null,t),Ys:dW.bind(null,t)},await this.sharedClientState.start()),await this.persistence.fi(async e=>{await dJ(this.Qa.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=cA();if(!cw.D(t))throw new sH(s$.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=h4(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new cw(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class d8{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>dP(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=dK.bind(null,this.syncEngine),await c9(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new dl}createDatastore(e){var t;let n=cD(e.databaseInfo.databaseId),r=new cx(e.databaseInfo);return t=e.authCredentials,new cM(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new cU(t,n,e.asyncQueue,e=>dP(this.syncEngine,e,0),cI.D()?new cI:new cb)}createSyncEngine(e,t){var n,r,i,s,a,o;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new dE(n,r,i,s,a,o),t&&(l.La=!0),l}async terminate(){var e;await async function(e){sq("RemoteStore","RemoteStore shutting down."),e.M_.add(5),await cj(e),e.O_.shutdown(),e.N_.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate()}}function d9(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){let r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class d7{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ka(this.observer.next,e)}error(e){this.observer.error?this.Ka(this.observer.error,e):sB("Uncaught Error in snapshot listener:",e.toString())}$a(){this.muted=!0}Ka(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class fe{constructor(e,t){this.Ua=e,this.serializer=t,this.metadata=new sW,this.buffer=new Uint8Array,this.Wa=new TextDecoder("utf-8"),this.Ga().then(e=>{e&&e.sa()?this.metadata.resolve(e.ia.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.ia)}`))},e=>this.metadata.reject(e))}close(){return this.Ua.cancel()}async getMetadata(){return this.metadata.promise}async qa(){return await this.getMetadata(),this.Ga()}async Ga(){let e=await this.za();if(null===e)return null;let t=this.Wa.decode(e),n=Number(t);return isNaN(n)&&this.ja(`length string (${t}) is not valid number`),new dm(JSON.parse(await this.Ha(n)),e.length+n)}Ja(){return this.buffer.findIndex(e=>123===e)}async za(){for(;0>this.Ja()&&!await this.Ya(););if(0===this.buffer.length)return null;let e=this.Ja();e<0&&this.ja("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ha(e){for(;this.buffer.length<e;)await this.Ya()&&this.ja("Reached the end of bundle when more is expected.");let t=this.Wa.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ja(e){throw this.Ua.cancel(),Error(`Invalid bundle format: ${e}`)}async Ya(){let e=await this.Ua.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class ft{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new sH(s$.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let n={documents:t.map(t=>uy(e.serializer,t))},r=await e.xo("BatchGetDocuments",e.serializer.databaseId,s7.emptyPath(),n,t.length),i=new Map;r.forEach(t=>{var n;let r,s,a,o,l,u,h=(n=e.serializer,"found"in t?(t.found||sK(),t.found.name,t.found.updateTime,r=uv(n,t.found.name),s=uf(t.found.updateTime),a=t.found.createTime?uf(t.found.createTime):s8.min(),o=new oD({mapValue:{fields:t.found.fields}}),oR.newFoundDocument(r,s,a,o)):"missing"in t?(t.missing||sK(),t.readTime||sK(),l=uv(n,t.missing),u=uf(t.readTime),oR.newNoDocument(l,u)):sK());i.set(h.key.toString(),h)});let s=[];return t.forEach(e=>{let t=i.get(e.toString());t||sK(),s.push(t)}),s}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new lH(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let n=an.fromPath(t);this.mutations.push(new lW(n,this.precondition(n)))}),await async function(e,t){let n={writes:t.map(t=>uS(e.serializer,t))};await e.Co("Commit",e.serializer.databaseId,s7.emptyPath(),n)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw sK();t=s8.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new sH(s$.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(s8.min())?lM.exists(!1):lM.updateTime(t):lM.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(s8.min()))throw new sH(s$.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return lM.updateTime(t)}return lM.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class fn{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Za=n.maxAttempts,this.Yo=new cR(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(async()=>{let e=new ft(this.datastore),t=this.tu(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.nu(e)}))}).catch(e=>{this.nu(e)})})}tu(e){try{let t=this.updateFunction(e);return!aA(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}nu(e){this.Za>0&&this.ru(e)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(e)}ru(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!lZ(t)}return!1}}class fr{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=sF.UNAUTHENTICATED,this.clientId=s5.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{sq("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(sq("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new sH(s$.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new sW;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=dn(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function fi(e,t){e.asyncQueue.verifyOperationInProgress(),sq("FirestoreClient","Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await ce(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function fs(e,t){e.asyncQueue.verifyOperationInProgress();let n=await fo(e);sq("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>c8(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>c8(t.remoteStore,n)),e._onlineComponents=t}function fa(e){return"FirebaseError"===e.name?e.code===s$.FAILED_PRECONDITION||e.code===s$.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function fo(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){sq("FirestoreClient","Using user provided OfflineComponentProvider");try{await fi(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!fa(t))throw t;sz("Error using user provided cache. Falling back to memory cache: "+t),await fi(e,new d3)}}else sq("FirestoreClient","Using default OfflineComponentProvider"),await fi(e,new d3);return e._offlineComponents}async function fl(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(sq("FirestoreClient","Using user provided OnlineComponentProvider"),await fs(e,e._uninitializedComponentsProvider._online)):(sq("FirestoreClient","Using default OnlineComponentProvider"),await fs(e,new d8))),e._onlineComponents}function fu(e){return fo(e).then(e=>e.persistence)}function fh(e){return fo(e).then(e=>e.localStore)}function fc(e){return fl(e).then(e=>e.remoteStore)}function fd(e){return fl(e).then(e=>e.syncEngine)}async function ff(e){let t=await fl(e),n=t.eventManager;return n.onListen=dS.bind(null,t.syncEngine),n.onUnlisten=dA.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=dk.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=dN.bind(null,t.syncEngine),n}function fp(e,t,n={}){let r=new sW;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a,o;return i=await ff(e),s=e.asyncQueue,a=new d7({next:e=>{s.enqueueAndForget(()=>dh(i,o));let a=e.docs.has(t);!a&&e.fromCache?r.reject(new sH(s$.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&e.fromCache&&n&&"server"===n.source?r.reject(new sH(s$.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),du(i,o=new dp(o9(t.path),a,{includeMetadataChanges:!0,ra:!0}))}),r.promise}function fm(e,t,n={}){let r=new sW;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let a;return i=await ff(e),s=e.asyncQueue,a=new dp(t,new d7({next:e=>{s.enqueueAndForget(()=>dh(i,a)),e.fromCache&&"server"===n.source?r.reject(new sH(s$.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,ra:!0}),du(i,a)}),r.promise}function fg(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let fy=new Map;function fv(e,t,n){if(!n)throw new sH(s$.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function fw(e,t,n,r){if(!0===t&&!0===r)throw new sH(s$.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function f_(e){if(!an.isDocumentKey(e))throw new sH(s$.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function fb(e){if(an.isDocumentKey(e))throw new sH(s$.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function fI(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":sK()}function fT(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new sH(s$.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=fI(e);throw new sH(s$.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function fE(e,t){if(t<=0)throw new sH(s$.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class fS{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new sH(s$.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new sH(s$.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}fw("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fg(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new sH(s$.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new sH(s$.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new sH(s$.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class fk{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fS({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new sH(s$.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new sH(s$.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fS(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new sJ;switch(e.type){case"firstParty":return new s0(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new sH(s$.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=fy.get(this))&&(sq("ComponentProvider","Removing Datastore"),fy.delete(this),e.terminate()),Promise.resolve()}}class fC{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new fC(this.firestore,e,this._query)}}class fx{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fA(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fx(this.firestore,e,this._key)}}class fA extends fC{constructor(e,t,n){super(e,t,o9(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new fx(this.firestore,null,new an(e))}withConverter(e){return new fA(this.firestore,e,this._path)}}function fN(e,t,...n){if(e=er(e),fv("collection","path",t),e instanceof fk){let r=s7.fromString(t,...n);return fb(r),new fA(e,null,r)}{if(!(e instanceof fx||e instanceof fA))throw new sH(s$.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(s7.fromString(t,...n));return fb(r),new fA(e.firestore,null,r)}}function fD(e,t,...n){if(e=er(e),1==arguments.length&&(t=s5.newId()),fv("doc","path",t),e instanceof fk){let r=s7.fromString(t,...n);return f_(r),new fx(e,null,new an(r))}{if(!(e instanceof fx||e instanceof fA))throw new sH(s$.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(s7.fromString(t,...n));return f_(r),new fx(e.firestore,e instanceof fA?e.converter:null,new an(r))}}function fR(e,t){return e=er(e),t=er(t),(e instanceof fx||e instanceof fA)&&(t instanceof fx||t instanceof fA)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function fP(e,t){return e=er(e),t=er(t),e instanceof fC&&t instanceof fC&&e.firestore===t.firestore&&ls(e._query,t._query)&&e.converter===t.converter}class fO{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new cR(this,"async_queue_retry"),this.hu=()=>{let e=cN();e&&sq("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};const e=cN();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.ou){this.ou=!0,this.cu=e||!1;let t=cN();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.hu)}}enqueue(e){if(this.Pu(),this.ou)return new Promise(()=>{});let t=new sW;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.su.push(e),this.Tu()))}async Tu(){if(0!==this.su.length){try{await this.su[0](),this.su.shift(),this.Yo.reset()}catch(e){if(!ab(e))throw e;sq("AsyncQueue","Operation failed with retryable error: "+e)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}}Iu(e){let t=this.iu.then(()=>(this.uu=!0,e().catch(e=>{let t;throw this.au=e,this.uu=!1,sB("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.uu=!1,e))));return this.iu=t,t}enqueueAfterDelay(e,t,n){this.Pu(),this.lu.indexOf(e)>-1&&(t=0);let r=dt.createAndSchedule(this,e,t,n,e=>this.Eu(e));return this._u.push(r),r}Pu(){this.au&&sK()}verifyOperationInProgress(){}async du(){let e;do e=this.iu,await e;while(e!==this.iu)}Au(e){for(let t of this._u)if(t.timerId===e)return!0;return!1}Ru(e){return this.du().then(()=>{for(let t of(this._u.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this._u))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.du()})}Vu(e){this.lu.push(e)}Eu(e){let t=this._u.indexOf(e);this._u.splice(t,1)}}function fL(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class fM{constructor(){this._progressObserver={},this._taskCompletionResolver=new sW,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class fF extends fk{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new fO,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||fV(this),this._firestoreClient.terminate()}}function fU(e){return e._firestoreClient||fV(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function fV(e){var t,n,r,i,s;let a=e._freezeSettings(),o=(i=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new oc(i,s,e._persistenceKey,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,fg(a.experimentalLongPollingOptions),a.useFetchStreams));e._firestoreClient=new fr(e._authCredentials,e._appCheckCredentials,e._queue,o),(null==(n=a.localCache)?void 0:n._offlineComponentProvider)&&(null==(r=a.localCache)?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.localCache.kind,_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider})}function fj(e,t,n){let r=new sW;return e.asyncQueue.enqueue(async()=>{try{await fi(e,n),await fs(e,t),r.resolve()}catch(e){if(!fa(e))throw e;sz("Error enabling indexeddb cache. Falling back to memory cache: "+e),r.reject(e)}}).then(()=>r.promise)}function fq(e){if(e._initialized||e._terminated)throw new sH(s$.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class fB{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fB(or.fromBase64String(e))}catch(e){throw new sH(s$.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new fB(or.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class fz{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new sH(s$.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new at(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fG{constructor(e){this._methodName=e}}class fK{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new sH(s$.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new sH(s$.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return s3(this._lat,e._lat)||s3(this._long,e._long)}}let f$=/^__.*__$/;class fH{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new lz(e,this.data,this.fieldMask,t,this.fieldTransforms):new lB(e,this.data,t,this.fieldTransforms)}}class fW{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new lz(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fQ(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw sK()}}class fJ{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.mu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(e){return new fJ(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.wu(e),r}Su(e){var t;let n=null==(t=this.path)?void 0:t.child(e),r=this.gu({path:n,yu:!1});return r.mu(),r}bu(e){return this.gu({path:void 0,yu:!0})}Du(e){return pa(e,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}mu(){if(this.path)for(let e=0;e<this.path.length;e++)this.wu(this.path.get(e))}wu(e){if(0===e.length)throw this.Du("Document fields must not be empty");if(fQ(this.fu)&&f$.test(e))throw this.Du('Document fields cannot begin and end with "__"')}}class fY{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||cD(e)}Fu(e,t,n,r=!1){return new fJ({fu:e,methodName:t,vu:n,path:at.emptyPath(),yu:!1,Cu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fX(e){let t=e._freezeSettings(),n=cD(e._databaseId);return new fY(e._databaseId,!!t.ignoreUndefinedProperties,n)}function fZ(e,t,n,r,i,s={}){let a,o,l=e.Fu(s.merge||s.mergeFields?2:0,t,n,i);pn("Data must be an object, but it was:",l,r);let u=pe(r,l);if(s.merge)a=new ot(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=pr(t,r,n);if(!l.contains(i))throw new sH(s$.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);po(e,i)||e.push(i)}a=new ot(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new fH(new oD(u),a,o)}class f0 extends fG{_toFieldTransform(e){if(2!==e.fu)throw 1===e.fu?e.Du(`${this._methodName}() can only appear at the top level of your update data`):e.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof f0}}function f1(e,t,n){return new fJ({fu:3,vu:t.settings.vu,methodName:e._methodName,yu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class f2 extends fG{_toFieldTransform(e){return new lO(e.path,new lk)}isEqual(e){return e instanceof f2}}class f5 extends fG{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=f1(this,e,!0),n=new lC(this.Mu.map(e=>f7(e,t)));return new lO(e.path,n)}isEqual(e){return e instanceof f5&&Q(this.Mu,e.Mu)}}class f3 extends fG{constructor(e,t){super(e),this.Mu=t}_toFieldTransform(e){let t=f1(this,e,!0),n=new lA(this.Mu.map(e=>f7(e,t)));return new lO(e.path,n)}isEqual(e){return e instanceof f3&&Q(this.Mu,e.Mu)}}class f4 extends fG{constructor(e,t){super(e),this.xu=t}_toFieldTransform(e){let t=new lD(e.serializer,lT(e.serializer,this.xu));return new lO(e.path,t)}isEqual(e){return e instanceof f4&&this.xu===e.xu}}function f6(e,t,n,r){let i=e.Fu(1,t,n);pn("Data must be an object, but it was:",i,r);let s=[],a=oD.empty();return a5(r,(e,r)=>{let o=ps(t,e,n);r=er(r);let l=i.Su(o);if(r instanceof f0)s.push(o);else{let e=f7(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new fW(a,new ot(s),i.fieldTransforms)}function f8(e,t,n,r,i,s){let a=e.Fu(1,t,n),o=[pr(t,r,n)],l=[i];if(s.length%2!=0)throw new sH(s$.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(pr(t,s[e])),l.push(s[e+1]);let u=[],h=oD.empty();for(let e=o.length-1;e>=0;--e)if(!po(u,o[e])){let t=o[e],n=l[e];n=er(n);let r=a.Su(t);if(n instanceof f0)u.push(t);else{let e=f7(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new fW(h,new ot(u),a.fieldTransforms)}function f9(e,t,n,r=!1){return f7(n,e.Fu(r?4:3,t))}function f7(e,t){if(pt(e=er(e)))return pn("Unsupported field value:",t,e),pe(e,t);if(e instanceof fG)return function(e,t){if(!fQ(t.fu))throw t.Du(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Du(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.yu&&4!==t.fu)throw t.Du("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=f7(i,t.bu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}var n=e;if(null===(n=er(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return lT(t.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){let e=s6.fromDate(n);return{timestampValue:uc(t.serializer,e)}}if(n instanceof s6){let e=new s6(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:uc(t.serializer,e)}}if(n instanceof fK)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof fB)return{bytesValue:ud(t.serializer,n._byteString)};if(n instanceof fx){let e=t.databaseId,r=n.firestore._databaseId;if(!r.isEqual(e))throw t.Du(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${e.projectId}/${e.database}`);return{referenceValue:up(n.firestore._databaseId||t.databaseId,n._key.path)}}throw t.Du(`Unsupported field value: ${fI(n)}`)}function pe(e,t){let n={};return a3(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):a5(e,(e,r)=>{let i=f7(r,t.pu(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function pt(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof s6||e instanceof fK||e instanceof fB||e instanceof fx||e instanceof fG)}function pn(e,t,n){if(!pt(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let r=fI(n);throw"an object"===r?t.Du(e+" a custom object"):t.Du(e+" "+r)}}function pr(e,t,n){if((t=er(t))instanceof fz)return t._internalPath;if("string"==typeof t)return ps(e,t);throw pa("Field path arguments must be of type string or ",e,!1,void 0,n)}let pi=RegExp("[~\\*/\\[\\]]");function ps(e,t,n){if(t.search(pi)>=0)throw pa(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new fz(...t.split("."))._internalPath}catch(r){throw pa(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function pa(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new sH(s$.INVALID_ARGUMENT,o+e+l)}function po(e,t){return e.some(e=>e.isEqual(t))}class pl{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new fx(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new pu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(ph("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class pu extends pl{data(){return super.data()}}function ph(e,t){return"string"==typeof t?ps(e,t):t instanceof fz?t._internalPath:t._delegate._internalPath}function pc(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new sH(s$.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class pd{}class pf extends pd{}function pp(e,t,...n){let r=[];for(let i of(t instanceof pd&&r.push(t),function(e){let t=e.filter(e=>e instanceof pg).length,n=e.filter(e=>e instanceof pm).length;if(t>1||t>0&&n>0)throw new sH(s$.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r=r.concat(n)),r))e=i._apply(e);return e}class pm extends pf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new pm(e,t,n)}_apply(e){let t=this._parse(e);return pE(e._query,t),new fC(e.firestore,e.converter,lr(e._query,t))}_parse(e){let t=fX(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new sH(s$.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){pT(a,s);let t=[];for(let n of a)t.push(pI(r,e,n));o={arrayValue:{values:t}}}else o=pI(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||pT(a,s),o=f9(n,t,a,"in"===s||"not-in"===s);return oU.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class pg extends pd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new pg(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:oV.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())pE(n,e),n=lr(n,e)}(e._query,t),new fC(e.firestore,e.converter,lr(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class py extends pf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new py(e,t)}_apply(e){var t;let n,r=function(e,t,n){if(null!==e.startAt)throw new sH(s$.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new sH(s$.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new oM(t,n)}(e._query,this._field,this._direction);return new fC(e.firestore,e.converter,(t=e._query,n=t.explicitOrderBy.concat([r]),new o8(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}class pv extends pf{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new pv(e,t,n)}_apply(e){return new fC(e.firestore,e.converter,li(e._query,this._limit,this._limitType))}}class pw extends pf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new pw(e,t,n)}_apply(e){var t;let n=pb(e,this.type,this._docOrFields,this._inclusive);return new fC(e.firestore,e.converter,(t=e._query,new o8(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt)))}}class p_ extends pf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new p_(e,t,n)}_apply(e){var t;let n=pb(e,this.type,this._docOrFields,this._inclusive);return new fC(e.firestore,e.converter,(t=e._query,new o8(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n)))}}function pb(e,t,n,r){if(n[0]=er(n[0]),n[0]instanceof pl)return function(e,t,n,r,i){if(!r)throw new sH(s$.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of lt(e))if(n.field.isKeyField())s.push(ob(t,r.key));else{let e=r.data.field(n.field);if(ol(e))throw new sH(s$.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new sH(s$.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new oP(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=fX(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new sH(s$.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new sH(s$.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!le(e)&&-1!==l.indexOf("/"))throw new sH(s$.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(s7.fromString(l));if(!an.isDocumentKey(n))throw new sH(s$.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new an(n);o.push(ob(t,i))}else{let e=f9(n,r,l);o.push(e)}}return new oP(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function pI(e,t,n){if("string"==typeof(n=er(n))){if(""===n)throw new sH(s$.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!le(t)&&-1!==n.indexOf("/"))throw new sH(s$.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(s7.fromString(n));if(!an.isDocumentKey(r))throw new sH(s$.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ob(e,new an(r))}if(n instanceof fx)return ob(e,n._key);throw new sH(s$.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fI(n)}.`)}function pT(e,t){if(!Array.isArray(e)||0===e.length)throw new sH(s$.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function pE(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new sH(s$.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new sH(s$.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class pS{convertValue(e,t="none"){switch(om(e)){case 0:return null;case 1:return e.booleanValue;case 2:return oa(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(oo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw sK()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return a5(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new fK(oa(e.latitude),oa(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ou(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(oh(e));default:return null}}convertTimestamp(e){let t=os(e);return new s6(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=s7.fromString(e);uR(n)||sK();let r=new od(n.get(1),n.get(3)),i=new an(n.popFirst(5));return r.isEqual(t)||sB(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function pk(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class pC extends pS{constructor(e){super(),this.firestore=e}convertBytes(e){return new fB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new fx(this.firestore,null,t)}}class px{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pA extends pl{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new pN(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(ph("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class pN extends pA{data(e={}){return super.data(e)}}class pD{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new px(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new pN(this._firestore,this._userDataWriter,n.key,n,new px(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new sH(s$.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new pN(e._firestore,e._userDataWriter,n.doc.key,n.doc,new px(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new pN(e._firestore,e._userDataWriter,t.doc.key,t.doc,new px(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return sK()}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function pR(e,t){return e instanceof pA&&t instanceof pA?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof pD&&t instanceof pD&&e._firestore===t._firestore&&fP(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class pP extends pS{constructor(e){super(),this.firestore=e}convertBytes(e){return new fB(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new fx(this.firestore,null,t)}}function pO(e,t,n){e=fT(e,fx);let r=fT(e.firestore,fF),i=pk(e.converter,t,n);return pF(r,[fZ(fX(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,lM.none())])}function pL(e,t,n,...r){e=fT(e,fx);let i=fT(e.firestore,fF),s=fX(i);return pF(i,[("string"==typeof(t=er(t))||t instanceof fz?f8(s,"updateDoc",e._key,t,n,r):f6(s,"updateDoc",e._key,t)).toMutation(e._key,lM.exists(!0))])}function pM(e,...t){var n,r,i,s;let a,o,l,u,h;e=er(e);let c={includeMetadataChanges:!1,source:"default"},d=0;"object"!=typeof t[0]||fL(t[d])||(c=t[d],d++);let f={includeMetadataChanges:c.includeMetadataChanges,source:c.source};if(fL(t[d])){let e=t[d];t[d]=null==(n=e.next)?void 0:n.bind(e),t[d+1]=null==(r=e.error)?void 0:r.bind(e),t[d+2]=null==(i=e.complete)?void 0:i.bind(e)}if(e instanceof fx)o=fT(e.firestore,fF),l=o9(e._key.path),a={next:n=>{t[d]&&t[d](pU(o,e,n))},error:t[d+1],complete:t[d+2]};else{let n=fT(e,fC);o=fT(n.firestore,fF),l=n._query;let r=new pP(o);a={next:e=>{t[d]&&t[d](new pD(o,r,n,e))},error:t[d+1],complete:t[d+2]},pc(e._query)}return s=fU(o),h=new dp(l,u=new d7(a),f),s.asyncQueue.enqueueAndForget(async()=>du(await ff(s),h)),()=>{u.$a(),s.asyncQueue.enqueueAndForget(async()=>dh(await ff(s),h))}}function pF(e,t){var n;let r;return n=fU(e),r=new sW,n.asyncQueue.enqueueAndForget(async()=>dD(await fd(n),t,r)),r.promise}function pU(e,t,n){let r=n.docs.get(t._key),i=new pP(e);return new pA(e,i,t._key,r,new px(n.hasPendingWrites,n.fromCache),t.converter)}let pV={maxAttempts:5};class pj{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=fX(e)}set(e,t,n){this._verifyNotCommitted();let r=pq(e,this._firestore),i=pk(r.converter,t,n),s=fZ(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,lM.none())),this}update(e,t,n,...r){let i;this._verifyNotCommitted();let s=pq(e,this._firestore);return i="string"==typeof(t=er(t))||t instanceof fz?f8(this._dataReader,"WriteBatch.update",s._key,t,n,r):f6(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,lM.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=pq(e,this._firestore);return this._mutations=this._mutations.concat(new lH(t._key,lM.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new sH(s$.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function pq(e,t){if((e=er(e)).firestore!==t)throw new sH(s$.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class pB extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=fX(e)}get(e){let t=pq(e,this._firestore),n=new pC(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return sK();let r=e[0];if(r.isFoundDocument())return new pl(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new pl(this._firestore,n,t._key,null,t.converter);throw sK()})}set(e,t,n){let r=pq(e,this._firestore),i=pk(r.converter,t,n),s=fZ(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){let i,s=pq(e,this._firestore);return i="string"==typeof(t=er(t))||t instanceof fz?f8(this._dataReader,"Transaction.update",s._key,t,n,r):f6(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=pq(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=pq(e,this._firestore),n=new pP(this._firestore);return super.get(e).then(e=>new pA(this._firestore,n,t._key,e._document,new px(!1,!1),t.converter))}}function pz(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new sH("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function pG(){if("undefined"==typeof Uint8Array)throw new sH("unimplemented","Uint8Arrays are not available in this environment.")}function pK(){if("undefined"==typeof atob)throw new sH("unimplemented","Blobs are unavailable in Firestore in this environment.")}new WeakMap,function(e=!0){sU=e$,eF(new ei("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new fF(new sX(t.getProvider("auth-internal")),new s2(t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new sH(s$.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new od(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),eX(sM,"4.6.3",void 0),eX(sM,"4.6.3","esm2017")}();class p${constructor(e){this._delegate=e}static fromBase64String(e){return pK(),new p$(fB.fromBase64String(e))}static fromUint8Array(e){return pG(),new p$(fB.fromUint8Array(e))}toBase64(){return pK(),this._delegate.toBase64()}toUint8Array(){return pG(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function pH(e){var t=e,n=["next","error","complete"];if("object"!=typeof t||null===t)return!1;for(let e of n)if(e in t&&"function"==typeof t[e])return!0;return!1}class pW{enableIndexedDbPersistence(e,t){return function(e,t){fq(e=fT(e,fF));let n=fU(e);if(n._uninitializedComponentsProvider)throw new sH(s$.FAILED_PRECONDITION,"SDK cache is already specified.");sz("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings(),i=new d8;return fj(n,i,new d4(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){fq(e=fT(e,fF));let t=fU(e);if(t._uninitializedComponentsProvider)throw new sH(s$.FAILED_PRECONDITION,"SDK cache is already specified.");sz("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=e._freezeSettings(),r=new d8;return fj(t,r,new d6(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){var t=e._delegate;if(t._initialized&&!t._terminated)throw new sH(s$.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let n=new sW;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!ay.D())return Promise.resolve();await ay.delete(e+"main")}(h4(t._databaseId,t._persistenceKey)),n.resolve()}catch(e){n.reject(e)}}),n.promise}}class pQ{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof od||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();e.merge||t.host===e.host||sz("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;let s=(e=fT(e,fk))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&sz("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=sF.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[D(JSON.stringify({alg:"none",type:"JWT"})),D(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new sH(s$.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new sF(s)}e._authCredentials=new sY(new sQ(t,n))}}(this._delegate,e,t,n)}enableNetwork(){var e;return(e=fU(fT(this._delegate,fF))).asyncQueue.enqueue(async()=>{let t=await fu(e),n=await fc(e);return t.setNetworkEnabled(!0),n.M_.delete(0),cV(n)})}disableNetwork(){var e;return(e=fU(fT(this._delegate,fF))).asyncQueue.enqueue(async()=>{let t=await fu(e),n=await fc(e);return t.setNetworkEnabled(!1),async function(e){e.M_.add(0),await cj(e),e.N_.set("Offline")}(n)})}enablePersistence(e){let t=!1,n=!1;return e&&fw("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){var e;let t;return e=fU(fT(this._delegate,fF)),t=new sW,e.asyncQueue.enqueueAndForget(async()=>dF(await fd(e),t)),t.promise}onSnapshotsInSync(e){var t,n;let r;return t=this._delegate,n=fU(t=fT(t,fF)),r=new d7(fL(e)?e:{next:e}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await ff(n),void(e.z_.add(r),r.next())}),()=>{r.$a(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await ff(n),void e.z_.delete(r)})}}get app(){if(!this._appCompat)throw new sH("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new p7(this,fN(this._delegate,e))}catch(e){throw p1(e,"collection()","Firestore.collection()")}}doc(e){try{return new p0(this,fD(this._delegate,e))}catch(e){throw p1(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new p6(this,function(e,t){if(e=fT(e,fk),fv("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new sH(s$.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new fC(e,null,new o8(s7.emptyPath(),t))}(this._delegate,e))}catch(e){throw p1(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){var r,i;let s;e=fT(e,fF);let a=Object.assign(Object.assign({},pV),void 0);if(a.maxAttempts<1)throw new sH(s$.INVALID_ARGUMENT,"Max attempts must be at least 1");return r=fU(e),i=n=>t(new pB(e,n)),s=new sW,r.asyncQueue.enqueueAndForget(async()=>{let e=await fl(r).then(e=>e.datastore);new fn(r.asyncQueue,e,a,i,s).Xa()}),s.promise}(this._delegate,t=>e(new pY(this,t)))}batch(){return fU(this._delegate),new pX(new pj(this._delegate,e=>pF(this._delegate,e)))}loadBundle(e){var t;let n,r;return t=this._delegate,n=fU(t=fT(t,fF)),r=new fM,function(e,t,n,r){var i;let s=(i=cD(t),new fe(function(e,t){if(e instanceof Uint8Array)return d9(e,void 0);if(e instanceof ArrayBuffer)return d9(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?l1().encode(n):n),i));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,n){try{var r,i;let s,a=await t.getMetadata();if(await (r=e.localStore,s=uf(a.createTime),r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.$r.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(s)>=0)))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);n._updateProgress(dv(a));let o=new dy(a,e.localStore,t.serializer),l=await t.qa();for(;l;){let e=await o._a(l);e&&n._updateProgress(e),l=await t.qa()}let u=await o.complete();return await dG(e,u.ca,void 0),await (i=e.localStore,i.persistence.runTransaction("Save bundle","readwrite",e=>i.$r.saveBundleMetadata(e,a))),n._completeWith(u.progress),Promise.resolve(u.ua)}catch(e){return sz("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(t=await fd(e),s,r).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(n,t._databaseId,e,r),r}namedQuery(e){var t,n;return(t=this._delegate,(n=fU(t=fT(t,fF)),n.asyncQueue.enqueue(async()=>{var t;return t=await fh(n),t.persistence.runTransaction("Get named query","readonly",n=>t.$r.getNamedQuery(n,e))})).then(e=>e?new fC(t,null,e.query):null)).then(e=>e?new p6(this,e):null)}}class pJ extends pS{constructor(e){super(),this.firestore=e}convertBytes(e){return new p$(new fB(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return p0.forKey(t,this.firestore,null)}}class pY{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new pJ(e)}get(e){let t=fT(e,fx);return this._delegate.get(t).then(e=>new p3(this._firestore,new pA(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){let r=fT(e,fx);return n?(pz("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let i=fT(e,fx);return 2==arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){let t=fT(e,fx);return this._delegate.delete(t),this}}class pX{constructor(e){this._delegate=e}set(e,t,n){let r=fT(e,fx);return n?(pz("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){let i=fT(e,fx);return 2==arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){let t=fT(e,fx);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class pZ{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new pN(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new p4(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=pZ.INSTANCES,r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new pZ(e,new pJ(e),t),r.set(t,i)),i}}pZ.INSTANCES=new WeakMap;class p0{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new pJ(e)}static forPath(e,t,n){if(e.length%2!=0)throw new sH("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new p0(t,new fx(t._delegate,n,new an(e)))}static forKey(e,t,n){return new p0(t,new fx(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new p7(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new p7(this.firestore,fN(this._delegate,e))}catch(e){throw p1(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=er(e))instanceof fx&&fR(this._delegate,e)}set(e,t){t=pz("DocumentReference.set",t);try{if(t)return pO(this._delegate,e,t);return pO(this._delegate,e)}catch(e){throw p1(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{if(1==arguments.length)return pL(this._delegate,e);return pL(this._delegate,e,t,...n)}catch(e){throw p1(e,"updateDoc()","DocumentReference.update()")}}delete(){var e;return pF(fT((e=this._delegate).firestore,fF),[new lH(e._key,lM.none())])}onSnapshot(...e){let t=p2(e),n=p5(e,e=>new p3(this.firestore,new pA(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return pM(this._delegate,t,n)}get(e){var t,n,r,i;let s;if((null==e?void 0:e.source)==="cache"){let e,r,i,a;t=fT(t=this._delegate,fx),r=fU(e=fT(t.firestore,fF)),i=new pP(e),s=(n=t._key,a=new sW,r.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await e.persistence.runTransaction("read document","readonly",n=>e.localDocuments.getDocument(n,t));r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new sH(s$.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let e=dn(r,`Failed to get document '${t} from cache`);n.reject(e)}})(await fh(r),n,a)),a.promise).then(n=>new pA(e,i,t._key,n,new px(null!==n&&n.hasLocalMutations,!0),t.converter))}else if((null==e?void 0:e.source)==="server"){let e;r=fT(r=this._delegate,fx),s=fp(fU(e=fT(r.firestore,fF)),r._key,{source:"server"}).then(t=>pU(e,r,t))}else{let e;i=fT(i=this._delegate,fx),s=fp(fU(e=fT(i.firestore,fF)),i._key).then(t=>pU(e,i,t))}return s.then(e=>new p3(this.firestore,new pA(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new p0(this.firestore,e?this._delegate.withConverter(pZ.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function p1(e,t,n){return e.message=e.message.replace(t,n),e}function p2(e){for(let t of e)if("object"==typeof t&&!pH(t))return t;return{}}function p5(e,t){var n,r;let i;return{next:e=>{i.next&&i.next(t(e))},error:null==(n=(i=pH(e[0])?e[0]:pH(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)?void 0:n.bind(i),complete:null==(r=i.complete)?void 0:r.bind(i)}}class p3{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new p0(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return pR(this._delegate,e._delegate)}}class p4 extends p3{data(e){let t=this._delegate.data(e);return this._delegate._converter?t:(void 0!==t||sK(),t)}}class p6{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new pJ(e)}where(e,t,n){try{let r;return new p6(this.firestore,pp(this._delegate,(r=ph("where",e),pm._create(r,t,n))))}catch(e){throw p1(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new p6(this.firestore,pp(this._delegate,function(e,t="asc"){let n=ph("orderBy",e);return py._create(n,t)}(e,t)))}catch(e){throw p1(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new p6(this.firestore,pp(this._delegate,(fE("limit",e),pv._create("limit",e,"F"))))}catch(e){throw p1(e,"limit()","Query.limit()")}}limitToLast(e){try{return new p6(this.firestore,pp(this._delegate,(fE("limitToLast",e),pv._create("limitToLast",e,"L"))))}catch(e){throw p1(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new p6(this.firestore,pp(this._delegate,function(...e){return pw._create("startAt",e,!0)}(...e)))}catch(e){throw p1(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new p6(this.firestore,pp(this._delegate,function(...e){return pw._create("startAfter",e,!1)}(...e)))}catch(e){throw p1(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new p6(this.firestore,pp(this._delegate,function(...e){return p_._create("endBefore",e,!1)}(...e)))}catch(e){throw p1(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new p6(this.firestore,pp(this._delegate,function(...e){return p_._create("endAt",e,!0)}(...e)))}catch(e){throw p1(e,"endAt()","Query.endAt()")}}isEqual(e){return fP(this._delegate,e._delegate)}get(e){var t,n,r,i;let s;if((null==e?void 0:e.source)==="cache"){let e,r,i,a;t=fT(t=this._delegate,fC),r=fU(e=fT(t.firestore,fF)),i=new pP(e),s=(n=t._query,a=new sW,r.asyncQueue.enqueueAndForget(async()=>(async function(e,t,n){try{let r=await cs(e,t,!0),i=new db(t,r.hs),s=i.da(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(r){let e=dn(r,`Failed to execute query '${t} against cache`);n.reject(e)}})(await fh(r),n,a)),a.promise).then(n=>new pD(e,i,t,n))}else if((null==e?void 0:e.source)==="server"){let e,t,n;r=fT(r=this._delegate,fC),t=fU(e=fT(r.firestore,fF)),n=new pP(e),s=fm(t,r._query,{source:"server"}).then(t=>new pD(e,n,r,t))}else{let e,t,n;i=fT(i=this._delegate,fC),t=fU(e=fT(i.firestore,fF)),n=new pP(e),pc(i._query),s=fm(t,i._query).then(t=>new pD(e,n,i,t))}return s.then(e=>new p9(this.firestore,new pD(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){let t=p2(e),n=p5(e,e=>new p9(this.firestore,new pD(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return pM(this._delegate,t,n)}withConverter(e){return new p6(this.firestore,e?this._delegate.withConverter(pZ.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class p8{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new p4(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class p9{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new p6(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new p4(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new p8(this._firestore,e))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new p4(this._firestore,n))})}isEqual(e){return pR(this._delegate,e._delegate)}}class p7 extends p6{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new p0(this.firestore,e):null}doc(e){try{if(void 0===e)return new p0(this.firestore,fD(this._delegate));return new p0(this.firestore,fD(this._delegate,e))}catch(e){throw p1(e,"doc()","CollectionReference.doc()")}}add(e){var t;let n,r,i;return(t=this._delegate,n=fT(t.firestore,fF),r=fD(t),i=pk(t.converter,e),pF(n,[fZ(fX(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,lM.exists(!1))]).then(()=>r)).then(e=>new p0(this.firestore,e))}isEqual(e){return fR(this._delegate,e._delegate)}withConverter(e){return new p7(this.firestore,e?this._delegate.withConverter(pZ.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class me{constructor(...e){this._delegate=new fz(...e)}static documentId(){return new me(at.keyField().canonicalString())}isEqual(e){return(e=er(e))instanceof fz&&this._delegate._internalPath.isEqual(e._internalPath)}}class mt{constructor(e){this._delegate=e}static serverTimestamp(){let e=new f2("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new mt(e)}static delete(){let e=new f0("deleteField");return e._methodName="FieldValue.delete",new mt(e)}static arrayUnion(...e){let t=function(...e){return new f5("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new mt(t)}static arrayRemove(...e){let t=function(...e){return new f3("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new mt(t)}static increment(e){let t=new f4("increment",e);return t._methodName="FieldValue.increment",new mt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}ti.INTERNAL.registerComponent(new ei("firestore-compat",e=>((e,t)=>new pQ(e,t,new pW))(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},{Firestore:pQ,GeoPoint:fK,Timestamp:s6,Blob:p$,Transaction:pY,WriteBatch:pX,DocumentReference:p0,DocumentSnapshot:p3,Query:p6,QueryDocumentSnapshot:p4,QuerySnapshot:p9,CollectionReference:p7,FieldPath:me,FieldValue:mt,setLogLevel:function(e){sV.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1}))),ti.registerVersion("@firebase/firestore-compat","0.3.32"),ti.initializeApp({apiKey:"****************",authDomain:"**********",projectId:"*************",storageBucket:"**************",messagingSenderId:"*************",appId:"***************",measurementId:"**************"}).firestore();let mn=ti.auth();var mr=e.i(747315),mi=e.i(244427),ms=e.i(639146);function ma(){(0,ms.useEffect)(()=>{},[]);let[e,t]=(0,ms.useState)(!1),[n,r]=(0,ms.useState)(""),[i,s]=(0,ms.useState)({email:"adminnextjs@gmail.com",password:"1234567890"}),{email:a,password:o}=i,l=e=>{s({...i,[e.target.name]:e.target.value}),r("")},u=(0,mi.useRouter)(),h=()=>{u.push("/dashboards/crm")};return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)("html",{children:(0,E.jsx)("body",{children:(0,E.jsx)("div",{className:"container",children:(0,E.jsx)("div",{className:"flex justify-center authentication authentication-basic items-center h-full text-defaultsize text-defaulttextcolor",children:(0,E.jsxs)("div",{className:"grid grid-cols-12",children:[(0,E.jsx)("div",{className:"xxl:col-span-4 xl:col-span-4 lg:col-span-4 md:col-span-3 sm:col-span-2"}),(0,E.jsxs)("div",{className:"xxl:col-span-4 xl:col-span-4 lg:col-span-4 md:col-span-6 sm:col-span-8 col-span-12",children:[(0,E.jsx)("div",{className:"my-[2.5rem] flex justify-center",children:(0,E.jsxs)(mr.default,{href:"/dashboards/crm/",children:[(0,E.jsx)("img",{src:`${S.basePath}/assets/images/brand-logos/desktop-logo.png`,alt:"logo",className:"desktop-logo"}),(0,E.jsx)("img",{src:`${S.basePath}/assets/images/brand-logos/desktop-dark.png`,alt:"logo",className:"desktop-dark"})]})}),(0,E.jsxs)("div",{className:"box !p-[3rem]",children:[(0,E.jsx)("nav",{className:"!block px-6  mx-auto firebase-data","aria-label":"Tabs",role:"tablist",children:(0,E.jsxs)("div",{className:"flex justify-center space-x-2 bg-light p-2 rounded-md rtl:space-x-reverse",children:[(0,E.jsx)("button",{type:"button",className:"hs-tab-active:bg-primary hs-tab-active:text-white py-2 px-2 inline-flex items-center gap-2 bg-transparent text-sm font-medium text-center text-gray-500 rounded-sm hover:text-primary  dark:text-white/70 dark:hover:text-white active",id:"pills-with-brand-color-item-1","data-hs-tab":"#pills-with-brand-color-01","aria-controls":"pills-with-brand-color-01",children:(0,E.jsx)("img",{src:`${S.basePath}/assets/images/brand-logos/nextjs.png`,alt:"user-img",className:"avatar avatar-sm w-6 h-6 rounded-full ring-0"})}),(0,E.jsx)("button",{type:"button",className:"hs-tab-active:bg-primary hs-tab-active:text-white py-2 px-2 inline-flex items-center gap-2 bg-transparent text-sm font-medium text-center text-gray-500 rounded-sm hover:text-primary  dark:text-white/70 dark:hover:text-white",id:"pills-with-brand-color-item-2","data-hs-tab":"#pills-with-brand-color-02","aria-controls":"pills-with-brand-color-02",children:(0,E.jsx)("img",{src:`${S.basePath}/assets/images/brand-logos/firbase.png`,alt:"user-img",className:"avatar avatar-sm w-6 h-6 rounded-full ring-0"})})]})}),(0,E.jsxs)("div",{className:"box-body",role:"tabpanel",id:"pills-with-brand-color-01","aria-labelledby":"pills-with-brand-color-item-1",children:[(0,E.jsx)("p",{className:"h5 font-semibold mb-2 text-center",children:"Sign In"}),n&&(0,E.jsx)("div",{className:"p-4 mb-4 bg-danger/40 text-sm  border-t-4 border-danger text-danger/60 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:n}),(0,E.jsx)("p",{className:"mb-4 text-[#8c9097] dark:text-white/50 opacity-[0.7] font-normal text-center",children:"Welcome back Jhon !"}),(0,E.jsxs)("div",{className:"grid grid-cols-12 gap-y-4",children:[(0,E.jsxs)("div",{className:"xl:col-span-12 col-span-12",children:[(0,E.jsx)("label",{htmlFor:"signin-email",className:"form-label text-default",children:"Email"}),(0,E.jsx)("input",{type:"text",name:"email",className:"form-control form-control-lg w-full !rounded-md",id:"email",onChange:l,value:a})]}),(0,E.jsxs)("div",{className:"xl:col-span-12 col-span-12 mb-2",children:[(0,E.jsxs)("label",{htmlFor:"signin-password",className:"form-label text-default block",children:["Password",(0,E.jsx)(mr.default,{href:"/authentication/reset-password/reset-basic/",className:"float-right text-danger",children:"Forget password ?"})]}),(0,E.jsxs)("div",{className:"input-group",children:[(0,E.jsx)("input",{name:"password",type:e?"text":"password",value:o,onChange:l,className:"form-control  !border-s form-control-lg !rounded-s-md",id:"signin-password",placeholder:"password"}),(0,E.jsx)("button",{onClick:()=>t(!e),"aria-label":"button",className:"ti-btn ti-btn-light !rounded-s-none !mb-0",type:"button",id:"button-addon2",children:(0,E.jsx)("i",{className:`${e?"ri-eye-line":"ri-eye-off-line"} align-middle`})})]}),(0,E.jsx)("div",{className:"mt-2",children:(0,E.jsxs)("div",{className:"form-check !ps-0",children:[(0,E.jsx)("input",{className:"form-check-input",type:"checkbox",defaultValue:"",id:"defaultCheck1"}),(0,E.jsx)("label",{className:"form-check-label text-[#8c9097] dark:text-white/50 font-normal",htmlFor:"defaultCheck1",children:"Remember password ?"})]})})]}),(0,E.jsx)("div",{className:"xl:col-span-12 col-span-12 grid mt-0",children:(0,E.jsx)("button",{onClick:e=>{"adminnextjs@gmail.com"==i.email&&"1234567890"==i.password?h():(r("The Auction details did not Match"),s({email:"adminnextjs@gmail.com",password:"1234567890"}))},className:"ti-btn ti-btn-primary !bg-primary !text-white !font-medium",children:"Sign In"})})]}),(0,E.jsx)("div",{className:"text-center",children:(0,E.jsxs)("p",{className:"text-[0.75rem] text-[#8c9097] dark:text-white/50 mt-4",children:["Dont have an account? ",(0,E.jsx)(mr.default,{href:"#!",className:"text-primary",children:"Sign Up"})]})}),(0,E.jsx)("div",{className:"text-center my-4 authentication-barrier",children:(0,E.jsx)("span",{children:"OR"})}),(0,E.jsxs)("div",{className:"btn-list text-center",children:[(0,E.jsx)("button",{"aria-label":"button",type:"button",className:"ti-btn ti-btn-icon ti-btn-light me-[0.365rem]",children:(0,E.jsx)("i",{className:"ri-facebook-line font-bold text-dark opacity-[0.7]"})}),(0,E.jsx)("button",{"aria-label":"button",type:"button",className:"ti-btn ti-btn-icon ti-btn-light me-[0.365rem]",children:(0,E.jsx)("i",{className:"ri-google-line font-bold text-dark opacity-[0.7]"})}),(0,E.jsx)("button",{"aria-label":"button",type:"button",className:"ti-btn ti-btn-icon ti-btn-light",children:(0,E.jsx)("i",{className:"ri-twitter-x-line font-bold text-dark opacity-[0.7]"})})]})]}),(0,E.jsxs)("div",{className:"box-body hidden",role:"tabpanel",id:"pills-with-brand-color-02","aria-labelledby":"pills-with-brand-color-item-2",children:[(0,E.jsx)("p",{className:"h5 font-semibold mb-2 text-center",children:"Sign In"}),n&&(0,E.jsx)("div",{className:"p-4 mb-4 bg-danger/40 text-sm  border-t-4 border-danger text-danger/60 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:n}),(0,E.jsx)("p",{className:"mb-4 text-[#8c9097] dark:text-white/50 opacity-[0.7] font-normal text-center",children:"Welcome back Jhon !"}),(0,E.jsxs)("div",{className:"grid grid-cols-12 gap-y-4",children:[(0,E.jsxs)("div",{className:"xl:col-span-12 col-span-12",children:[(0,E.jsx)("label",{htmlFor:"signin-email",className:"form-label text-default",children:"Email"}),(0,E.jsx)("input",{type:"email",name:"email",className:"form-control form-control-lg w-full !rounded-md",id:"email",onChange:l,value:a,placeholder:"Email"})]}),(0,E.jsxs)("div",{className:"xl:col-span-12 col-span-12 mb-2",children:[(0,E.jsxs)("label",{htmlFor:"signin-password",className:"form-label text-default block",children:["Password",(0,E.jsx)(mr.default,{href:"/authentication/reset-password/reset-basic/",className:"float-right text-danger",children:"Forget password ?"})]}),(0,E.jsxs)("div",{className:"input-group",children:[(0,E.jsx)("input",{name:"password",type:e?"text":"password",value:o,onChange:l,className:"form-control form-control-lg !rounded-s-md",id:"signin-password",placeholder:"password"}),(0,E.jsx)("button",{onClick:()=>t(!e),"aria-label":"button",className:"ti-btn ti-btn-light !rounded-s-none !mb-0",type:"button",id:"button-addon2",children:(0,E.jsx)("i",{className:`${e?"ri-eye-line":"ri-eye-off-line"} align-middle`})})]}),(0,E.jsx)("div",{className:"mt-2",children:(0,E.jsxs)("div",{className:"form-check !ps-0",children:[(0,E.jsx)("input",{className:"form-check-input",type:"checkbox",defaultValue:"",id:"defaultCheck1"}),(0,E.jsx)("label",{className:"form-check-label text-[#8c9097] dark:text-white/50 font-normal",htmlFor:"defaultCheck1",children:"Remember password ?"})]})})]}),(0,E.jsx)("div",{className:"xl:col-span-12 col-span-12 grid mt-2",children:(0,E.jsx)("button",{onClick:e=>{e.preventDefault(),mn.signInWithEmailAndPassword(a,o).then(e=>{console.log(e),h()}).catch(e=>{r(e.message)})},className:"ti-btn ti-btn-primary !bg-primary !text-white !font-medium",children:"Sign In"})})]}),(0,E.jsx)("div",{className:"text-center",children:(0,E.jsxs)("p",{className:"text-[0.75rem] text-[#8c9097] dark:text-white/50 mt-4",children:["Dont have an account? ",(0,E.jsx)(mr.default,{href:"#!",className:"text-primary",children:"Sign Up"})]})}),(0,E.jsx)("div",{className:"text-center my-4 authentication-barrier",children:(0,E.jsx)("span",{children:"OR"})}),(0,E.jsxs)("div",{className:"btn-list text-center",children:[(0,E.jsx)("button",{"aria-label":"button",type:"button",className:"ti-btn ti-btn-icon ti-btn-light me-[0.365rem]",children:(0,E.jsx)("i",{className:"ri-facebook-line font-bold text-dark opacity-[0.7]"})}),(0,E.jsx)("button",{"aria-label":"button",type:"button",className:"ti-btn ti-btn-icon ti-btn-light me-[0.365rem]",children:(0,E.jsx)("i",{className:"ri-google-line font-bold text-dark opacity-[0.7]"})}),(0,E.jsx)("button",{"aria-label":"button",type:"button",className:"ti-btn ti-btn-icon ti-btn-light",children:(0,E.jsx)("i",{className:"ri-twitter-x-line font-bold text-dark opacity-[0.7]"})})]})]})]})]}),(0,E.jsx)("div",{className:"xxl:col-span-4 xl:col-span-4 lg:col-span-4 md:col-span-3 sm:col-span-2"})]})})})})})})}e.s(["default",()=>ma],207649)}]);